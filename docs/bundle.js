/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={742:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=a(e),s=o[0],c=o[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,c)),l=0,h=c>0?s-4:s;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===c&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[l++]=255&t),1===c&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=16383,a=0,u=r-i;a<u;a+=s)o.push(c(e,a,a+s>u?u:a+s));return 1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=o[s],r[o.charCodeAt(s)]=s;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},764:(e,t,n)=>{"use strict";const r=n(742),i=n(645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return u(e,t,n)}function u(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let r=a(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return f(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return c.from(r,t,n);const i=function(e){if(c.isBuffer(e)){const t=0|p(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||G(e.length)?a(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),a(e<0?0:0|p(e))}function d(e){const t=e.length<0?0:0|p(e.length),n=a(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,c.prototype),r}function p(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Q(e).length;default:if(i)return r?-1:z(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),G(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){let o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let r=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===r?0:o-r)){if(-1===r&&(r=o),o-r+1===c)return r*s}else-1!==r&&(o-=o-r),r=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){let n=!0;for(let r=0;r<c;r++)if(u(e,o+r)!==u(t,r)){n=!1;break}if(n)return o}return-1}function w(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const o=t.length;let s;for(r>o/2&&(r=o/2),s=0;s<r;++s){const r=parseInt(t.substr(2*s,2),16);if(G(r))return s;e[n+s]=r}return s}function _(e,t,n,r){return V(z(t,e.length-n),e,n,r)}function E(e,t,n,r){return V(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function k(e,t,n,r){return V(Q(t),e,n,r)}function S(e,t,n,r){return V(function(e,t){let n,r,i;const o=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function x(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function C(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let o=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=n){let n,r,a,c;switch(s){case 1:t<128&&(o=t);break;case 2:n=e[i+1],128==(192&n)&&(c=(31&t)<<6|63&n,c>127&&(o=c));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(c=(15&t)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:n=e[i+1],r=e[i+2],a=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(c=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(o=c))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),i+=s}return function(e){const t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=R));return n}(r)}t.kMaxLength=s,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},c.allocUnsafe=function(e){return h(e)},c.allocUnsafeSlow=function(e){return h(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=c.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(Y(t,Uint8Array))i+t.length>r.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},c.byteLength=m,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):y.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(c.prototype[o]=c.prototype.inspect),c.prototype.compare=function(e,t,n,r,i){if(Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0);const a=Math.min(o,s),u=this.slice(r,i),l=e.slice(t,n);for(let e=0;e<a;++e)if(u[e]!==l[e]){o=u[e],s=l[e];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let o=!1;for(;;)switch(r){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return k(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const R=4096;function O(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function P(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=J[e[r]];return i}function D(e,t,n){const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function T(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r,i){K(t,r,i,e,n,7);let o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function M(e,t,n,r,i){K(t,r,i,e,n,7);let o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function N(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,o){return t=+t,n>>>=0,o||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,o){return t=+t,n>>>=0,o||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);let r=this[e],i=1,o=0;for(;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||T(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||T(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||T(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=X((function(e){U(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),c.prototype.readBigUInt64BE=X((function(e){U(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),c.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);let r=this[e],i=1,o=0;for(;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);let r=t,i=1,o=this[e+--r];for(;r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return e>>>=0,t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||T(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){e>>>=0,t||T(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=X((function(e){U(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=X((function(e){U(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||T(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||T(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||T(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||T(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||A(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||A(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=X((function(e,t=0){return j(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=X((function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);A(this,e,t,n,r-1,-r)}let i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);A(this,e,t,n,r-1,-r)}let i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=X((function(e,t=0){return j(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=X((function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const o=c.isBuffer(e)?e:c.from(e,r),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};const F={};function $(e,t,n){F[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function q(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function K(e,t,n,r,i,o){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i;throw i=o>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(o+1)}${r}`:`>= -(2${r} ** ${8*(o+1)-1}${r}) and < 2 ** ${8*(o+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new F.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){U(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||W(t,e.length-(n+1))}(r,i,o)}function U(e,t){if("number"!=typeof e)throw new F.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,n){if(Math.floor(e)!==e)throw U(e,n),new F.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}$("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),$("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),$("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=q(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=q(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const H=/[^+/0-9A-Za-z-_]/g;function z(e,t){let n;t=t||1/0;const r=e.length;let i=null;const o=[];for(let s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Q(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function G(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function X(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},227:(e,t,n)=>{var r=n(155);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(447)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,o,s=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];n=o.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},114:e=>{"use strict";function t(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}e.exports=function(e,n,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof n&&(r=n,n=""),n&&(r.code=n);try{return t(e,r)}catch(n){r.message=e.message,r.stack=e.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(e)),t(new i,r)}}},187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,o,s,u;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=c(e))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=p(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},177:e=>{e.exports=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},645:(e,t)=>{t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-l)-1,f>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+h],h+=d,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=u}return(f?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,l=(1<<u)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*c-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+f]=255&s,f+=p,s/=256,u-=8);e[n+f-p]|=128*m}},717:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},824:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,s){s=s||{};var a,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var s=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===u&&isFinite(e))return s.long?(a=e,(c=Math.abs(a))>=i?o(a,c,i,"day"):c>=r?o(a,c,r,"hour"):c>=n?o(a,c,n,"minute"):c>=t?o(a,c,t,"second"):a+" ms"):function(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},155:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var a,c=[],u=!1,l=-1;function h(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=s(h);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},375:(e,t,n)=>{let r;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:n.g):e=>(r||(r=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},798:(e,t,n)=>{"use strict";var r=n(155),i=65536,o=n(509).Buffer,s=n.g.crypto||n.g.msCrypto;s&&s.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var n=o.allocUnsafe(e);if(e>0)if(e>i)for(var a=0;a<e;a+=i)s.getRandomValues(n.slice(a,a+i));else s.getRandomValues(n);return"function"==typeof t?r.nextTick((function(){t(null,n)})):n}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},281:e=>{"use strict";var t={};function n(e,n,r){r||(r=Error);var i=function(e){var t,r;function i(t,r,i){return e.call(this,function(e,t,r){return"string"==typeof n?n:n(e,t,r)}(t,r,i))||this}return r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i}(r);i.prototype.name=r.name,i.prototype.code=e,t[e]=i}function r(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,o,s,a,c;if("string"==typeof t&&(o="not ",t.substr(0,4)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-9,n)===t}(e," argument"))s="The ".concat(e," ").concat(i," ").concat(r(t,"type"));else{var u=("number"!=typeof c&&(c=0),c+1>(a=e).length||-1===a.indexOf(".",c)?"argument":"property");s='The "'.concat(e,'" ').concat(u," ").concat(i," ").concat(r(t,"type"))}return s+". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},753:(e,t,n)=>{"use strict";var r=n(155),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(481),s=n(229);n(717)(l,o);for(var a=i(s.prototype),c=0;c<a.length;c++){var u=a[c];l.prototype[u]||(l.prototype[u]=s.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},725:(e,t,n)=>{"use strict";e.exports=i;var r=n(605);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n(717)(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},481:(e,t,n)=>{"use strict";var r,i=n(155);e.exports=x,x.ReadableState=S,n(187).EventEmitter;var o,s=function(e,t){return e.listeners(t).length},a=n(503),c=n(764).Buffer,u=(void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},l=n(616);o=l&&l.debuglog?l.debuglog("stream"):function(){};var h,d,f,p=n(327),m=n(195),y=n(457).getHighWaterMark,v=n(281).q,g=v.ERR_INVALID_ARG_TYPE,b=v.ERR_STREAM_PUSH_AFTER_EOF,w=v.ERR_METHOD_NOT_IMPLEMENTED,_=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(717)(x,a);var E=m.errorOrDestroy,k=["error","close","destroy","pause","resume"];function S(e,t,i){r=r||n(753),e=e||{},"boolean"!=typeof i&&(i=t instanceof r),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=y(this,e,"readableHighWaterMark",i),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=n(553).s),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function x(e){if(r=r||n(753),!(this instanceof x))return new x(e);var t=this instanceof r;this._readableState=new S(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function C(e,t,n,r,i){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,D(e)))}}(e,a);else if(i||(s=function(e,t){var n,r;return r=t,c.isBuffer(r)||r instanceof u||"string"==typeof t||void 0===t||e.objectMode||(n=new g("chunk",["string","Buffer","Uint8Array"],t)),n}(a,t)),s)E(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r)a.endEmitted?E(e,new _):R(e,a,t,!0);else if(a.ended)E(e,new b);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?R(e,a,t,!1):T(e,a)):R(e,a,t,!1)}else r||(a.reading=!1,T(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function R(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&P(e)),T(e,t)}Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),x.prototype.destroy=m.destroy,x.prototype._undestroy=m.undestroy,x.prototype._destroy=function(e,t){t(e)},x.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),C(this,e,t,!1,n)},x.prototype.unshift=function(e){return C(this,e,null,!0,!1)},x.prototype.isPaused=function(){return!1===this._readableState.flowing},x.prototype.setEncoding=function(e){h||(h=n(553).s);var t=new h(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var O=1073741824;function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=O?e=O:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(D,e))}function D(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,B(e)}function T(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(A,e,t))}function A(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(o("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function j(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){o("readable nexttick read 0"),e.read(0)}function N(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function F(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick($,t,e))}function $(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function q(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}x.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):P(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&F(this),null;var r,i=t.needReadable;return o("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&o("length less than watermark",i=!0),t.ended||t.reading?o("reading or ended",i=!1):i&&(o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(r=e>0?L(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&F(this)),null!==r&&this.emit("data",r),r},x.prototype._read=function(e){E(this,new w("_read()"))},x.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,o("pipe count=%d opts=%j",r.pipesCount,t);var a=t&&!1===t.end||e===i.stdout||e===i.stderr?m:c;function c(){o("onend"),e.end()}r.endEmitted?i.nextTick(a):n.once("end",a),e.on("unpipe",(function t(i,s){o("onunpipe"),i===n&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,o("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",u),e.removeListener("error",d),e.removeListener("unpipe",t),n.removeListener("end",c),n.removeListener("end",m),n.removeListener("data",h),l=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}));var u=function(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,B(e))}}(n);e.on("drain",u);var l=!1;function h(t){o("ondata");var i=e.write(t);o("dest.write",i),!1===i&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==q(r.pipes,e))&&!l&&(o("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function d(t){o("onerror",t),m(),e.removeListener("error",d),0===s(e,"error")&&E(e,t)}function f(){e.removeListener("finish",p),m()}function p(){o("onfinish"),e.removeListener("close",f),m()}function m(){o("unpipe"),n.unpipe(e)}return n.on("data",h),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",d),e.once("close",f),e.once("finish",p),e.emit("pipe",n),r.flowing||(o("pipe resume"),n.resume()),e},x.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=q(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},x.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,o("on readable",r.length,r.reading),r.length?P(this):r.reading||i.nextTick(M,this))),n},x.prototype.addListener=x.prototype.on,x.prototype.removeListener=function(e,t){var n=a.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick(j,this),n},x.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||i.nextTick(j,this),t},x.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(N,e,t))}(this,e)),e.paused=!1,this},x.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},x.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(o("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){o("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<k.length;s++)e.on(k[s],this.emit.bind(this,k[s]));return this._read=function(t){o("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(x.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=n(850)),d(this)}),Object.defineProperty(x.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(x.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(x.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),x._fromList=L,Object.defineProperty(x.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(x.from=function(e,t){return void 0===f&&(f=n(167)),f(x,e,t)})},605:(e,t,n)=>{"use strict";e.exports=l;var r=n(281).q,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,c=n(753);function u(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);c.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function h(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,n){d(e,t,n)}))}function d(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}n(717)(l,c),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,n){n(new i("_transform()"))},l.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}},229:(e,t,n)=>{"use strict";var r,i=n(155);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(undefined),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=x,x.WritableState=S;var s,a={deprecate:n(927)},c=n(503),u=n(764).Buffer,l=(void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},h=n(195),d=n(457).getHighWaterMark,f=n(281).q,p=f.ERR_INVALID_ARG_TYPE,m=f.ERR_METHOD_NOT_IMPLEMENTED,y=f.ERR_MULTIPLE_CALLBACK,v=f.ERR_STREAM_CANNOT_PIPE,g=f.ERR_STREAM_DESTROYED,b=f.ERR_STREAM_NULL_VALUES,w=f.ERR_STREAM_WRITE_AFTER_END,_=f.ERR_UNKNOWN_ENCODING,E=h.errorOrDestroy;function k(){}function S(e,t,s){r=r||n(753),e=e||{},"boolean"!=typeof s&&(s=t instanceof r),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if("function"!=typeof o)throw new y;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,o){--t.pendingcb,n?(i.nextTick(o,r),i.nextTick(D,e,t),e._writableState.errorEmitted=!0,E(e,r)):(o(r),e._writableState.errorEmitted=!0,E(e,r),D(e,t))}(e,n,r,t,o);else{var s=I(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||O(e,n),r?i.nextTick(R,e,n,s,o):R(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function x(e){var t=this instanceof(r=r||n(753));if(!t&&!s.call(x,this))return new x(e);this._writableState=new S(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function C(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new g("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function R(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),D(e,t)}function O(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,C(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,h=n.callback;if(C(e,t,!1,t.objectMode?1:u.length,u,l,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(n){t.pendingcb--,n&&E(e,n),t.prefinished=!0,e.emit("prefinish"),D(e,t)}))}function D(e,t){var n=I(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}n(717)(x,c),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===x&&e&&e._writableState instanceof S}})):s=function(e){return e instanceof this},x.prototype.pipe=function(){E(this,new v)},x.prototype.write=function(e,t,n){var r,o=this._writableState,s=!1,a=!o.objectMode&&(r=e,u.isBuffer(r)||r instanceof l);return a&&!u.isBuffer(e)&&(e=function(e){return u.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof n&&(n=k),o.ending?function(e,t){var n=new w;E(e,n),i.nextTick(t,n)}(this,n):(a||function(e,t,n,r){var o;return null===n?o=new b:"string"==typeof n||t.objectMode||(o=new p("chunk",["string","Buffer"],n)),!o||(E(e,o),i.nextTick(r,o),!1)}(this,o,e,n))&&(o.pendingcb++,s=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,a,r,i,o);return c}(this,o,a,e,t,n)),s},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||O(this,e))},x.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new _(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),x.prototype._write=function(e,t,n){n(new m("_write()"))},x.prototype._writev=null,x.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,D(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),x.prototype.destroy=h.destroy,x.prototype._undestroy=h.undestroy,x.prototype._destroy=function(e,t){t(e)}},850:(e,t,n)=>{"use strict";var r,i=n(155);function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n(610),a=Symbol("lastResolve"),c=Symbol("lastReject"),u=Symbol("error"),l=Symbol("ended"),h=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[a];if(null!==t){var n=e[f].read();null!==n&&(e[h]=null,e[a]=null,e[c]=null,t(p(n,!1)))}}function y(e){i.nextTick(m,e)}var v=Object.getPrototypeOf((function(){})),g=Object.setPrototypeOf((o(r={get stream(){return this[f]},next:function(){var e=this,t=this[u];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(t,n){i.nextTick((function(){e[u]?n(e[u]):t(p(void 0,!0))}))}));var n,r=this[h];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[l]?n(p(void 0,!0)):t[d](n,r)}),r)}}(r,this));else{var o=this[f].read();if(null!==o)return Promise.resolve(p(o,!1));n=new Promise(this[d])}return this[h]=n,n}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,n){e[f].destroy(null,(function(e){e?n(e):t(p(void 0,!0))}))}))})),r),v);e.exports=function(e){var t,n=Object.create(g,(o(t={},f,{value:e,writable:!0}),o(t,a,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,u,{value:null,writable:!0}),o(t,l,{value:e._readableState.endEmitted,writable:!0}),o(t,d,{value:function(e,t){var r=n[f].read();r?(n[h]=null,n[a]=null,n[c]=null,e(p(r,!1))):(n[a]=e,n[c]=t)},writable:!0}),t));return n[h]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[c];return null!==t&&(n[h]=null,n[a]=null,n[c]=null,t(e)),void(n[u]=e)}var r=n[a];null!==r&&(n[h]=null,n[a]=null,n[c]=null,r(p(void 0,!0))),n[l]=!0})),e.on("readable",y.bind(null,n)),n}},327:(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var c=n(764).Buffer,u=n(361).inspect,l=u&&u.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t,n,r,i=c.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,n=i,r=s,c.prototype.copy.call(t,n,r),s+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:l,value:function(e,t){return u(this,i(i({},t),{},{depth:0,customInspect:!1}))}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()},195:(e,t,n)=>{"use strict";var r=n(155);function i(e,t){s(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,a=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return a||c?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(s,this,e)):r.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(o,n):(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t?(r.nextTick(o,n),t(e)):r.nextTick(o,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},610:(e,t,n)=>{"use strict";var r=n(281).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(o||i);var s=n.readable||!1!==n.readable&&t.readable,a=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||l()},u=t._writableState&&t._writableState.finished,l=function(){a=!1,u=!0,s||o.call(t)},h=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,h=!0,a||o.call(t)},f=function(e){o.call(t,e)},p=function(){var e;return s&&!h?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):a&&!u?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",l),t.on("abort",p),t.req?m():t.on("request",m)):a&&!t._writableState&&(t.on("end",c),t.on("close",c)),t.on("end",d),t.on("finish",l),!1!==n.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",f),t.removeListener("close",p)}}},167:e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},946:(e,t,n)=>{"use strict";var r,i=n(281).q,o=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function c(e){e()}function u(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var l,h=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var d=t.map((function(e,i){var o=i<t.length-1;return function(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===r&&(r=n(610)),r(e,{readable:t,writable:i},(function(e){if(e)return o(e);a=!0,o()}));var c=!1;return function(t){if(!a&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new s("pipe"))}}(e,o,i>0,(function(e){l||(l=e),e&&d.forEach(c),o||(d.forEach(c),h(l))}))}));return t.reduce(u)}},457:(e,t,n)=>{"use strict";var r=n(281).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},503:(e,t,n)=>{e.exports=n(187).EventEmitter},473:(e,t,n)=>{(t=e.exports=n(481)).Stream=t,t.Readable=t,t.Writable=n(229),t.Duplex=n(753),t.Transform=n(605),t.PassThrough=n(725),t.finished=n(610),t.pipeline=n(946)},509:(e,t,n)=>{var r=n(764),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},853:(e,t,n)=>{const r=n(227)("simple-peer"),i=n(177),o=n(798),s=n(473),a=n(375),c=n(114),{Buffer:u}=n(764),l=65536;function h(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}class d extends s.Duplex{constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this._id=o(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||o(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||d.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},d.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:i(),!this._wrtc)throw"undefined"==typeof window?c(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):c(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void this.destroy(c(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((e=>{this.destroy(c(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach((e=>{this.addStream(e)})),this._pc.ontrack=e=>{this._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((e=>{this._addIceCandidate(e)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((e=>{this.destroy(c(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(c(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch((e=>{!t.address||t.address.endsWith(".local")?("Ignoring unsupported ICE candidate.",console.warn("Ignoring unsupported ICE candidate.")):this.destroy(c(e,"ERR_ADD_ICE_CANDIDATE"))}))}send(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(c(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((t=>{this.addTrack(t,e)}))}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const n=this._senderMap.get(e)||new Map;let r=n.get(t);if(r)throw r.removed?c(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):c(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}replaceTrack(e,t,n){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw c(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(c(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw c(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(c(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((t=>{this.removeTrack(t,e)}))}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,a((()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1})))}negotiate(){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,(()=>{}))}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),a((()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()})))}_setupData(e){if(!e.channel)return this.destroy(c(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=l),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{const t=e.error instanceof Error?e.error:new Error(`Datachannel error: ${e.message} ${e.filename}:${e.lineno}:${e.colno}`);this.destroy(c(t,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1}),5e3)}_read(){}_write(e,t,n){if(this.destroyed)return n(c(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.destroy(c(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>l?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout((()=>this.destroy()),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=h(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})};this._pc.setLocalDescription(e).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(c(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(c(e,"ERR_CREATE_OFFER"))}))}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=h(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()};this._pc.setLocalDescription(e).then((()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(c(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(c(e,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(c(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(c(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(c(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((t=>{Object.assign(e,t)})),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((n=>{const r=[];n.forEach((e=>{r.push(t(e))})),e(null,r)}),(t=>e(t))):this._pc.getStats.length>0?this._pc.getStats((n=>{if(this.destroyed)return;const r=[];n.result().forEach((e=>{const n={};e.names().forEach((t=>{n[t]=e.stat(t)})),n.id=e.id,n.type=e.type,n.timestamp=e.timestamp,r.push(t(n))})),e(null,r)}),(t=>e(t))):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats(((t,n)=>{if(this.destroyed)return;t&&(n=[]);const r={},i={},o={};let s=!1;n.forEach((e=>{"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(r[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(i[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));const a=e=>{s=!0;let t=i[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let n=r[e.remoteCandidateId];n&&(n.ip||n.address)?(this.remoteAddress=n.ip||n.address,this.remotePort=Number(n.port)):n&&n.ipAddress?(this.remoteAddress=n.ipAddress,this.remotePort=Number(n.portNumber)):"string"==typeof e.googRemoteAddress&&(n=e.googRemoteAddress.split(":"),this.remoteAddress=n[0],this.remotePort=Number(n[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach((e=>{"transport"===e.type&&e.selectedCandidatePairId&&a(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&a(e)})),s||Object.keys(o).length&&!Object.keys(i).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(c(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(e,100)}))};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>l||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=u.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach((t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some((e=>e.id===t.id))||(this._remoteStreams.push(t),a((()=>{this._debug("on stream"),this.emit("stream",t)})))}))}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],r.apply(null,e)}}d.WEBRTC_SUPPORT=!!i(),d.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},d.channelConfig={},e.exports=d},553:(e,t,n)=>{"use strict";var r=n(509).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.s=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},927:(e,t,n)=>{function r(e){try{if(!n.g.localStorage)return!1}catch(e){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},361:()=>{},616:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";function e(e){if(!e)throw new Error("ensureNotFalsy() is falsy");return e}var t={bufferSize:1,refCount:!0},r="abcdefghijklmnopqrstuvwxyz";function i(e=10){for(var t="",n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function o(e){return(e+="").charAt(0).toUpperCase()+e.substr(1)}function s(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0}),Object.freeze(["prototype","__proto__","constructor"]);class a{constructor(e,t){e=this.words=e||[],this.sigBytes=void 0===t?4*e.length:t}toString(e){return(e||c).stringify(this)}concat(e){if(this.clamp(),this.sigBytes%4)for(let t=0;t<e.sigBytes;t++){const n=e.words[t>>>2]>>>24-t%4*8&255;this.words[this.sigBytes+t>>>2]|=n<<24-(this.sigBytes+t)%4*8}else for(let t=0;t<e.sigBytes;t+=4)this.words[this.sigBytes+t>>>2]=e.words[t>>>2];return this.sigBytes+=e.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new a([...this.words])}}const c={stringify(e){const t=[];for(let n=0;n<e.sigBytes;n++){const r=e.words[n>>>2]>>>24-n%4*8&255;t.push((r>>>4).toString(16),(15&r).toString(16))}return t.join("")}},u={parse(e){const t=e.length,n=[];for(let r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a(n,t)}},l=e=>u.parse(unescape(encodeURIComponent(e)));class h{constructor(){this._data=new a,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=16}reset(){this._data=new a,this._nDataBytes=0}_append(e){"string"==typeof e&&(e=l(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_doProcessBlock(e,t){}_process(e){let t,n=this._data.sigBytes/(4*this.blockSize);n=e?Math.ceil(n):Math.max((0|n)-this._minBufferSize,0);const r=n*this.blockSize,i=Math.min(4*r,this._data.sigBytes);if(r){for(let e=0;e<r;e+=this.blockSize)this._doProcessBlock(this._data.words,e);t=this._data.words.splice(0,r),this._data.sigBytes-=i}return new a(t,i)}}class d extends h{update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e)}}const f=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],p=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],m=[];class y extends d{constructor(){super(...arguments),this._hash=new a([...f])}reset(){super.reset(),this._hash=new a([...f])}_doProcessBlock(e,t){const n=this._hash.words;let r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],u=n[6],l=n[7];for(let n=0;n<64;n++){if(n<16)m[n]=0|e[t+n];else{const e=m[n-15],t=(e<<25|e>>>7)^(e<<14|e>>>18)^e>>>3,r=m[n-2],i=(r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10;m[n]=t+m[n-7]+i+m[n-16]}const h=r&i^r&o^i&o,d=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),f=l+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&u)+p[n]+m[n];l=u,u=c,c=a,a=s+f|0,s=o,o=i,i=r,r=f+(d+h)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+l|0}finalize(e){super.finalize(e);const t=8*this._nDataBytes,n=8*this._data.sigBytes;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[14+(n+64>>>9<<4)]=Math.floor(t/4294967296),this._data.words[15+(n+64>>>9<<4)]=t,this._data.sigBytes=4*this._data.words.length,this._process(),this._hash}}var v="undefined"!=typeof crypto&&void 0!==crypto.subtle&&"function"==typeof crypto.subtle.digest?async function(e){var t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.prototype.map.call(new Uint8Array(n),(e=>("00"+e.toString(16)).slice(-2))).join("");return r}:function(e){return Promise.resolve((t=e,(new y).finalize(t).toString()));var t};function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==g(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i),"symbol"===g(o)?o:String(o)),r)}var i,o}function w(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var _=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._parallels=e||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};function E(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var n=e._pHM.get(t);e._hPM.delete(n),e._pHM.delete(t)}e._iC.delete(t)}}function k(e){e._tryIR||0===e._iC.size||(e._tryIR=!0,setTimeout((function(){e.isIdle()?setTimeout((function(){e.isIdle()?(function(e){0!==e._iC.size&&(e._iC.values().next().value._manRes(),setTimeout((function(){return k(e)}),0))}(e),e._tryIR=!1):e._tryIR=!1}),0):e._tryIR=!1}),0))}function S(e=0){return new Promise((t=>setTimeout(t,e)))}_.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,k(this)},wrapCall:function(e){var t,n=this;this.lock();try{t=e()}catch(e){throw this.unlock(),e}return t.then&&"function"==typeof t.then?t.then((function(e){return n.unlock(),e})).catch((function(e){throw n.unlock(),e})):(this.unlock(),t)},requestIdlePromise:function(e){var t,n=this;e=e||{};var r=new Promise((function(e){return t=e}));if(r._manRes=function(){E(n,r),t()},e.timeout){var i=setTimeout((function(){r._manRes()}),e.timeout);r._timeoutObj=i}return this._iC.add(r),k(this),r},cancelIdlePromise:function(e){E(this,e)},requestIdleCallback:function(e,t){var n=this._lHN++,r=this.requestIdlePromise(t);return this._hPM.set(n,r),this._pHM.set(r,n),r.then((function(){return e()})),n},cancelIdleCallback:function(e){var t=this._hPM.get(e);this.cancelIdlePromise(t)},clear:function(){var e=this;this._iC.forEach((function(t){return E(e,t)})),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};var x=Promise.resolve(!0),C=Promise.resolve(!1),R=Promise.resolve(null),O=Promise.resolve();function I(e=1e4){return"function"==typeof requestIdleCallback?new Promise((t=>{requestIdleCallback((()=>t()),{timeout:e})})):S(0)}var P=O,D=1;function T(){return{lwt:D}}function A(e){return Object.assign({},e)}function j(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort(((e,t)=>"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"object"==typeof e?1:-1)).map((e=>j(e,t)));if("object"==typeof e&&!Array.isArray(e)){var n={};return Object.keys(e).sort(((e,t)=>e.localeCompare(t))).forEach((r=>{n[r]=j(e[r],t)})),n}return e}var M=function e(t){if(!t)return t;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){for(var n=new Array(t.length),r=n.length;r--;)n[r]=e(t[r]);return n}var i={};for(var o in t)i[o]=e(t[o]);return i};function N(e,t,n){return Object.defineProperty(e,t,{get:function(){return n}}),n}function B(e){var t=e.split("-"),n="RxDB";return t.forEach((e=>{n+=o(e)})),n+="Plugin",new Error("You are using a function which must be overwritten by a plugin.\n        You should either prevent the usage of this function or add the plugin via:\n            import { "+n+" } from 'rxdb/plugins/"+e+"';\n            addRxPlugin("+n+");\n        ")}function L(e){return{name:e.name,message:e.message,rxdb:e.rxdb,parameters:e.parameters,code:e.code,stack:e.stack?e.stack.replace(/\n/g," \n "):void 0}}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}function $(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,F(e,t)}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function K(e,t,n){return K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&F(i,n.prototype),i},K.apply(null,arguments)}function U(e){var t="function"==typeof Map?new Map:void 0;return U=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return K(e,arguments,q(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),F(n,e)},U(e)}var W={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"RxDB Error-Code "+e+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+e+"\n        "};function H(e,t,n){return"RxError ("+t+"):\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="Given parameters: {\n",t+=Object.keys(e).map((t=>{var n="[object Object]";try{n="errors"===t?e[t].map((e=>JSON.stringify(e,Object.getOwnPropertyNames(e)))):JSON.stringify(e[t],(function(e,t){return void 0===t?null:t}),2)}catch(e){}return t+":"+n})).join("\n"),t+="}")}(n)}var z=function(e){function t(t,n,r={}){var i,o=H(n,t,r);return(i=e.call(this,o)||this).code=t,i.message=o,i.parameters=r,i.rxdb=!0,i}return $(t,e),t.prototype.toString=function(){return this.message},w(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}]),t}(U(Error)),Q=function(e){function t(t,n,r={}){var i,o=H(n,t,r);return(i=e.call(this,o)||this).code=t,i.message=o,i.parameters=r,i.rxdb=!0,i}return $(t,e),t.prototype.toString=function(){return this.message},w(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}]),t}(U(TypeError));function V(e,t){return new z(e,W.tunnelErrorMessage(e),t)}function Y(e,t){return new Q(e,W.tunnelErrorMessage(e),t)}function G(e){return!(!e||409!==e.status)&&e}var J={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function X(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(r=n;0!=r--;)if(!X(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var i=Object.keys(e);if((n=i.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!=r--;){var o=i[r];if(!X(e[o],t[o]))return!1}return!0}return e!=e&&t!=t}function Z(e){return Array.isArray(e)?e.slice(0):[e]}function ee(e){return Array.isArray(e)}function te(e){return null!=e}function ne(e,t){var n=0,r=-1;for(var i of e){if(!t(i,r+=1))break;n+=1}return n}function re(e,t){for(var n=t.length,r=0;r<n;++r){var i=t[r];e.push(i)}}var ie={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function oe(e,t){ie[e]&&ie[e].forEach((e=>e(t)))}function se(e,t){return Promise.all(ie[e].map((e=>e(t))))}var ae=/\./g,ce=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},ue=new Set(["__proto__","prototype","constructor"]),le=new Set("0123456789");function he(e,t){if("number"!=typeof t&&Array.isArray(e)){var n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}function de(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!ce(e)||"string"!=typeof t)return void 0===n?e:n;var r=function(e){var t=[],n="",r="start",i=!1;for(var o of e)switch(o){case"\\":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");i&&(n+=o),r="property",i=!i;break;case".":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="property";break}if(i){i=!1,n+=o;break}if(ue.has(n))return[];t.push(n),n="",r="property";break;case"[":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="index";break}if(i){i=!1,n+=o;break}if("property"===r){if(ue.has(n))return[];t.push(n),n=""}r="index";break;case"]":if("index"===r){t.push(Number.parseInt(n,10)),n="",r="indexEnd";break}if("indexEnd"===r)throw new Error("Invalid character after an index");default:if("index"===r&&!le.has(o))throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");"start"===r&&(r="property"),i&&(i=!1,n+="\\"),n+=o}switch(i&&(n+="\\"),r){case"property":if(ue.has(n))return[];t.push(n);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}(t);if(0===r.length)return n;for(var i=0;i<r.length;i++){var o=r[i];if(null==(e=he(e,o)?i===r.length-1?void 0:null:e[o])){if(i!==r.length-1)return n;break}}return void 0===e?n:e}function fe(e,t){return de(e,s("properties."+t.replace(ae,".properties.")))}function pe(e,t,n){if("string"==typeof t.primaryKey)return n;var r=ye(t,n),i=n[e];if(i&&i!==r)throw V("DOC19",{args:{documentData:n,existingPrimary:i,newPrimary:r},schema:t});return n[e]=r,n}function me(e){return"string"==typeof e?e:e.key}function ye(e,t){if("string"==typeof e.primaryKey)return t[e.primaryKey];var n=e.primaryKey;return n.fields.map((e=>{var n=de(t,e);if(void 0===n)throw V("DOC18",{args:{field:e,documentData:t}});return n})).join(n.separator)}function ve(e){var t=me((e=A(e)).primaryKey);e.properties=A(e.properties),e.additionalProperties=!1,e.hasOwnProperty("keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=ge,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var n=be(e);return re(e.required,n),e.required=e.required.filter((e=>!e.includes("."))).filter(((e,t,n)=>n.indexOf(e)===t)),e.version=e.version||0,e.indexes&&(e.indexes=e.indexes.map((e=>{var n=ee(e)?e.slice(0):[e];if(!n.includes(t)){var r=n.slice(0);return r.push(t),r}return n}))),e}var ge={type:"object",properties:{lwt:{type:"number",minimum:D,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function be(e){var t=Object.keys(e.properties).filter((t=>e.properties[t].final)),n=me(e.primaryKey);return t.push(n),"string"!=typeof e.primaryKey&&e.primaryKey.fields.forEach((e=>t.push(e))),t}var we=function(){function e(e,t){this.jsonSchema=e,this.hashFunction=t,this.indexes=function(e){return(e.indexes||[]).map((e=>ee(e)?e:[e]))}(this.jsonSchema),this.primaryPath=me(this.jsonSchema.primaryKey),this.finalFields=be(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(e,t){this.finalFields.forEach((n=>{if(!X(e[n],t[n]))throw V("DOC9",{dataBefore:e,dataAfter:t,fieldName:n,schema:this.jsonSchema})}))},t.getDocumentPrototype=function(){var e={},t=fe(this.jsonSchema,"");return Object.keys(t).forEach((t=>{var n=t;e.__defineGetter__(t,(function(){if(this.get&&"function"==typeof this.get)return this.get(n)})),Object.defineProperty(e,t+"$",{get:function(){return this.get$(n)},enumerable:!1,configurable:!1}),Object.defineProperty(e,t+"_",{get:function(){return this.populate(n)},enumerable:!1,configurable:!1})})),N(this,"getDocumentPrototype",(()=>e)),e},t.getPrimaryOfDocumentData=function(e){return ye(this.jsonSchema,e)},w(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var e={};return Object.entries(this.jsonSchema.properties).filter((([,e])=>e.hasOwnProperty("default"))).forEach((([t,n])=>e[t]=n.default)),N(this,"defaultValues",e)}},{key:"hash",get:function(){return N(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}]),e}();var _e=function(e,t){return _e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},_e(e,t)};function Ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}_e(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ke(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function Se(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function xe(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function Ce(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function Re(e){return this instanceof Re?(this.v=e,this):new Re(e)}function Oe(e){return"function"==typeof e}function Ie(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Pe=Ie((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function De(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Te=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=Se(o),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(Oe(c))try{c()}catch(e){i=e instanceof Pe?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=Se(u),h=l.next();!h.done;h=l.next()){var d=h.value;try{Me(d)}catch(e){i=null!=i?i:[],e instanceof Pe?i=Ce(Ce([],xe(i)),xe(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(i)throw new Pe(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Me(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&De(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&De(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),Ae=Te.EMPTY;function je(e){return e instanceof Te||e&&"closed"in e&&Oe(e.remove)&&Oe(e.add)&&Oe(e.unsubscribe)}function Me(e){Oe(e)?e():e.unsubscribe()}var Ne={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Be={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Be.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,Ce([e,t],xe(n))):setTimeout.apply(void 0,Ce([e,t],xe(n)))},clearTimeout:function(e){var t=Be.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Le(e){Be.setTimeout((function(){var t=Ne.onUnhandledError;if(!t)throw e;t(e)}))}function Fe(){}var $e=qe("C",void 0,void 0);function qe(e,t,n){return{kind:e,value:t,error:n}}var Ke=null;function Ue(e){if(Ne.useDeprecatedSynchronousErrorHandling){var t=!Ke;if(t&&(Ke={errorThrown:!1,error:null}),e(),t){var n=Ke,r=n.errorThrown,i=n.error;if(Ke=null,r)throw i}}else e()}var We=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,je(t)&&t.add(n)):n.destination=Je,n}return Ee(t,e),t.create=function(e,t,n){return new Ve(e,t,n)},t.prototype.next=function(e){this.isStopped?Ge(function(e){return qe("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ge(qe("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ge($e,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Te),He=Function.prototype.bind;function ze(e,t){return He.call(e,t)}var Qe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ye(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ye(e)}else Ye(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ye(e)}},e}(),Ve=function(e){function t(t,n,r){var i,o,s=e.call(this)||this;return Oe(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Ne.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&ze(t.next,o),error:t.error&&ze(t.error,o),complete:t.complete&&ze(t.complete,o)}):i=t,s.destination=new Qe(i),s}return Ee(t,e),t}(We);function Ye(e){var t;Ne.useDeprecatedSynchronousErrorHandling?(t=e,Ne.useDeprecatedSynchronousErrorHandling&&Ke&&(Ke.errorThrown=!0,Ke.error=t)):Le(e)}function Ge(e,t){var n=Ne.onStoppedNotification;n&&Be.setTimeout((function(){return n(e,t)}))}var Je={closed:!0,next:Fe,error:function(e){throw e},complete:Fe},Xe="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ze(e){return e}var et=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,i=this,o=(r=e)&&r instanceof We||function(e){return e&&Oe(e.next)&&Oe(e.error)&&Oe(e.complete)}(r)&&je(r)?e:new Ve(e,t,n);return Ue((function(){var e=i,t=e.operator,n=e.source;o.add(t?t.call(o,n):n?i._subscribe(o):i._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=tt(t))((function(t,r){var i=new Ve({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Xe]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?Ze:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=tt(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function tt(e){var t;return null!==(t=null!=e?e:Ne.Promise)&&void 0!==t?t:Promise}var nt=Ie((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),rt=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ee(t,e),t.prototype.lift=function(e){var t=new it(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new nt},t.prototype.next=function(e){var t=this;Ue((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=Se(t.currentObservers),o=i.next();!o.done;o=i.next())o.value.next(e)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Ue((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Ue((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?Ae:(this.currentObservers=null,o.push(e),new Te((function(){t.currentObservers=null,De(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new et;return e.source=this,e},t.create=function(e,t){return new it(e,t)},t}(et),it=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Ee(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Ae},t}(rt);function ot(e){return function(t){if(function(e){return Oe(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function st(e,t,n,r,i){return new at(e,t,n,r,i)}var at=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Ee(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(We);function ct(e,t){return ot((function(n,r){var i=0;n.subscribe(st(r,(function(n){r.next(e.call(t,n,i++))})))}))}var ut=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function lt(e){return Oe(null==e?void 0:e.then)}function ht(e){return Oe(e[Xe])}function dt(e){return Symbol.asyncIterator&&Oe(null==e?void 0:e[Symbol.asyncIterator])}function ft(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var pt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function mt(e){return Oe(null==e?void 0:e[pt])}function yt(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{!function(e){e.value instanceof Re?Promise.resolve(e.value.v).then(c,u):l(o[0][2],e)}(i[e](t))}catch(e){l(o[0][3],e)}}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,(function(){var t,n,r;return ke(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,Re(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,Re(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,Re(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function vt(e){return Oe(null==e?void 0:e.getReader)}function gt(e){if(e instanceof et)return e;if(null!=e){if(ht(e))return i=e,new et((function(e){var t=i[Xe]();if(Oe(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(ut(e))return r=e,new et((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(lt(e))return n=e,new et((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Le)}));if(dt(e))return bt(e);if(mt(e))return t=e,new et((function(e){var n,r;try{for(var i=Se(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}));if(vt(e))return bt(yt(e))}var t,n,r,i;throw ft(e)}function bt(e){return new et((function(t){(function(e,t){var n,r,i,o;return function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var s,a;return ke(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Se(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function wt(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function _t(e,t,n){return void 0===n&&(n=1/0),Oe(t)?_t((function(n,r){return ct((function(e,i){return t(n,e,r,i)}))(gt(e(n,r)))}),n):("number"==typeof t&&(n=t),ot((function(t,r){return function(e,t,n,r,i,o,s,a){var c=[],u=0,l=0,h=!1,d=function(){!h||c.length||u||t.complete()},f=function(e){return u<r?p(e):c.push(e)},p=function(e){u++;var i=!1;gt(n(e,l++)).subscribe(st(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{u--;for(;c.length&&u<r;)e=void 0,e=c.shift(),p(e);d()}catch(e){t.error(e)}var e})))};return e.subscribe(st(t,f,(function(){h=!0,d()}))),function(){}}(t,r,e,n)})))}function Et(e,t){return ot((function(n,r){var i=0;n.subscribe(st(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function kt(e,t){var n=e.get(t);if(void 0===n)throw new Error("missing value from map "+t);return n}function St(e,t,n,r){var i=e.get(t);return void 0===i?(i=n(),e.set(t,i)):r&&r(i),i}var xt=0;function Ct(){var e=Date.now();(e+=.01)<=xt&&(e=xt+.01);var t=parseFloat(e.toFixed(2));return xt=t,t}function Rt(e){var t=e.split("-");if(2!==t.length)throw new Error("malformatted revision: "+e);return{height:parseInt(t[0],10),hash:t[1]}}function Ot(e){return parseInt(e.split("-")[0],10)}function It(e,t){var n=t?t._rev:null;return(n?Rt(n).height:0)+1+"-"+e}var Pt="_rxdb_internal";async function Dt(e,t){return(await e.findDocumentsById([t],!1))[0]||void 0}async function Tt(e,t,n){var r=await e.bulkWrite([t],n);if(r.error.length>0)throw r.error[0];return r.success[0]}function At(e){return Object.assign({},...e)}function jt(e,t,n,r){if(r)throw 409===r.status?V("CONFLICT",{collection:e.name,id:t,writeError:r,data:n}):422===r.status?V("VD2",{collection:e.name,id:t,writeError:r,data:n}):r}function Mt(e){return{previous:e.previous,document:Nt(e.document)}}function Nt(e){if(!e._attachments||0===Object.keys(e._attachments).length)return e;var t=A(e);return t._attachments={},Object.entries(e._attachments).forEach((([e,n])=>{var r,i,o;t._attachments[e]=(o=(r=n).data)?{length:(i=o,atob(i).length),digest:r.digest,type:r.type}:r})),t}function Bt(e){var t=A(e);return t._meta=A(e._meta),t}function Lt(t,n,r){W.deepFreezeWhenDevMode(r);var i=me(r.primaryKey),o={originalStorageInstance:n,schema:n.schema,internals:n.internals,collectionName:n.collectionName,databaseName:n.databaseName,options:n.options,bulkWrite(o,s){var a=o.map((e=>function(e){var o=A(e.document);if(o._meta=A(o._meta),W.isDevMode()){o=pe(i,r,o);try{"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}catch(t){throw V("DOC24",{collection:n.collectionName,document:e.document})}e.previous,e.previous&&Object.keys(e.previous._meta).forEach((t=>{if(!e.document._meta.hasOwnProperty(t))throw V("SNH",{dataBefore:e.previous,dataAfter:e.document})}))}return o._meta.lwt=Ct(),o._rev=It(t.token,e.previous),{document:o,previous:e.previous}}(e)));return t.lockedRun((()=>n.bulkWrite(a,s))).then((r=>{var i={error:[],success:r.success.slice(0)},o=r.error.filter((t=>!(409!==t.status||t.writeRow.previous||t.writeRow.document._deleted||!e(t.documentInDb)._deleted)||(i.error.push(t),!1)));if(o.length>0){var a=o.map((e=>({previous:e.documentInDb,document:Object.assign({},e.writeRow.document,{_rev:It(t.token,e.documentInDb)})})));return t.lockedRun((()=>n.bulkWrite(a,s))).then((e=>(re(i.error,e.error),re(i.success,e.success),i)))}return r}))},query:e=>t.lockedRun((()=>n.query(e))),count:e=>t.lockedRun((()=>n.count(e))),info:()=>t.lockedRun((()=>n.info())),findDocumentsById:(e,r)=>t.lockedRun((()=>n.findDocumentsById(e,r))),getAttachmentData:(e,r,i)=>t.lockedRun((()=>n.getAttachmentData(e,r,i))),getChangedDocumentsSince:(r,i)=>t.lockedRun((()=>n.getChangedDocumentsSince(e(r),i))),cleanup:e=>t.lockedRun((()=>n.cleanup(e))),remove:()=>(t.storageInstances.delete(o),t.lockedRun((()=>n.remove()))),close:()=>(t.storageInstances.delete(o),t.lockedRun((()=>n.close()))),changeStream:()=>n.changeStream(),conflictResultionTasks:()=>n.conflictResultionTasks(),resolveConflictResultionTask(e){if(e.output.isEqual)return n.resolveConflictResultionTask(e);var t=A(Object.assign({},e.output.documentData,{_meta:T(),_rev:"",_attachments:{}}));return delete t._meta,delete t._rev,delete t._attachments,n.resolveConflictResultionTask({id:e.id,output:{isEqual:!1,documentData:t}})}};return t.storageInstances.add(o),o}function Ft(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}var $t="collection",qt="storage-token",Kt=ve({version:0,title:"RxInternalDocument",primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[$t,qt,"rx-migration-status","OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function Ut(e,t){return ye(Kt,{key:e,context:t})}async function Wt(e,t){var n=e.prepareQuery(t.schema,{selector:{context:$t},sort:[{id:"asc"}],skip:0});return(await t.query(n)).documents}var Ht="storageToken",zt=Ut(Ht,qt);async function Qt(t,n,r){if(t.schema.version!==r.version)throw V("SNH",{schema:r,version:t.schema.version,name:t.name,collection:t,args:{storageCollectionName:n}});for(var i=Ut(Vt(t.name,t.schema.jsonSchema),$t);;){var o=await Dt(t.database.internalStore,i),s=M(e(o));if(s.data.connectedStorages.find((e=>e.collectionName===n&&e.schema.version===r.version)))return;s.data.connectedStorages.push({collectionName:n,schema:r});try{await Tt(t.database.internalStore,{previous:e(o),document:s},"add-connected-storage-to-collection")}catch(e){if(!G(e))throw e}}}function Vt(e,t){return e+"-"+t.version}function Yt(e,t){return t=function(e,t){for(var n=Object.keys(e.defaultValues),r=0;r<n.length;++r){var i=n[r];t.hasOwnProperty(i)&&void 0!==t[i]||(t[i]=e.defaultValues[i])}return t}(e,t=A(t)),(t=pe(e.primaryPath,e.jsonSchema,t))._meta=T(),t.hasOwnProperty("_deleted")||(t._deleted=!1),t.hasOwnProperty("_attachments")||(t._attachments={}),t.hasOwnProperty("_rev")||(t._rev=""),t}async function Gt(e,t,n,r,i,o,s){var a=(await Wt(e.statics,t)).filter((e=>e.data.name===i)),c=[];a.forEach((e=>{c.push({collectionName:e.data.name,schema:e.data.schema,isCollection:!0}),e.data.connectedStorages.forEach((e=>c.push({collectionName:e.collectionName,isCollection:!1,schema:e.schema})))}));var u=new Set;if(c=c.filter((e=>{var t=e.collectionName+"||"+e.schema.version;return!u.has(t)&&(u.add(t),!0)})),await Promise.all(c.map((async t=>{var s=await e.createStorageInstance({collectionName:t.collectionName,databaseInstanceToken:n,databaseName:r,multiInstance:!1,options:{},schema:t.schema,password:o,devMode:W.isDevMode()});await s.remove(),t.isCollection&&await se("postRemoveRxCollection",{storage:e,databaseName:r,collectionName:i})}))),s){var l=a.map((e=>{var t=Bt(e);return t._deleted=!0,t._meta.lwt=Ct(),t._rev=It(n,e),{previous:e,document:t}}));await t.bulkWrite(l,"rx-database-remove-collection-all")}}var Jt=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Ee(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(rt),Xt=Ie((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Zt(e,t){var n="object"==typeof t;return new Promise((function(r,i){var o=new Ve({next:function(e){r(e),o.unsubscribe()},error:i,complete:function(){n?r(t.defaultValue):i(new Xt)}});e.subscribe(o)}))}function en(e){return void 0===e&&(e=1/0),_t(Ze,e)}var tn=new et((function(e){return e.complete()}));function nn(e){return e[e.length-1]}function rn(e){return(t=nn(e))&&Oe(t.schedule)?e.pop():void 0;var t}function on(e,t){return"number"==typeof nn(e)?e.pop():t}function sn(e,t){return void 0===t&&(t=0),ot((function(n,r){n.subscribe(st(r,(function(n){return wt(r,e,(function(){return r.next(n)}),t)}),(function(){return wt(r,e,(function(){return r.complete()}),t)}),(function(n){return wt(r,e,(function(){return r.error(n)}),t)})))}))}function an(e,t){return void 0===t&&(t=0),ot((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function cn(e,t){if(!e)throw new Error("Iterable cannot be null");return new et((function(n){wt(n,t,(function(){var r=e[Symbol.asyncIterator]();wt(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function un(e,t){return t?function(e,t){if(null!=e){if(ht(e))return function(e,t){return gt(e).pipe(an(t),sn(t))}(e,t);if(ut(e))return function(e,t){return new et((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(lt(e))return function(e,t){return gt(e).pipe(an(t),sn(t))}(e,t);if(dt(e))return cn(e,t);if(mt(e))return function(e,t){return new et((function(n){var r;return wt(n,t,(function(){r=e[pt](),wt(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return Oe(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(vt(e))return function(e,t){return cn(yt(e),t)}(e,t)}throw ft(e)}(e,t):gt(e)}function ln(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return en(1)(un(e,rn(e)))}function hn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rn(e);return ot((function(t,r){(n?ln(e,t,n):ln(e,t)).subscribe(r)}))}var dn={now:function(){return(dn.delegate||Date).now()},delegate:void 0},fn=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=dn);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return Ee(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,o=n._infiniteTimeWindow,s=n._timestampProvider,a=n._windowTime;r||(i.push(t),!o&&i.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,o=(i?1:2)*t;if(t<1/0&&o<r.length&&r.splice(0,r.length-o),!i){for(var s=n.now(),a=0,c=1;c<r.length&&r[c]<=s;c+=2)a=c;a&&r.splice(0,a+1)}},t}(rt);function pn(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var i=new Ve({next:function(){i.unsubscribe(),e()}});return gt(t.apply(void 0,Ce([],xe(n)))).subscribe(i)}}else e()}function mn(e,t,n){var r,i,o,s,a=!1;return e&&"object"==typeof e?(r=e.bufferSize,s=void 0===r?1/0:r,i=e.windowTime,t=void 0===i?1/0:i,a=void 0!==(o=e.refCount)&&o,n=e.scheduler):s=null!=e?e:1/0,function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new rt}:t,r=e.resetOnError,i=void 0===r||r,o=e.resetOnComplete,s=void 0===o||o,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,r,o,a=0,u=!1,l=!1,h=function(){null==r||r.unsubscribe(),r=void 0},d=function(){h(),t=o=void 0,u=l=!1},f=function(){var e=t;d(),null==e||e.unsubscribe()};return ot((function(e,p){a++,l||u||h();var m=o=null!=o?o:n();p.add((function(){0!=--a||l||u||(r=pn(f,c))})),m.subscribe(p),!t&&a>0&&(t=new Ve({next:function(e){return m.next(e)},error:function(e){l=!0,h(),r=pn(d,i,e),m.error(e)},complete:function(){u=!0,h(),r=pn(d,s),m.complete()}}),gt(e).subscribe(t))}))(e)}}({connector:function(){return new fn(s,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function yn(e,t){return void 0===t&&(t=Ze),e=null!=e?e:vn,ot((function(n,r){var i,o=!0;n.subscribe(st(r,(function(n){var s=t(n);!o&&e(i,s)||(o=!1,i=s,r.next(n))})))}))}function vn(e,t){return e===t}const gn=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},bn=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},wn=e=>{const t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},_n=e=>{const t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},En=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);const t=e.queryParams.primaryKey,n=e.previousResults;for(let r=0;r<n.length;r++)if(n[r][t]===e.changeEvent.id){n.splice(r,1);break}},kn=e=>{const t=e.changeEvent.id,n=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,n)}else{const n=e.previousResults.find((n=>n[e.queryParams.primaryKey]===t));if(n)return}!function(e,t,n,r){var i,o=e.length,s=o-1,a=0;if(0===o)return e.push(t),0;for(;r<=s;)n(i=e[a=r+(s-r>>1)],t)<=0?r=a+1:s=a-1;n(i,t)<=0&&a++,e.splice(a,0,t)}(e.previousResults,n,e.queryParams.sortComparator,0)},Sn=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],xn={doNothing:e=>{},insertFirst:gn,insertLast:bn,removeFirstItem:wn,removeLastItem:_n,removeFirstInsertLast:e=>{wn(e),bn(e)},removeLastInsertFirst:e=>{_n(e),gn(e)},removeFirstInsertFirst:e=>{wn(e),gn(e)},removeLastInsertLast:e=>{_n(e),bn(e)},removeExisting:En,replaceExisting:e=>{const t=e.changeEvent.doc,n=e.queryParams.primaryKey,r=e.previousResults;for(let i=0;i<r.length;i++)if(r[i][n]===e.changeEvent.id){r[i]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},alwaysWrong:e=>{const t={_id:"wrongHuman"+(new Date).getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},insertAtSortPosition:kn,removeExistingAndInsertAtSortPosition:e=>{En(e),kn(e)},runFullQueryAgain:e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},unknownAction:e=>{throw new Error("Action unknownAction should never be called")}};function Cn(e){return e?"1":"0"}function Rn(e,t){const n=[];for(let r=0,i=e.length;r<i;r+=t)n.push(e.substring(r,r+t));return n}!function(e=6){let t="";for(let n=0;n<e;n++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()))}(4);const On=40;function In(e){return e.charCodeAt(0)-On}function Pn(e){return e[e.length-1]}function Dn(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!function(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}(e)||"string"!=typeof t)return void 0===n?e:n;const r=t.split(".");if(0===r.length)return n;for(let t=0;t<r.length;t++){const i=r[t];if(null==(e=Tn(e,i)?t===r.length-1?void 0:null:e[i])){if(t!==r.length-1)return n;break}}return void 0===e?n:e}function Tn(e,t){if("number"!=typeof t&&Array.isArray(e)){const n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}const An=e=>!!e.queryParams.limit,jn={0:e=>"INSERT"===e.changeEvent.operation,1:e=>"UPDATE"===e.changeEvent.operation,2:e=>"DELETE"===e.changeEvent.operation,3:An,4:e=>1===e.queryParams.limit,5:e=>!!(e.queryParams.skip&&e.queryParams.skip>0),6:e=>0===e.previousResults.length,7:e=>An(e)&&e.previousResults.length>=e.queryParams.limit,8:e=>{const t=e.previousResults[0];return!(!t||t[e.queryParams.primaryKey]!==e.changeEvent.id)},9:e=>{const t=Pn(e.previousResults);return!(!t||t[e.queryParams.primaryKey]!==e.changeEvent.id)},10:e=>{const t=e.queryParams.sortFields,n=e.changeEvent.previous,r=e.changeEvent.doc;if(!r)return!1;if(!n)return!0;for(let e=0;e<t.length;e++){const i=t[e];if(Dn(n,i)!==Dn(r,i))return!0}return!1},11:e=>{const t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{const n=e.queryParams.primaryKey,r=e.previousResults;for(let e=0;e<r.length;e++)if(r[e][n]===t)return!0;return!1}},12:e=>{const t=e.changeEvent.previous;if(!t)return!1;const n=e.previousResults[0];return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)<0)},13:e=>{const t=e.changeEvent.previous;if(!t)return!1;const n=Pn(e.previousResults);return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)>0)},14:e=>{const t=e.changeEvent.doc;if(!t)return!1;const n=e.previousResults[0];return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)<0)},15:e=>{const t=e.changeEvent.doc;if(!t)return!1;const n=Pn(e.previousResults);return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)>0)},16:e=>{const t=e.changeEvent.previous;return!!t&&e.queryParams.queryMatcher(t)},17:e=>{const t=e.changeEvent.doc;return!!t&&e.queryParams.queryMatcher(t)}};let Mn;const Nn=e=>function(e,t,n){let r=e,i=e.l;for(;;){if(r=r[Cn(t[i](n))],"number"==typeof r||"string"==typeof r)return r;i=r.l}}((Mn||(Mn=function(e){const t=new Map,n=2+2*parseInt(e.charAt(0)+e.charAt(1),10),r=Rn(e.substring(2,n),2);for(let e=0;e<r.length;e++){const n=r[e],i=n.charAt(0),o=In(n.charAt(1));t.set(i,o)}const i=Rn(e.substring(n,662),4);for(let e=0;e<i.length;e++){const n=i[e],r=n.charAt(0),o=n.charAt(1),s=n.charAt(2),a=In(n.charAt(3));if(!t.has(o))throw new Error("missing node with id "+o);if(!t.has(s))throw new Error("missing node with id "+s);const c={l:a,0:t.get(o),1:t.get(s)};t.set(r,c)}const o=e.slice(-3),s=o.charAt(0),a=o.charAt(1);return{l:In(o.charAt(2)),0:t.get(s),1:t.get(a)}}("14a1b,c+d2e5f0g/h.i4j*k-l)m(n6obh9pce9qnh9rad9scm9tae9uan9vbf9wbe9xbn9ycg9zck9{cn9|nd9}ne9~nf9ng9¡nm9¢nk9£mh9¤mi9¥mj9¦mk9§ml9¨mn9©mc8ª¤{8«¥z8¬¨s8­¨n8®mn8¯¨¡8°¨m8±pz7²ª«7³{z7´­®7µ}n7¶¤¥7·¨m7¸wo6¹µ}6ºnq6»²¬6¼tu6½wx6¾´¯6¿µn6À®¯6Á¶§6Â·£6Ã¶¨6Ä·¨6Åm¦6Æm¨6Ç¤¥5È¨m5Ém©4Êm®4ËÇ§4ÌÈ£4ÍÇ¬4ÎÃ»4ÏÈ¯4ÐÄ¾4Ñm¦4Òm¯4ÓÆÀ4Ôma3Õmn3ÖÉa3×Ên3ØËr3ÙÁt3ÚÌ|3ÛÂ¹3ÜÍr3ÝÎ¼3ÞÏ|3ßÐ¿3àØÙ2áv¸2ây±2ãÚÛ2ä~º2åµ2æÜÝ2çv½2èy³2éz{2êÞß2ë~n2ìn2íÑÅ2îÒÓ2ï¢n2ðÔb1ñÕn1òÖb1ó×n1ôàá1õâz1öãä1÷æç1øèé1ùêë1úðc0ûñn0üòc0ýón0þmn0ÿÊn0Āôõ0āöå0Ă÷ø0ăùì0Ąíï0ąîï0Ćúû/ćüý/ĈĀā/ĉĂă/ĊÁÂ/ċÃÄ/Čúm.čüm.ĎĆm.ďćm.Đþm.đÿm.ĒĀ§.ēĂ°.ĔĈ§.ĕĉ°.ĖĄ§.ėą°.ĘÁ§.ęÃ¨.ĚĊ§.ěċ¨.ĜÅ§.ĝÆ¨.ĞČč-ğĎď-ĠĐđ-ġĒē-ĢĔĕ-ģĖė-ĤĘę-ĥĚě-ĦĜĝ-ħğĠ,ĨĢģ,ĩĥĦ,ĪĞħ+īġĨ+ĬĤĩ+ĭĪī)ĭĬ(")),Mn),jn,e);function Bn(e){return e.documentData?e.documentData:e.previousDocumentData}var Ln=String.fromCharCode(65535),Fn=Number.MIN_VALUE;function $n(e,t){var n=me(e.primaryKey),r=t.selector,i=e.indexes?e.indexes.slice(0):[];t.index?i=[t.index]:i.push([n]);var o,s=t.sort.map((e=>Object.keys(e)[0])).join(","),a=!!t.sort.find((e=>"desc"===Object.values(e)[0])),c=-1;return i.forEach((e=>{var n=!0,i=!0,u=e.map((e=>{var t=r[e],o=t?Object.keys(t):[],s={};return t&&o.length?o.forEach((e=>{if(qn.has(e)){var n=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t};case"$lte":return{endKey:t};case"$gte":return{startKey:t};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);s=Object.assign(s,n)}})):s={startKey:i?Fn:Ln,endKey:n?Ln:Fn,inclusiveStart:!0,inclusiveEnd:!0},void 0===s.startKey&&(s.startKey=Fn),void 0===s.endKey&&(s.endKey=Ln),void 0===s.inclusiveStart&&(s.inclusiveStart=!0),void 0===s.inclusiveEnd&&(s.inclusiveEnd=!0),i&&!s.inclusiveStart&&(i=!1),n&&!s.inclusiveEnd&&(n=!1),s})),l={index:e,startKeys:u.map((e=>e.startKey)),endKeys:u.map((e=>e.endKey)),inclusiveEnd:n,inclusiveStart:i,sortFieldsSameAsIndexFields:!a&&s===e.join(","),selectorSatisfiedByIndex:Wn(e,t.selector)},h=function(e,t,n){var r=0,i=e=>{e>0&&(r+=e)};return i(10*ne(n.startKeys,(e=>e!==Fn&&e!==Ln))),i(10*ne(n.startKeys,(e=>e!==Ln&&e!==Fn))),i(10*ne(n.startKeys,((e,t)=>e===n.endKeys[t]))*1.5),i(n.sortFieldsSameAsIndexFields?5:0),r}(0,0,l);(h>0&&h>c||t.index)&&(c=h,o=l)})),o||(o={index:[n],startKeys:[Fn],endKeys:[Ln],inclusiveEnd:!0,inclusiveStart:!0,sortFieldsSameAsIndexFields:!a&&s===n,selectorSatisfiedByIndex:Wn([n],t.selector)}),o}var qn=new Set(["$eq","$gt","$gte","$lt","$lte"]),Kn=new Set(["$eq","$gt","$gte"]),Un=new Set(["$eq","$lt","$lte"]);function Wn(e,t){var n,r=Object.entries(t).find((([t,n])=>!e.includes(t)||Object.entries(n).find((([e,t])=>!qn.has(e)))));if(r)return!1;var i,o=e.find((e=>{var r=t[e];if(!r)return!1;var i=Object.keys(r).find((e=>Kn.has(e)));return!(!n||!i)||("$eq"!==i&&(n=i),!1)}));if(o)return!1;var s=e.find((e=>{var n=t[e];if(!n)return!1;var r=Object.keys(n).find((e=>Un.has(e)));return!(!i||!r)||("$eq"!==r&&(i=r),!1)}));if(s)return!1;var a=new Set(Object.keys(t));for(var c of e){if(0===a.size)break;if(!a.has(c))return!1;a.delete(c)}return!0}const Hn=Number.MAX_SAFE_INTEGER,zn=Number.MIN_SAFE_INTEGER,Qn=Symbol("missing"),Vn=Object.freeze(new Error("mingo: cycle detected while processing object/array")),Yn=Object.getPrototypeOf([]),Gn=Object.getPrototypeOf({}),Jn=/^\[object ([a-zA-Z0-9]+)\]$/;class Xn{}class Zn{}const er=e=>null===e?Xn:void 0===e?Zn:e.constructor,tr=e=>{const t=function(e){const t=new Set,n=e=>{const r=er(e);if(sr.has(r))return sr.get(r)(e);const i=r===Object?"":r.name;if(wr(e.toJSON))return`${i}(${JSON.stringify(e)})`;if(t.has(e))throw Vn;t.add(e);try{if(r===Array)return"["+e.map(n).join(",")+"]";if(r!==Object){const[t,r]=Ar(e);if(mr(e))return`${i}${n([...e,t])}`;e=t}const t=Object.keys(e);return t.sort(),`${i}{`+t.map((t=>`${t}:${n(e[t])}`)).join(",")+"}"}finally{t.delete(e)}};return n(e)}(e);let n=0,r=t.length;for(;r;)n=(n<<5)-n^t.charCodeAt(--r);return n>>>0},nr=new Set(["null","undefined","boolean","number","string","date","regexp"]),rr=new Set([Zn,Xn,Boolean,String,Number]),ir=e=>e.toString(),or=e=>`${er(e).name}[${e.toString()}]`,sr=new Map([[Number,ir],[Boolean,ir],[RegExp,ir],[Function,ir],[Symbol,ir],[BigInt,e=>"0x"+e.toString(16)],[Date,e=>e.toISOString()],[String,JSON.stringify],[Xn,e=>"null"],[Zn,e=>"undefined"],[Int8Array,or],[Uint8Array,or],[Uint8ClampedArray,or],[Int16Array,or],[Uint16Array,or],[Int32Array,or],[Uint32Array,or],[Float32Array,or],[Float64Array,or],[BigInt64Array,or],[BigUint64Array,or]]),ar={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},cr=(e,t)=>{e===Qn&&(e=void 0),t===Qn&&(t=void 0);const[n,r]=[e,t].map((e=>ar[hr(e).toLowerCase()]));return n!==r?n-r:1===n||2===n||6===n?e<t?-1:e>t?1:0:jr(e,t)?0:e<t?-1:e>t?1:0};function ur(e,t){if(!e)throw new Error(t)}const lr=e=>{if(rr.has(er(e)))return e;const t=new Set,n=e=>{if(t.has(e))throw Vn;const r=er(e);if(rr.has(r))return e;try{if(mr(e))return t.add(e),e.map(n);if(yr(e)){t.add(e);const r={};for(const t in e)r[t]=n(e[t]);return r}}finally{t.delete(e)}return r===Date||r===RegExp||(e=>{const t=Object.getPrototypeOf(er(e));return t&&"TypedArray"===t.name})(e)?new r(e):e};return n(e)},hr=e=>Jn.exec(Object.prototype.toString.call(e))[1],dr=e=>"boolean"==typeof e,fr=e=>"string"==typeof e,pr=e=>!isNaN(e)&&"number"==typeof e,mr=Array.isArray,yr=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Gn||null===t)&&"[object Object]"===Object.prototype.toString.call(e)},vr=e=>e===Object(e),gr=e=>e instanceof Date,br=e=>e instanceof RegExp,wr=e=>"function"==typeof e,_r=e=>null==e,Er=(e,t)=>e.includes(t),kr=(e,t)=>!Er(e,t),Sr=e=>_r(e)||fr(e)&&!e||e instanceof Array&&0===e.length||yr(e)&&0===Object.keys(e).length,xr=e=>e===Qn,Cr=e=>e instanceof Array?e:[e],Rr=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Or=(e,t)=>yr(e)&&yr(t)||mr(e)&&mr(t);function Ir(e,t,n){if(n=n||{flatten:!1},xr(e)||_r(e))return t;if(xr(t)||_r(t))return e;if(!Or(e,t)){if(n.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(n.skipValidation=!0,mr(e)){const r=e,i=t;if(n.flatten){let e=0,o=0;for(;e<r.length&&o<i.length;)r[e]=Ir(r[e++],i[o++],n);for(;o<i.length;)r.push(t[o++])}else Lr(r,i)}else for(const r in t)e[r]=Ir(e[r],t[r],n);return e}function Pr(e,t=tr){const n=new Map;return e.forEach(((r,i)=>{const o=Mr(r,t);n.has(o)?n.get(o).some((t=>jr(e[t],r)))||n.get(o).push(i):n.set(o,[i])})),n}function Dr(e,t=tr){if(e.some((e=>0==e.length)))return[];if(1===e.length)return Array.from(e);const n=function(e,t,n=cr){if(Sr(e))return e;const r=new Array,i=new Array;for(let n=0;n<e.length;n++){const o=e[n],s=t(o,n);_r(s)?i.push(o):r.push([s,o])}return r.sort(((e,t)=>n(e[0],t[0]))),Lr(i,r.map((e=>e[1])))}(e.map(((e,t)=>[t,e.length])),(e=>e[1])),r=e[n[0][0]],i=Pr(r,t),o=new Map,s=new Array;return i.forEach(((t,i)=>{const a=t.map((e=>r[e])),c=a.map((e=>0)),u=a.map((e=>[n[0][0],0]));let l=!1;for(let t=1;t<e.length;t++){const[r,s]=n[t],h=e[r];if(o.has(t)||o.set(t,Pr(h)),o.get(t).has(i)){const e=o.get(t).get(i).map((e=>h[e]));l=a.map(((n,s)=>e.some(((e,a)=>{const l=c[s];return jr(n,e)&&(c[s]++,r<u[s][0]&&(u[s]=[r,o.get(t).get(i)[a]])),l<c[s]})))).some(Boolean)}if(!l)return}l&&Lr(s,c.map(((t,n)=>t===e.length-1?[a[n],u[n]]:Qn)).filter((e=>e!==Qn)))})),s.sort(((e,t)=>{const[n,[r,i]]=e,[o,[s,a]]=t,c=cr(r,s);return 0!==c?c:cr(i,a)})).map((e=>e[0]))}function Tr(e,t=0){const n=new Array;return function e(t,r){for(let i=0,o=t.length;i<o;i++)mr(t[i])&&(r>0||r<0)?e(t[i],Math.max(-1,r-1)):n.push(t[i])}(e,t),n}const Ar=e=>{let[t,n]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],r=t;for(;!n.length&&t!==Gn&&t!==Yn;)r=t,n=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);const i={};return n.forEach((t=>i[t]=e[t])),[i,r]};function jr(e,t){const n=[[e,t]];for(;n.length>0;){if([e,t]=n.pop(),e===t)continue;const r=er(e);if(r!==er(t)||wr(e))return!1;if(sr.has(r)){const n=sr.get(r);if(n(e)!==n(t))return!1}else{if(r!==Array&&r!==Object)return!1;{const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;if(new Set(r.concat(i)).size!=r.length)return!1;for(const i of r)n.push([e[i],t[i]])}}}return!n.length}function Mr(e,t){return t=t||tr,_r(e)?null:t(e).toString()}function Nr(e,t,n=tr){if(e.length<1)return new Map;const r=new Map,i=new Map;for(let o=0;o<e.length;o++){const s=e[o],a=t(s,o),c=Mr(a,n);if(null===c)i.has(null)?i.get(null).push(s):i.set(null,[s]);else{const e=r.has(c)?r.get(c).find((e=>jr(e,a))):null;_r(e)?(i.set(a,[s]),r.has(c)?r.get(c).push(a):r.set(c,[a])):i.get(e).push(s)}}return i}const Br=5e4;function Lr(e,...t){return e instanceof Array?t.reduce(((e,t)=>{let n=Math.ceil(t.length/Br),r=0;for(;n-- >0;)Array.prototype.push.apply(e,t.slice(r,r+Br)),r+=Br;return e}),e):t.filter(vr).reduce(((e,t)=>(Object.assign(e,t),e)),e)}function Fr(e,t){return vr(e)?e[t]:void 0}function $r(e,t,n){let r=0;const i=nr.has(hr(e).toLowerCase())?e:function e(t,n){let i=t;for(let t=0;t<n.length;t++){const o=n[t];if(null===/^\d+$/.exec(o)&&i instanceof Array){if(0===t&&r>0)break;r+=1;const o=n.slice(t);i=i.reduce(((t,n)=>{const r=e(n,o);return void 0!==r&&t.push(r),t}),[]);break}if(i=Fr(i,o),void 0===i)break}return i}(e,t.split("."));return i instanceof Array&&(null==n?void 0:n.unwrapArray)?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(i,r):i}function qr(e,t,n){const r=t.split("."),i=r[0],o=r.slice(1).join("."),s=null!==/^\d+$/.exec(i),a=r.length>1;let c,u;if(e instanceof Array)if(s)c=Fr(e,Number(i)),a&&(c=qr(c,o,n)),c=[c];else{c=[];for(const r of e)u=qr(r,t,n),(null==n?void 0:n.preserveMissing)?(void 0===u&&(u=Qn),c.push(u)):void 0!==u&&c.push(u)}else{if(u=Fr(e,i),a&&(u=qr(u,o,n)),void 0===u)return;c=(null==n?void 0:n.preserveKeys)?Object.assign({},e):{},c[i]=u}return c}function Kr(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===Qn?e.splice(t,1):Kr(e[t]);else if(yr(e))for(const t in e)Rr(e,t)&&Kr(e[t])}const Ur=/^\d+$/;function Wr(e,t,n,r){const i=t.split("."),o=i[0],s=i.slice(1).join(".");if(1===i.length)(yr(e)||mr(e)&&Ur.test(o))&&n(e,o);else{(null==r?void 0:r.buildGraph)&&_r(e[o])&&(e[o]={});const t=e[o];if(!t)return;const a=!!(i.length>1&&Ur.test(i[1]));t instanceof Array&&(null==r?void 0:r.descendArray)&&!a?t.forEach((e=>Wr(e,s,n,r))):Wr(t,s,n,r)}}function Hr(e,t,n){Wr(e,t,((e,t)=>{e[t]=wr(n)?n(e[t]):n}),{buildGraph:!0})}function zr(e,t,n){Wr(e,t,((e,t)=>{if(e instanceof Array){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const n of e)yr(n)&&delete n[t]}else yr(e)&&delete e[t]}),n)}const Qr=/^\$[a-zA-Z0-9_]+$/;function Vr(e){return Qr.test(e)}function Yr(e){if(nr.has(hr(e).toLowerCase()))return br(e)?{$regex:e}:{$eq:e};if(vr(e)){const t=e;if(!Object.keys(t).some(Vr))return{$eq:e};if(Rr(e,"$regex")){const t=Object.assign({},e);return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Gr,Jr,Xr,Zr;(Xr=Gr||(Gr={})).CLONE_ALL="CLONE_ALL",Xr.CLONE_INPUT="CLONE_INPUT",Xr.CLONE_OUTPUT="CLONE_OUTPUT",Xr.CLONE_OFF="CLONE_OFF";class ei{constructor(e,t,n,r=Date.now()){this._opts=e,this._root=t,this._local=n,this.timestamp=r,this.update(t,n)}static init(e,t,n){return e instanceof ei?new ei(e._opts,_r(e.root)?t:e.root,Object.assign({},e.local,n)):new ei(e,t,n)}update(e,t){var n;return this._root=e,this._local=t?Object.assign({},t,{variables:Object.assign({},null===(n=this._local)||void 0===n?void 0:n.variables,null==t?void 0:t.variables)}):t,this}getOptions(){return Object.freeze(Object.assign(Object.assign({},this._opts),{context:ni.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var e;return null===(e=this._opts)||void 0===e?void 0:e.collation}get processingMode(){var e;return(null===(e=this._opts)||void 0===e?void 0:e.processingMode)||Gr.CLONE_OFF}get useStrictMode(){var e;return null===(e=this._opts)||void 0===e?void 0:e.useStrictMode}get scriptEnabled(){var e;return null===(e=this._opts)||void 0===e?void 0:e.scriptEnabled}get useGlobalContext(){var e;return null===(e=this._opts)||void 0===e?void 0:e.useGlobalContext}get hashFunction(){var e;return null===(e=this._opts)||void 0===e?void 0:e.hashFunction}get collectionResolver(){var e;return null===(e=this._opts)||void 0===e?void 0:e.collectionResolver}get jsonSchemaValidator(){var e;return null===(e=this._opts)||void 0===e?void 0:e.jsonSchemaValidator}get variables(){var e;return null===(e=this._opts)||void 0===e?void 0:e.variables}get context(){var e;return null===(e=this._opts)||void 0===e?void 0:e.context}}function ti(e){return e instanceof ei?e.getOptions():Object.freeze(Object.assign(Object.assign({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:Gr.CLONE_OFF},e),{context:(null==e?void 0:e.context)?ni.from(null==e?void 0:e.context):ni.init({})}))}(Zr=Jr||(Jr={})).ACCUMULATOR="accumulator",Zr.EXPRESSION="expression",Zr.PIPELINE="pipeline",Zr.PROJECTION="projection",Zr.QUERY="query",Zr.WINDOW="window";class ni{constructor(e){this.operators={[Jr.ACCUMULATOR]:{},[Jr.EXPRESSION]:{},[Jr.PIPELINE]:{},[Jr.PROJECTION]:{},[Jr.QUERY]:{},[Jr.WINDOW]:{}};for(const[t,n]of Object.entries(e))this.addOperators(t,n)}static init(e={}){return new ni(e)}static from(e){return new ni(e.operators)}addOperators(e,t){for(const[n,r]of Object.entries(t))this.getOperator(e,n)||(this.operators[e][n]=r);return this}addAccumulatorOps(e){return this.addOperators(Jr.ACCUMULATOR,e)}addExpressionOps(e){return this.addOperators(Jr.EXPRESSION,e)}addQueryOps(e){return this.addOperators(Jr.QUERY,e)}addPipelineOps(e){return this.addOperators(Jr.PIPELINE,e)}addProjectionOps(e){return this.addOperators(Jr.PROJECTION,e)}addWindowOps(e){return this.addOperators(Jr.WINDOW,e)}getOperator(e,t){return e in this.operators&&this.operators[e][t]||null}}const ri=ni.init();function ii(e,t){for(const[n,r]of Object.entries(t)){ur(wr(r)&&Vr(n),`'${n}' is not a valid operator`);const t=oi(e,n,null);ur(!t||r===t,`${n} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case Jr.ACCUMULATOR:ri.addAccumulatorOps(t);break;case Jr.EXPRESSION:ri.addExpressionOps(t);break;case Jr.PIPELINE:ri.addPipelineOps(t);break;case Jr.PROJECTION:ri.addProjectionOps(t);break;case Jr.QUERY:ri.addQueryOps(t);break;case Jr.WINDOW:ri.addWindowOps(t)}}function oi(e,t,n){const{context:r,useGlobalContext:i}=n||{},o=r?r.getOperator(e,t):null;return!o&&i?ri.getOperator(e,t):o}const si={$$ROOT:(e,t,n)=>n.root,$$CURRENT:(e,t,n)=>e,$$REMOVE(e,t,n){},$$NOW:(e,t,n)=>new Date(n.timestamp)},ai={$$KEEP:(e,t,n)=>e,$$PRUNE(e,t,n){},$$DESCEND(e,t,n){if(!Rr(t,"$cond"))return e;let r;for(const[i,o]of Object.entries(e))if(vr(o)){if(o instanceof Array){const e=[];for(let r of o)yr(r)&&(r=ui(r,t,n.update(r))),_r(r)||e.push(r);r=e}else r=ui(o,t,n.update(o));_r(r)?delete e[i]:e[i]=r}return e}};function ci(e,t,n,r){var i;const o=ei.init(r,e);if(Vr(n=n||"")){const i=oi(Jr.EXPRESSION,n,r);if(i)return i(e,t,o);const s=oi(Jr.ACCUMULATOR,n,r);if(s)return e instanceof Array||(e=ci(e,t,null,o),t=null),ur(e instanceof Array,`'${n}' target must be an array.`),s(e,t,o.update(null,o.local));throw new Error(`operator '${n}' is not registered`)}if(fr(t)&&t.length>0&&"$"===t[0]){if(Rr(ai,t))return t;let n=o.root;const r=t.split(".");if(Rr(si,r[0]))n=si[r[0]](e,null,o),t=t.slice(r[0].length+1);else if("$$"===r[0].slice(0,2)){n=Object.assign({},o.variables,{this:e},null===(i=o.local)||void 0===i?void 0:i.variables);const s=r[0].slice(2);ur(Rr(n,s),`Use of undefined variable: ${s}`),t=t.slice(2)}else t=t.slice(1);return""===t?n:$r(n,t)}if(mr(t))return t.map((t=>ci(e,t,null,o)));if(yr(t)){const n={};for(const[i,s]of Object.entries(t))if(n[i]=ci(e,s,i,o),[Jr.EXPRESSION,Jr.ACCUMULATOR].some((e=>!!oi(e,i,r))))return ur(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),n[i];return n}return t}function ui(e,t,n){const r=ci(e,t,null,n);return Rr(ai,r)?ai[r](e,t,n):r}function li(e){return e instanceof pi?e:new pi(e)}function hi(e,t){const n=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,n)}const di=new Error;var fi;!function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"}(fi||(fi={}));class pi{constructor(e){let t;if(this.iteratees=[],this.yieldedValues=[],this.isDone=!1,e instanceof Function&&(e={next:e}),function(e){return!!e&&"object"==typeof e&&(null==e?void 0:e.next)instanceof Function}(e)){const n=e;t=()=>{const e=n.next();if(e.done)throw di;return e.value}}else if(e instanceof Array){const n=e,r=n.length;let i=0;t=()=>{if(i<r)return n[i++];throw di}}else if(!(e instanceof Function))throw new Error("Lazy must be initialized with an array, generator, or function.");this.getNext=function(e,t,n){let r=!1,i=-1,o=0;return function(s){try{e:for(;!r;){let a=e();i++;let c=-1;const u=t.length;let l=!1;for(;++c<u;){const e=t[c];switch(e.action){case fi.MAP:a=e.func(a,i);break;case fi.FILTER:if(!e.func(a,i))continue e;break;case fi.TAKE:--e.count,e.count||(l=!0);break;case fi.DROP:--e.count,e.count||hi(t,c);continue e;default:break e}}if(r=l,!s)return{value:a,done:!1};n[o++]=a}}catch(e){if(e!==di)throw e}return r=!0,{done:r}}}(t,this.iteratees,this.yieldedValues)}push(e,t){return"function"==typeof t?this.iteratees.push({action:e,func:t}):"number"==typeof t&&this.iteratees.push({action:e,count:t}),this}next(){return this.getNext()}map(e){return this.push(fi.MAP,e)}filter(e){return this.push(fi.FILTER,e)}take(e){return e>0?this.push(fi.TAKE,e):this}drop(e){return e>0?this.push(fi.DROP,e):this}transform(e){const t=this;let n;return li((()=>(n||(n=li(e(t.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(e){for(;;){const t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let n=this.next();for(void 0!==t||n.done||(t=n.value,n=this.next());!n.done;)t=e(t,n.value),n=this.next();return t}size(){return this.reduce(((e,t)=>++e),0)}[Symbol.iterator](){return this}}class mi{constructor(e,t){this.pipeline=e,this.options=ti(t)}stream(e){let t=li(e);const n=this.options.processingMode;n!=Gr.CLONE_ALL&&n!=Gr.CLONE_INPUT||t.map(lr);const r=new Array;if(!Sr(this.pipeline))for(const e of this.pipeline){const n=Object.keys(e),i=n[0],o=oi(Jr.PIPELINE,i,this.options);ur(1===n.length&&!!o,`invalid pipeline operator ${i}`),r.push(i),t=o(t,e[i],this.options)}return(n==Gr.CLONE_OUTPUT||n==Gr.CLONE_ALL&&Dr([["$group","$unwind"],r]).length)&&t.map(lr),t}run(e){return this.stream(e).value()}}class yi{constructor(e,t,n,r){this.source=e,this.predicate=t,this.projection=n,this.options=r,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result||(yr(this.projection)&&this.operators.push({$project:this.projection}),this.result=li(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new mi(this.operators,this.options).stream(this.result))),this.result}fetchAll(){const e=li([...this.buffer]);return this.buffer=[],function(...e){let t=0;return li((()=>{for(;t<e.length;){const n=e[t].next();if(!n.done)return n;t++}return{done:!0}}))}(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.operators.push({$skip:e}),this}limit(e){return this.operators.push({$limit:e}),this}sort(e){return this.operators.push({$sort:e}),this}collation(e){return this.options=Object.assign(Object.assign({},this.options),{collation:e}),this}next(){if(this.buffer.length>0)return this.buffer.pop();const e=this.fetch().next();return e.done?void 0:e.value}hasNext(){if(this.buffer.length>0)return!0;const e=this.fetch().next();return!e.done&&(this.buffer.push(e.value),!0)}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}class vi{constructor(e,t){this.condition=e,this.options=ti(t),this.compiled=[],this.compile()}compile(){ur(yr(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);const e={};for(const[t,n]of Object.entries(this.condition)){if("$where"===t)Object.assign(e,{field:t,expr:n});else if(Er(["$and","$or","$nor","$expr","$jsonSchema"],t))this.processOperator(t,t,n);else{ur(!Vr(t),`unknown top level operator: ${t}`);for(const[e,r]of Object.entries(Yr(n)))this.processOperator(t,e,r)}e.field&&this.processOperator(e.field,e.field,e.expr)}}processOperator(e,t,n){const r=oi(Jr.QUERY,t,this.options);if(!r)throw new Error(`unknown operator ${t}`);const i=r(e,n,this.options);this.compiled.push(i)}test(e){for(let t=0,n=this.compiled.length;t<n;t++)if(!this.compiled[t](e))return!1;return!0}find(e,t){return new yi(e,(e=>this.test(e)),t||{},this.options)}remove(e){return e.reduce(((e,t)=>(this.test(t)||e.push(t),e)),[])}}new WeakMap;const gi=(e,t,n)=>{if(Sr(t)||!yr(t))return e;let r=cr;const i=n.collation;return yr(i)&&fr(i.locale)&&(r=function(e){const t={sensitivity:bi[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));const n=new Intl.Collator(e.locale,t);return(e,t)=>{if(!fr(e)||!fr(t))return cr(e,t);const r=n.compare(e,t);return r<0?-1:r>0?1:0}}(i)),e.transform((e=>{const i=Object.keys(t);for(const o of i.reverse()){const i=Nr(e,(e=>$r(e,o)),n.hashFunction),s=Array.from(i.keys()).sort(r);-1===t[o]&&s.reverse(),e=[],s.reduce(((e,t)=>Lr(e,i.get(t))),e)}return e}))},bi={1:"base",2:"accent",3:"variant"};function wi(e){const t=(t,n,r)=>{const i={unwrapArray:!0},o=Math.max(1,t.split(".").length-1);return s=>{const a=$r(s,t,i);return e(a,n,Object.assign(Object.assign({},r),{depth:o}))}};return t.op="query",t}function _i(e){return(t,n,r)=>{const i=ci(t,n,null,r);return e(...i)}}function Ei(e,t,n){if(jr(e,t))return!0;if(_r(e)&&_r(t))return!0;if(e instanceof Array){const r=jr.bind(null,t);return e.some(r)||Tr(e,null==n?void 0:n.depth).some(r)}return!1}function ki(e,t,n){return!Ei(e,t,n)}function Si(e,t,n){return _r(e)?t.some((e=>null===e)):Dr([Cr(e),t],null==n?void 0:n.hashFunction).length>0}function xi(e,t,n){return!Si(e,t,n)}function Ci(e,t,n){return Bi(e,t,((e,t)=>cr(e,t)<0))}function Ri(e,t,n){return Bi(e,t,((e,t)=>cr(e,t)<=0))}function Oi(e,t,n){return Bi(e,t,((e,t)=>cr(e,t)>0))}function Ii(e,t,n){return Bi(e,t,((e,t)=>cr(e,t)>=0))}function Pi(e){return Vr(e)&&-1===["$and","$or","$nor"].indexOf(e)}function Di(e,t,n){if(mr(e)&&!Sr(e)){let r=e=>e,i=t;Object.keys(t).every(Pi)&&(i={temp:t},r=e=>({temp:e}));const o=new vi(i,n);for(let t=0,n=e.length;t<n;t++)if(o.test(r(e[t])))return!0}return!1}new Set(["$denseRank","$documentNumber","$first","$last","$linearFill","$rank","$shift"]),new Set(["$denseRank","$expMovingAvg","$linearFill","$locf","$rank","$shift"]);const Ti=e=>null===e,Ai=e=>pr(e)&&e>=-2147483648&&e<=2147483647&&-1===e.toString().indexOf("."),ji=e=>pr(e)&&e>=zn&&e<=Hn&&-1===e.toString().indexOf("."),Mi={array:mr,bool:dr,boolean:dr,date:gr,decimal:pr,double:pr,int:Ai,long:ji,number:pr,null:Ti,object:yr,regex:br,regexp:br,string:fr,undefined:_r,function:e=>{throw new Error("unsupported type key `function`.")},1:pr,2:fr,3:yr,4:mr,6:_r,8:dr,9:gr,10:Ti,11:br,16:Ai,18:ji,19:pr};function Ni(e,t,n){const r=Mi[t];return!!r&&r(e)}function Bi(e,t,n){return Cr(e).some((e=>hr(e)===hr(t)&&n(e,t)))}_i(xi);const Li=(e,t)=>(n,r,i)=>{ur(mr(r),`${e}: expression must be an array.`);const o=ci(n,r,null,i);return o.some(_r)?null:(ur(o.every(pr),`${e}: expression must evalue to array of numbers.`),t(o))};Li("$bitAnd",(e=>e.reduce(((e,t)=>e&t),-1))),Li("$bitOr",(e=>e.reduce(((e,t)=>e|t),0))),Li("$bitXor",(e=>e.reduce(((e,t)=>e^t),0))),_i(Ei),_i(Oi),_i(Ii),_i(Ci),_i(Ri),_i(ki);const Fi=(e,t)=>{const n={};return e.split("").forEach(((e,r)=>n[e]=t*(r+1))),n};Object.assign(Object.assign(Object.assign({},Fi("ABCDEFGHIKLM",1)),Fi("NOPQRSTUVWXY",-1)),{Z:0});const $i={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function qi(e,t=$i){const n=Object.assign({},$i,t),r=new Set(Object.keys(n));return(t,i,o)=>{const s=ci(t,i,null,o);if(r.has(`${s}`)){const t=n[`${s}`];if(t instanceof Error)throw new Error(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return t}return e(s)}}qi(Math.acos,{Infinity:1/0,0:new Error}),qi(Math.acosh,{Infinity:1/0,0:new Error}),qi(Math.asin),qi(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),qi(Math.atan),qi(Math.atanh,{1:1/0,"-1":-1/0}),qi(Math.cos),qi(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const Ki=Math.PI/180,Ui=(qi((e=>e*Ki),{Infinity:1/0,"-Infinity":1/0}),180/Math.PI);qi((e=>e*Ui),{Infinity:1/0,"-Infinity":-1/0}),qi(Math.sin),qi(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),qi(Math.tan);const Wi=(e,t,n)=>{if(Sr(t))return e;let r=Object.keys(t),i=!1;zi(t,n);const o=n.idKey;if(Er(r,o)){const e=t[o];0!==e&&!1!==e||(r=r.filter(kr.bind(null,[o])),i=0==r.length)}else r.push(o);const s=ei.init(n);return e.map((e=>Hi(e,t,s.update(e),r,i)))};function Hi(e,t,n,r,i){let o={},s=!1,a=!1;const c=[];i&&c.push(n.idKey);for(const i of r){let r;const u=t[i];if(i!==n.idKey&&Er([0,!1],u)&&(a=!0),i===n.idKey&&Sr(u))r=e[i];else if(fr(u))r=ci(e,u,i,n);else if(Er([1,!0],u));else if(u instanceof Array)r=u.map((t=>{const r=ci(e,t,null,n);return _r(r)?null:r}));else{if(!yr(u)){c.push(i);continue}{const t=u,o=Object.keys(u),a=1==o.length?o[0]:"",c=oi(Jr.PROJECTION,a,n);if(c)"$slice"===a?Cr(t[a]).every(pr)?(r=c(e,t[a],i,n),s=!0):r=ci(e,t,i,n):r=c(e,t[a],i,n);else if(Vr(a))r=ci(e,t[a],a,n);else if(Rr(e,i)){zi(t,n);let s=e[i];s instanceof Array?r=s.map((e=>Hi(e,t,n,o,!1))):(s=yr(s)?s:e,r=Hi(s,t,n,o,!1))}else r=ci(e,u,null,n)}}const l=qr(e,i,{preserveMissing:!0});void 0!==l&&Ir(o,l,{flatten:!0}),kr([0,1,!1,!0],u)&&(void 0===r?zr(o,i,{descendArray:!0}):Hr(o,i,r))}if(Kr(o),(s||a||i)&&(o=Lr({},e,o),c.length>0))for(const e of c)zr(o,e,{descendArray:!0});return o}function zi(e,t){const n=[!1,!1];for(const[r,i]of Object.entries(e)){if(r===(null==t?void 0:t.idKey))return;0===i||!1===i?n[0]=!0:1!==i&&!0!==i||(n[1]=!0),ur(!(n[0]&&n[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Qi=(e,t,n)=>{ur(mr(t),"Invalid expression: $and expects value to be an Array.");const r=t.map((e=>new vi(e,n)));return e=>r.every((t=>t.test(e)))},Vi=(e,t,n)=>{ur(mr(t),"Invalid expression. $or expects value to be an Array");const r=t.map((e=>new vi(e,n)));return e=>r.some((t=>t.test(e)))},Yi=(e,t,n)=>{ur(mr(t),"Invalid expression. $nor expects value to be an array.");const r=Vi("$or",t,n);return e=>!r(e)},Gi=(e,t,n)=>{const r={};r[e]=Yr(t);const i=new vi(r,n);return e=>!i.test(e)},Ji=wi(Ei),Xi=wi(Oi),Zi=wi(Ii),eo=wi(Si),to=wi(Ci),no=wi(Ri),ro=wi(ki),io=wi(xi),oo=wi((function(e,t,n){return Cr(e).some((e=>2===t.length&&e%t[0]===t[1]))})),so=wi((function(e,t,n){const r=Cr(e),i=e=>fr(e)&&((e,t=!0)=>!!e||t&&""===e)(t.exec(e),null==n?void 0:n.useStrictMode);return r.some(i)||Tr(r,1).some(i)}));wi((function(e,t,n){if(!(mr(e)&&mr(t)&&e.length&&t.length))return!1;let r=!0;for(const i of t){if(!r)break;r=yr(i)&&Er(Object.keys(i),"$elemMatch")?Di(e,i.$elemMatch,n):i instanceof RegExp?e.some((e=>"string"==typeof e&&i.test(e))):e.some((e=>jr(i,e)))}return r}));const ao=wi(Di),co=wi((function(e,t,n){return Array.isArray(e)&&e.length===t})),uo=wi((function(e,t,n){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e})),lo=wi((function(e,t,n){return Array.isArray(t)?t.findIndex((t=>Ni(e,t)))>=0:Ni(e,t)}));var ho=!1;function fo(e,t){var n=me(e.primaryKey);t=A(t);var r=M(t);if("number"!=typeof r.skip&&(r.skip=0),r.selector?(r.selector=r.selector,Object.entries(r.selector).forEach((([e,t])=>{"object"==typeof t&&null!==t||(r.selector[e]={$eq:t})}))):r.selector={},r.index){var i=Z(r.index);i.includes(n)||i.push(n),r.index=i}if(r.sort)r.sort.find((e=>{return t=e,Object.keys(t)[0]===n;var t}))||(r.sort=r.sort.slice(0),r.sort.push({[n]:"asc"}));else if(r.index)r.sort=r.index.map((e=>({[e]:"asc"})));else{if(e.indexes){var o=new Set;Object.entries(r.selector).forEach((([e,t])=>{("object"!=typeof t||null===t||Object.keys(t).find((e=>qn.has(e))))&&o.add(e)}));var s,a=-1;e.indexes.forEach((e=>{var t=ee(e)?e:[e],n=t.findIndex((e=>!o.has(e)));n>0&&n>a&&(a=n,s=t)})),s&&(r.sort=s.map((e=>({[e]:"asc"}))))}r.sort||(r.sort=[{[n]:"asc"}])}return r}function po(e,t){if(!t.sort)throw V("SNH",{query:t});var n=[];return t.sort.forEach((e=>{var t,r,i,o=Object.keys(e)[0],s=Object.values(e)[0];n.push({key:o,direction:s,getValueFn:(t=o,r=t.split("."),i=r.length,1===i?e=>e[t]:e=>{for(var t=e,n=0;n<i;++n)if(void 0===(t=t[r[n]]))return t;return t})})})),(e,t)=>{for(var r=0;r<n.length;++r){var i=n[r],o=i.getValueFn(e),s=i.getValueFn(t);if(o!==s)return"asc"===i.direction?cr(o,s):cr(s,o)}}}function mo(e,t){if(!t.sort)throw V("SNH",{query:t});var n,r=(n=t.selector,ho||(ii(Jr.PIPELINE,{$sort:gi,$project:Wi}),ii(Jr.QUERY,{$and:Qi,$eq:Ji,$elemMatch:ao,$exists:uo,$gt:Xi,$gte:Zi,$in:eo,$lt:to,$lte:no,$ne:ro,$nin:io,$mod:oo,$nor:Yi,$not:Gi,$or:Vi,$regex:so,$size:co,$type:lo}),ho=!0),new vi(n));return e=>!e._deleted&&r.test(e)}function yo(e,t){return t.sort&&0!==t.sort.length?t.sort.map((e=>Object.keys(e)[0])):[e]}var vo=new WeakMap;function go(t,n){if(!t.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=function(e){return St(vo,e,(()=>{var t=e.collection,n=fo(t.storageInstance.schema,M(e.mangoQuery)),r=t.schema.primaryPath,i=po(t.schema.jsonSchema,n),o=mo(t.schema.jsonSchema,n);return{primaryKey:e.collection.schema.primaryPath,skip:n.skip,limit:n.limit,sortFields:yo(r,n),sortComparator:(t,n)=>{var r={docA:t,docB:n,rxQuery:e};return i(r.docA,r.docB)},queryMatcher:t=>o({doc:t,rxQuery:e}.doc)}}))}(t),i=e(t._result).docsData.slice(0),o=e(t._result).docsDataMap,s=!1,a=n.map((e=>function(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:W.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}(e))).filter(te).find((e=>{var t=function(e){const t=Nn(e);return Sn[t]}({queryParams:r,changeEvent:e,previousResults:i,keyDocumentMap:o});return"runFullQueryAgain"===t||("doNothing"!==t?(s=!0,function(e,t,n,r,i){(0,xn[e])({queryParams:t,changeEvent:n,previousResults:r,keyDocumentMap:i})}(t,r,e,i,o),!1):void 0)}));return a?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:i}}var bo=function(){function e(){this._map=new Map}return e.prototype.getByQuery=function(e){var t=e.toString();return St(this._map,t,(()=>e))},e}();function wo(e,t){t.uncached=!0;var n=t.toString();e._map.delete(n)}function _o(e){return e.refCount$.observers.length}var Eo=(100,3e4,(e,t)=>{if(!(t._map.size<100)){var n=Ct()-3e4,r=[],i=Array.from(t._map.values());for(var o of i)_o(o)>0||(0===o._lastEnsureEqual&&o._creationTime<n?wo(t,o):r.push(o));var s=r.length-100;if(!(s<=0)){var a=r.sort(((e,t)=>e._lastEnsureEqual-t._lastEnsureEqual));a.slice(0,s).forEach((e=>wo(t,e)))}}}),ko=new WeakSet;var So=function(){function e(e,t,n){this.cacheItemByDocId=new Map,this.registry="function"==typeof FinalizationRegistry?new FinalizationRegistry((e=>{var t=e.docId,n=this.cacheItemByDocId.get(t);n&&(n.byRev.delete(e.revisionHeight),0===n.byRev.size&&this.cacheItemByDocId.delete(t))})):void 0,this.registerIdleTasks=[],this.primaryPath=e,this.changes$=t,this.documentCreator=n,t.subscribe((e=>{var t=e.documentId,n=this.cacheItemByDocId.get(t);if(n){var r=Bn(e);n.last=r}}))}var t=e.prototype;return t.getLatestDocumentData=function(e){return kt(this.cacheItemByDocId,e).last},t.getLatestDocumentDataIfExists=function(e){var t=this.cacheItemByDocId.get(e);if(t)return t.last},w(e,[{key:"getCachedRxDocument",get:function(){return N(this,"getCachedRxDocument",(t=(e=this).primaryPath,n=e.cacheItemByDocId,r=e.registry,i=W.deepFreezeWhenDevMode,o=e.documentCreator,s=>{var a=s[t],c=Ot(s._rev),u=St(n,a,(()=>function(e){return{byRev:new Map,last:e}}(s))),l=u.byRev,h=l.get(c),d=h?h.deref():void 0;return d||(s=i(s),d=o(s),l.set(c,Co(d)),r&&(e.registerIdleTasks.push(d),e.registerIdlePromise||(e.registerIdlePromise=I().then((()=>{e.registerIdlePromise=void 0;var t=e.registerIdleTasks;0!==t.length&&(e.registerIdleTasks=[],t.forEach((e=>{r.register(e,{docId:e.primary,revisionHeight:Ot(e.revision)})})))}))))),d}));var e,t,n,r,i,o}}]),e}();function xo(e,t){for(var n=e.getCachedRxDocument,r=[],i=0;i<t.length;i++){var o=n(t[i]);r.push(o)}return r}var Co="function"==typeof WeakRef?function(e){return new WeakRef(e)}:function(e){return{deref:()=>e}},Ro=function(){function e(e,t,n){this.time=Ct(),this.collection=e,this.count=n,this.documents=xo(this.collection._docCache,t)}return w(e,[{key:"docsData",get:function(){return N(this,"docsData",this.documents.map((e=>e._data)))}},{key:"docsDataMap",get:function(){var e=new Map;return this.documents.forEach((t=>{e.set(t.primary,t._data)})),N(this,"docsDataMap",e)}},{key:"docsMap",get:function(){for(var e=new Map,t=this.documents,n=0;n<t.length;n++){var r=t[n];e.set(r.primary,r)}return N(this,"docsMap",e)}}]),e}(),Oo=0,Io=function(){function n(e,t,n,r={}){this.id=++Oo,this._execOverDatabaseCount=0,this._creationTime=Ct(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new Jt(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=C,this.op=e,this.mangoQuery=t,this.collection=n,this.other=r,t||(this.mangoQuery={selector:{}}),this.isFindOneByIdQuery=function(e,t){if(!t.skip&&t.selector&&1===Object.keys(t.selector).length&&t.selector[e]){var n=t.selector[e];if("string"==typeof n)return n;if(1===Object.keys(n).length&&"string"==typeof n.$eq)return n.$eq;if(1===Object.keys(n).length&&Array.isArray(n.$eq)&&!n.$eq.find((e=>"string"!=typeof e)))return n.$eq}return!1}(this.collection.schema.primaryPath,t)}var r=n.prototype;return r._setResultData=function(e){if("number"!=typeof e){e instanceof Map&&(e=Array.from(e.values()));var t=new Ro(this.collection,e,e.length);this._result=t}else this._result=new Ro(this.collection,[],e)},r._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=Ct(),"count"===this.op){var t=this.getPreparedQuery(),n=await this.collection.storageInstance.count(t);if("slow"!==n.mode||this.collection.database.allowSlowCount)return n.count;throw V("QU14",{collection:this.collection,queryObj:this.mangoQuery})}if("findByIds"===this.op){var r=e(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,i=new Map,o=[];return r.forEach((e=>{var t=this.collection._docCache.getLatestDocumentDataIfExists(e);if(t){if(!t._deleted){var n=this.collection._docCache.getCachedRxDocument(t);i.set(e,n)}}else o.push(e)})),o.length>0&&(await this.collection.storageInstance.findDocumentsById(o,!1)).forEach((e=>{var t=this.collection._docCache.getCachedRxDocument(e);i.set(t.primary,t)})),i}var s=async function(e){var t=[],n=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var r=e.isFindOneByIdQuery;if(r=r.filter((n=>{var r=e.collection._docCache.getLatestDocumentDataIfExists(n);return!r||(r._deleted||t.push(r),!1)})),r.length>0){var i=await n.storageInstance.findDocumentsById(r,!1);re(t,i)}}else{var o=e.isFindOneByIdQuery,s=e.collection._docCache.getLatestDocumentDataIfExists(o);if(!s){var a=await n.storageInstance.findDocumentsById([o],!1);a[0]&&(s=a[0])}s&&!s._deleted&&t.push(s)}else{var c=e.getPreparedQuery(),u=await n.storageInstance.query(c);t=u.documents}return t}(this);return s.then((e=>(this._lastExecEnd=Ct(),e)))},r.exec=function(e){if(e&&"findOne"!==this.op)throw V("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return To(this).then((()=>Zt(this.$))).then((t=>{if(!t&&e)throw V("QU10",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return t}))},r.toString=function(){var e=j({op:this.op,query:this.mangoQuery,other:this.other},!0),t=JSON.stringify(e);return this.toString=()=>t,t},r.getPreparedQuery=function(){var e={rxQuery:this,mangoQuery:fo(this.collection.schema.jsonSchema,this.mangoQuery)};oe("prePrepareQuery",e);var t=this.collection.database.storage.statics.prepareQuery(this.collection.schema.jsonSchema,e.mangoQuery);return this.getPreparedQuery=()=>t,t},r.doesDocumentDataMatch=function(e){return!e._deleted&&this.queryMatcher(e)},r.remove=function(){return this.exec().then((e=>Array.isArray(e)?Promise.all(e.map((e=>e.remove()))):e.remove()))},r.update=function(e){throw B("update")},r.where=function(e){throw B("query-builder")},r.sort=function(e){throw B("query-builder")},r.skip=function(e){throw B("query-builder")},r.limit=function(e){throw B("query-builder")},w(n,[{key:"$",get:function(){if(!this._$){var n=this.collection.$.pipe(Et((e=>!e.isLocal)),hn(null),_t((()=>To(this))),ct((()=>this._result)),mn(t),yn(((t,n)=>!(!t||t.time!==e(n).time))),Et((e=>!!e)),ct((t=>{var n=e(t);return"count"===this.op?n.count:"findOne"===this.op?0===n.documents.length?null:n.documents[0]:"findByIds"===this.op?n.docsMap:n.documents.slice(0)})));this._$=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rn(e),r=on(e,1/0),i=e;return i.length?1===i.length?gt(i[0]):en(r)(un(i,n)):tn}(n,this.refCount$.pipe(Et((()=>!1))))}return this._$}},{key:"queryMatcher",get:function(){return this.collection.schema.jsonSchema,N(this,"queryMatcher",mo(0,fo(this.collection.schema.jsonSchema,this.mangoQuery)))}},{key:"asRxQuery",get:function(){return this}}]),n}();function Po(e,t,n,r){oe("preCreateRxQuery",{op:e,queryObj:t,collection:n,other:r});var i,o,s=new Io(e,t,n,r);return s=(i=s).collection._queryCache.getByQuery(i),o=n,ko.has(o)||(ko.add(o),new Promise((e=>setTimeout(e,0))).then((()=>P=P.then((()=>I(200))))).then((()=>{o.destroyed||o.cacheReplacementPolicy(o,o._queryCache),ko.delete(o)}))),s}function Do(e){var t=e.asRxQuery.collection._changeEventBuffer.counter;return e._latestChangeEvent>=t}function To(t){return t.collection.database.destroyed||Do(t)?C:(t._ensureEqualQueue=t._ensureEqualQueue.then((()=>function(t){if(t._lastEnsureEqual=Ct(),t.collection.database.destroyed||Do(t))return C;var n=!1,r=!1;if(-1===t._latestChangeEvent&&(r=!0),!r){var i=t.asRxQuery.collection._changeEventBuffer.getFrom(t._latestChangeEvent+1);if(null===i)r=!0;else{t._latestChangeEvent=t.asRxQuery.collection._changeEventBuffer.counter;var o=t.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(i);if("count"===t.op){var s=e(t._result).count,a=s;o.forEach((e=>{var n=e.previousDocumentData&&t.doesDocumentDataMatch(e.previousDocumentData),r=t.doesDocumentDataMatch(e.documentData);!n&&r&&a++,n&&!r&&a--})),a!==s&&(n=!0,t._setResultData(a))}else{var c=go(t,o);c.runFullQueryAgain?r=!0:c.changed&&(n=!0,t._setResultData(c.newResults))}}}return r?t._execOverDatabase().then((e=>(t._latestChangeEvent=t.collection._changeEventBuffer.counter,"number"==typeof e?(t._result&&e===t._result.count||(n=!0,t._setResultData(e)),n):(t._result&&function(e,t,n){if(t.length!==n.length)return!1;for(var r=0,i=t.length;r<i;){var o=t[r],s=n[r];if(r++,o._rev!==s._rev||o[e]!==s[e])return!1}return!0}(t.collection.schema.primaryPath,e,t._result.docsData)||(n=!0,t._setResultData(e)),n)))):Promise.resolve(n)}(t))),t._ensureEqualQueue)}var Ao=function(){function e(e){this.subs=[],this.limit=100,this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.collection=e,this.subs.push(this.collection.$.pipe(Et((e=>!e.isLocal))).subscribe((e=>this._handleChangeEvent(e))))}var t=e.prototype;return t._handleChangeEvent=function(e){for(this.counter++,this.buffer.push(e),this.eventCounterMap.set(e,this.counter);this.buffer.length>this.limit;)this.buffer.shift()},t.getArrayIndexByPointer=function(e){var t=this.buffer[0],n=this.eventCounterMap.get(t);return e<n?null:e-n},t.getFrom=function(e){var t=[],n=this.getArrayIndexByPointer(e);if(null===n)return null;for(;;){var r=this.buffer[n];if(n++,!r)return t;t.push(r)}},t.runFrom=function(e,t){var n=this.getFrom(e);if(null===n)throw new Error("out of bounds");n.forEach((e=>t(e)))},t.reduceByLastOfDoc=function(e){return e.slice(0)},t.destroy=function(){this.subs.forEach((e=>e.unsubscribe()))},e}(),jo=function(){function t(e,t,n,r){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=e,this.primaryPath=t,this.preWrite=n,this.postWrite=r}var n=t.prototype;return n.addWrite=function(t,n){var r=t[this.primaryPath],i=St(this.queueByDocId,r,(()=>[]));return new Promise(((r,o)=>{var s={lastKnownDocumentState:t,modifier:n,resolve:r,reject:o};e(i).push(s),this.triggerRun()}))},n.triggerRun=async function(){if(!0!==this.isRunning&&0!==this.queueByDocId.size){this.isRunning=!0;var t=[],n=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(n.entries()).map((async([e,n])=>{var r,i,o,s=(r=n.map((e=>e.lastKnownDocumentState)),i=r[0],o=Rt(i._rev).height,r.forEach((e=>{var t=Rt(e._rev).height;t>o&&(i=e,o=t)})),i),a=s;for(var c of n)try{a=await c.modifier(M(a))}catch(e){c.reject(e),c.reject=()=>{},c.resolve=()=>{}}try{await this.preWrite(a,s)}catch(e){return void n.forEach((t=>t.reject(e)))}t.push({previous:s,document:a})})));var r=t.length>0?await this.storageInstance.bulkWrite(t,"incremental-write"):{error:[],success:[]};return await Promise.all(r.success.map((e=>{var t=e[this.primaryPath];this.postWrite(e),kt(n,t).forEach((t=>t.resolve(e)))}))),r.error.forEach((t=>{var r,i=t.documentId,o=kt(n,i),s=G(t);if(s){var a=St(this.queueByDocId,i,(()=>[]));o.reverse().forEach((t=>{t.lastKnownDocumentState=e(s.documentInDb),e(a).unshift(t)}))}else{var c=V("COL20",{name:J[(r=t).status],document:r.documentId,writeError:r});o.forEach((e=>e.reject(c)))}})),this.isRunning=!1,this.triggerRun()}},t}();function Mo(e){return async t=>{var n=function(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}(t);n._deleted=t._deleted;var r=await e(n),i=Object.assign({},r,{_meta:t._meta,_attachments:t._attachments,_rev:t._rev,_deleted:void 0!==r._deleted?r._deleted:t._deleted});return void 0===i._deleted&&(i._deleted=!1),i}}var No={get primaryPath(){if(this.isInstanceOfRxDocument)return this.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){if(this.isInstanceOfRxDocument)return this._data._rev},get deleted$(){if(this.isInstanceOfRxDocument)return this.$.pipe(ct((e=>e._data._deleted)))},get deleted(){if(this.isInstanceOfRxDocument)return this._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){return this.collection.$.pipe(Et((e=>!e.isLocal)),Et((e=>e.documentId===this.primary)),ct((e=>Bn(e))),hn(this.collection._docCache.getLatestDocumentData(this.primary)),yn(((e,t)=>e._rev===t._rev)),ct((e=>this.collection._docCache.getCachedRxDocument(e))),mn(t))},get$(e){if(W.isDevMode()){if(e.includes(".item."))throw V("DOC1",{path:e});if(e===this.primaryPath)throw V("DOC2");if(this.collection.schema.finalFields.includes(e))throw V("DOC3",{path:e});if(!fe(this.collection.schema.jsonSchema,e))throw V("DOC4",{path:e})}return this.$.pipe(ct((t=>de(t,e))),yn())},populate(e){var t=fe(this.collection.schema.jsonSchema,e),n=this.get(e);if(!n)return R;if(!t)throw V("DOC5",{path:e});if(!t.ref)throw V("DOC6",{path:e,schemaObj:t});var r=this.collection.database.collections[t.ref];if(!r)throw V("DOC7",{ref:t.ref,path:e,schemaObj:t});return"array"===t.type?r.findByIds(n).exec().then((e=>{var t=e.values();return Array.from(t)})):r.findOne(n).exec()},get(e){return St(this._propertyCache,e,(()=>{var t=de(this._data,e);if("object"!=typeof t||null===t||Array.isArray(t))return W.deepFreezeWhenDevMode(t);var n=this;return new Proxy(A(t),{get(t,r){if("string"!=typeof r)return t[r];var i=r.charAt(r.length-1);if("$"===i){var o=r.slice(0,-1);return n.get$(s(e+"."+o))}if("_"===i){var a=r.slice(0,-1);return n.populate(s(e+"."+a))}return n.get(s(e+"."+r))}})}))},toJSON(e=!1){if(e)return W.deepFreezeWhenDevMode(this._data);var t=A(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,W.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return M(this.toJSON(e))},update(e){throw B("update")},incrementalUpdate(e){throw B("update")},updateCRDT(e){throw B("crdt")},putAttachment(){throw B("attachments")},getAttachment(){throw B("attachments")},allAttachments(){throw B("attachments")},get allAttachments$(){throw B("attachments")},async modify(e,t){var n=this._data,r=await Mo(e)(n);return this._saveData(r,n)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,Mo(e)).then((e=>this.collection._docCache.getCachedRxDocument(e)))},patch(e){var t=this._data,n=M(t);return Object.entries(e).forEach((([e,t])=>{n[e]=t})),this._saveData(n,t)},incrementalPatch(e){return this.incrementalModify((t=>(Object.entries(e).forEach((([e,n])=>{t[e]=n})),t)))},async _saveData(e,t){if(e=A(e),this._data._deleted)throw V("DOC11",{id:this.primary,document:this});await Bo(this.collection,e,t);var n=await this.collection.storageInstance.bulkWrite([{previous:t,document:e}],"rx-document-save-data"),r=n.error[0];return jt(this.collection,this.primary,e,r),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(n.success[0])},remove(){var e=this.collection;if(this.deleted)return Promise.reject(V("DOC13",{document:this,id:this.primary}));var t,n=A(this._data);return e._runHooks("pre","remove",n,this).then((async()=>{n._deleted=!0;var t=await e.storageInstance.bulkWrite([{previous:this._data,document:n}],"rx-document-remove"),r=t.error[0];return jt(e,this.primary,n,r),t.success[0]})).then((e=>(t=e,this.collection._runHooks("post","remove",n,this)))).then((()=>this.collection._docCache.getCachedRxDocument(t)))},incrementalRemove(){return this.incrementalModify((async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e))).then((async e=>(await this.collection._runHooks("post","remove",e._data,e),e)))},destroy(){throw V("DOC14")}};function Bo(e,t,n){return t._meta=Object.assign({},n._meta,t._meta),W.isDevMode()&&e.schema.validateChange(n,t),e._runHooks("pre","save",t,n)}var Lo=new WeakMap;function Fo(e){return St(Lo,e,(()=>function(e=No){var t=function(e,t){this.collection=e,this._data=t,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}(function(e){var t=e.schema.getDocumentPrototype(),n=function(e){var t={};return Object.entries(e.methods).forEach((([e,n])=>{t[e]=n})),t}(e),r={};return[t,n,No].forEach((e=>{Object.getOwnPropertyNames(e).forEach((t=>{var n=Object.getOwnPropertyDescriptor(e,t),i=!0;(t.startsWith("_")||t.endsWith("_")||t.startsWith("$")||t.endsWith("$"))&&(i=!1),"function"==typeof n.value?Object.defineProperty(r,t,{get(){return n.value.bind(this)},enumerable:i,configurable:!1}):(n.enumerable=i,n.configurable=!1,n.writable&&(n.writable=!1),Object.defineProperty(r,t,n))}))})),r}(e))))}var $o=function(e,t){return X(Nt(e.newDocumentState),Nt(e.realMasterState))?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})},qo=["pre","post"],Ko=["insert","save","remove","create"],Uo=!1,Wo=function(){function t(e,t,n,r,i={},s={},a={},c={},u={},l=Eo,h={},d=$o){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=new bo,this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.database=e,this.name=t,this.schema=n,this.internalStorageInstance=r,this.instanceCreationOptions=i,this.migrationStrategies=s,this.methods=a,this.attachments=c,this.options=u,this.cacheReplacementPolicy=l,this.statics=h,this.conflictHandler=d,function(e){if(!Uo){Uo=!0;var t=Object.getPrototypeOf(e);Ko.forEach((e=>{qo.map((n=>{var r=n+o(e);t[r]=function(t,r){return this.addHook(n,e,t,r)}}))}))}}(this.asRxCollection)}var n=t.prototype;return n.prepare=async function(){this.storageInstance=Lt(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new jo(this.storageInstance,this.schema.primaryPath,((e,t)=>Bo(this,e,t)),(e=>this._runHooks("post","save",e)));var e,t=this.database.eventBulks$.pipe(Et((e=>e.collectionName===this.name)));this.$=t.pipe(_t((e=>e.events))),this.checkpoint$=t.pipe(ct((e=>e.checkpoint))),this._changeEventBuffer=(e=this.asRxCollection,new Ao(e)),this._docCache=new So(this.schema.primaryPath,this.$.pipe(Et((e=>!e.isLocal))),(e=>function(e,t){var n=function(e,t,n){var r=new e(t,n);return oe("createRxDocument",r),r}(Fo(e),e,W.deepFreezeWhenDevMode(t));return e._runHooksSync("post","create",t,n),oe("postCreateRxDocument",n),n}(this.asRxCollection,e)));var n=await this.database.storageToken,r=this.storageInstance.changeStream().subscribe((e=>{var t={id:e.id,internal:!1,collectionName:this.name,storageToken:n,events:e.events.map((e=>{return!1,this,n=(t=e).documentData,r=t.previousDocumentData,{documentId:t.documentId,collectionName:this?this.name:void 0,isLocal:false,operation:t.operation,documentData:W.deepFreezeWhenDevMode(n),previousDocumentData:W.deepFreezeWhenDevMode(r)};var t,n,r})),databaseToken:this.database.token,checkpoint:e.checkpoint,context:e.context,endTime:e.endTime,startTime:e.startTime};this.database.$emit(t)}));return this._subs.push(r),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe((e=>{this.conflictHandler(e.input,e.context).then((t=>{this.storageInstance.resolveConflictResultionTask({id:e.id,output:t})}))}))),O},n.cleanup=function(e){throw B("cleanup")},n.migrationNeeded=function(){throw B("migration")},n.getMigrationState=function(){throw B("migration")},n.startMigration=function(e=10){return this.getMigrationState().startMigration(e)},n.migratePromise=function(e=10){return this.getMigrationState().migratePromise(e)},n.insert=async function(t){var n=await this.bulkInsert([t]),r=n.error[0];return jt(this,t[this.schema.primaryPath],t,r),e(n.success[0])},n.bulkInsert=async function(e){if(0===e.length)return{success:[],error:[]};var t=this.schema.primaryPath,n=e.map((e=>Yt(this.schema,e))),r=this.hasHooks("pre","insert")?await Promise.all(n.map((e=>this._runHooks("pre","insert",e).then((()=>e))))):n,i=r.map((e=>({document:e}))),o=await this.storageInstance.bulkWrite(i,"rx-collection-bulk-insert"),s=xo(this._docCache,o.success);if(this.hasHooks("post","insert")){var a=new Map;r.forEach((e=>{a.set(e[t],e)})),await Promise.all(s.map((e=>this._runHooks("post","insert",a.get(e.primary),e))))}return{success:s,error:o.error}},n.bulkRemove=async function(e){var t=this.schema.primaryPath;if(0===e.length)return{success:[],error:[]};var n=await this.findByIds(e).exec(),r=[],i=new Map;Array.from(n.values()).forEach((e=>{var t=e.toMutableJSON(!0);r.push(t),i.set(e.primary,t)})),await Promise.all(r.map((e=>{var t=e[this.schema.primaryPath];return this._runHooks("pre","remove",e,n.get(t))})));var o=r.map((e=>{var t=A(e);return t._deleted=!0,{previous:e,document:t}})),s=await this.storageInstance.bulkWrite(o,"rx-collection-bulk-remove"),a=s.success.map((e=>e[t]));return await Promise.all(a.map((e=>this._runHooks("post","remove",i.get(e),n.get(e))))),{success:a.map((e=>kt(n,e))),error:s.error}},n.bulkUpsert=async function(t){var n=[],r=new Map;t.forEach((e=>{var t=Yt(this.schema,e),i=t[this.schema.primaryPath];if(!i)throw V("COL3",{primaryPath:this.schema.primaryPath,data:t,schema:this.schema.jsonSchema});r.set(i,t),n.push(t)}));var i=await this.bulkInsert(n),o=i.success.slice(0),s=[];return await Promise.all(i.error.map((async t=>{if(409!==t.status)s.push(t);else{var n=t.documentId,i=kt(r,n),a=e(t.documentInDb),c=this._docCache.getCachedRxDocument(a),u=await c.incrementalModify((()=>i));o.push(u)}}))),{error:s,success:o}},n.upsert=async function(e){var t=await this.bulkUpsert([e]);return jt(this.asRxCollection,e[this.schema.primaryPath],e,t.error[0]),t.success[0]},n.incrementalUpsert=function(e){var t=Yt(this.schema,e),n=t[this.schema.primaryPath];if(!n)throw V("COL4",{data:e});var r=this._incrementalUpsertQueues.get(n);return r||(r=O),r=r.then((()=>function(e,t,n){var r=e._docCache.getLatestDocumentDataIfExists(t);return r?Promise.resolve({doc:e._docCache.getCachedRxDocument(r),inserted:!1}):e.findOne(t).exec().then((t=>t?{doc:t,inserted:!1}:e.insert(n).then((e=>({doc:e,inserted:!0})))))}(this,n,t))).then((e=>e.inserted?e.doc:function(e,t){return e.incrementalModify((e=>t))}(e.doc,t))),this._incrementalUpsertQueues.set(n,r),r},n.find=function(e){if("string"==typeof e)throw V("COL5",{queryObj:e});return e||(e={selector:{}}),Po("find",e,this)},n.findOne=function(e){if("number"==typeof e||Array.isArray(e))throw Y("COL6",{queryObj:e});var t;if("string"==typeof e)t=Po("findOne",{selector:{[this.schema.primaryPath]:e},limit:1},this);else{if(e||(e={selector:{}}),e.limit)throw V("QU6");(e=A(e)).limit=1,t=Po("findOne",e,this)}return t},n.count=function(e){return e||(e={selector:{}}),Po("count",e,this)},n.findByIds=function(e){return Po("findByIds",{selector:{[this.schema.primaryPath]:{$in:e.slice(0)}}},this)},n.exportJSON=function(){throw B("json-dump")},n.importJSON=function(e){throw B("json-dump")},n.insertCRDT=function(e){throw B("crdt")},n.addHook=function(e,t,n,r=!1){if("function"!=typeof n)throw Y("COL7",{key:t,when:e});if(!qo.includes(e))throw Y("COL8",{key:t,when:e});if(!Ko.includes(t))throw V("COL9",{key:t});if("post"===e&&"create"===t&&!0===r)throw V("COL10",{when:e,key:t,parallel:r});var i=n.bind(this),o=r?"parallel":"series";this.hooks[t]=this.hooks[t]||{},this.hooks[t][e]=this.hooks[t][e]||{series:[],parallel:[]},this.hooks[t][e][o].push(i)},n.getHooks=function(e,t){return this.hooks[t]&&this.hooks[t][e]?this.hooks[t][e]:{series:[],parallel:[]}},n.hasHooks=function(e,t){var n=this.getHooks(e,t);return!!n&&(n.series.length>0||n.parallel.length>0)},n._runHooks=function(e,t,n,r){var i,o=this.getHooks(e,t);return o?(i=o.series.map((e=>()=>e(n,r))),i.reduce(((e,t)=>e.then(t)),Promise.resolve(void 0))).then((()=>Promise.all(o.parallel.map((e=>e(n,r)))))):O},n._runHooksSync=function(e,t,n,r){var i=this.getHooks(e,t);i&&i.series.forEach((e=>e(n,r)))},n.promiseWait=function(e){return new Promise((t=>{var n=setTimeout((()=>{this.timeouts.delete(n),t()}),e);this.timeouts.add(n)}))},n.destroy=function(){return this.destroyed?C:(this.destroyed=!0,Array.from(this.timeouts).forEach((e=>clearTimeout(e))),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then((()=>Promise.all(this.onDestroy.map((e=>e()))))).then((()=>this.storageInstance.close())).then((()=>(this._subs.forEach((e=>e.unsubscribe())),delete this.database.collections[this.name],se("postDestroyRxCollection",this).then((()=>!0))))))},n.remove=async function(){await this.destroy(),await Gt(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.password,this.database.hashFunction)},w(t,[{key:"insert$",get:function(){return this.$.pipe(Et((e=>"INSERT"===e.operation)))}},{key:"update$",get:function(){return this.$.pipe(Et((e=>"UPDATE"===e.operation)))}},{key:"remove$",get:function(){return this.$.pipe(Et((e=>"DELETE"===e.operation)))}},{key:"asRxCollection",get:function(){return this}}]),t}();class Ho{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,zo()),this._to||(this._to=!0,setTimeout((()=>{this._to=!1,function(e){const t=zo()-e.ttl,n=e.map[Symbol.iterator]();for(;;){const r=n.next().value;if(!r)return;const i=r[0];if(!(r[1]<t))return;e.map.delete(i)}}(this)}),0))}clear(){this.map.clear()}}function zo(){return Date.now()}var Qo=new Set,Vo=function(){function t(t,n,r,o,s,a,c=!1,u={},l,h,d,f){this.idleQueue=new _,this.rxdbVersion="15.0.0-beta.41",this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.eventBulks$=new rt,this.observable$=this.eventBulks$.pipe(_t((e=>e.events))),this.storageToken=C,this.storageTokenDocument=C,this.emittedEventBulkIds=new Ho(6e4),this.name=t,this.token=n,this.storage=r,this.instanceCreationOptions=o,this.password=s,this.multiInstance=a,this.eventReduce=c,this.options=u,this.internalStore=l,this.hashFunction=h,this.cleanupPolicy=d,this.allowSlowCount=f,"pseudoInstance"!==this.name&&(this.internalStore=Lt(this.asRxDatabase,l,Kt),this.storageTokenDocument=async function(t){var n=i(10),r=t.password?await t.hashFunction(JSON.stringify(t.password)):void 0,o={id:zt,context:qt,key:Ht,data:{rxdbVersion:t.rxdbVersion,token:n,instanceToken:t.token,passwordHash:r},_deleted:!1,_meta:T(),_rev:"",_attachments:{}},s=await t.internalStore.bulkWrite([{document:o}],"internal-add-storage-token");if(s.success[0])return s.success[0];var a,c,u=e(s.error[0]);if(u.isError&&G(u)){var l=u;if(a=l.documentInDb.data.rxdbVersion,c=t.rxdbVersion,!a||c.includes("beta")&&c!==a||a.split(".")[0]!==c.split(".")[0])throw V("DM5",{args:{databaseStateVersion:l.documentInDb.data.rxdbVersion,codeVersion:t.rxdbVersion}});if(r&&r!==l.documentInDb.data.passwordHash)throw V("DB1",{passwordHash:r,existingPasswordHash:l.documentInDb.data.passwordHash});return e(l.documentInDb)}throw u}(this.asRxDatabase).catch((e=>this.startupErrors.push(e))),this.storageToken=this.storageTokenDocument.then((e=>e.data.token)).catch((e=>this.startupErrors.push(e))))}var n=t.prototype;return n.$emit=function(e){this.emittedEventBulkIds.has(e.id)||(this.emittedEventBulkIds.add(e.id),this.eventBulks$.next(e))},n.removeCollectionDoc=async function(e,t){var n=await Dt(this.internalStore,Ut(Vt(e,t),$t));if(!n)throw V("SNH",{name:e,schema:t});var r=Bt(n);r._deleted=!0,await this.internalStore.bulkWrite([{document:r,previous:n}],"rx-database-remove-collection")},n.addCollections=async function(t){var n={},r={},i=[],o={};await Promise.all(Object.entries(t).map((async([e,t])=>{var s=e,a=t.schema;n[s]=a;var c=function(e,t,n=!0){n&&oe("preCreateRxSchema",e);var r=ve(e);r=function(e){return j(e,!0)}(r),W.deepFreezeWhenDevMode(r);var i=new we(r,t);return oe("createRxSchema",i),i}(a,this.hashFunction);if(r[s]=c,this.collections[e])throw V("DB3",{name:e});var u=Vt(e,a),l={id:Ut(u,$t),key:u,context:$t,data:{name:s,schemaHash:await c.hash,schema:c.jsonSchema,version:c.version,connectedStorages:[]},_deleted:!1,_meta:T(),_rev:"",_attachments:{}};i.push({document:l});var h=Object.assign({},t,{name:s,schema:c,database:this}),d=A(t);d.database=this,d.name=e,oe("preCreateRxCollection",d),h.conflictHandler=d.conflictHandler,o[s]=h})));var s=await this.internalStore.bulkWrite(i,"rx-database-add-collection");await async function(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}(this),await Promise.all(s.error.map((async t=>{if(409!==t.status)throw V("DB12",{database:this.name,writeError:t});var i=e(t.documentInDb),o=i.data.name,s=r[o];if(i.data.schemaHash!==await s.hash)throw V("DB6",{database:this.name,collection:o,previousSchemaHash:i.data.schemaHash,schemaHash:await s.hash,previousSchema:i.data.schema,schema:e(n[o])})})));var a={};return await Promise.all(Object.keys(t).map((async e=>{var t=o[e],n=await function({database:e,name:t,schema:n,instanceCreationOptions:r={},migrationStrategies:i={},autoMigrate:o=!0,statics:s={},methods:a={},attachments:c={},options:u={},localDocuments:l=!1,cacheReplacementPolicy:h=Eo,conflictHandler:d=$o}){var f={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:n.jsonSchema,options:r,multiInstance:e.multiInstance,password:e.password,devMode:W.isDevMode()};return oe("preCreateRxStorageInstance",f),async function(e,t){return t.multiInstance=e.multiInstance,await e.storage.createStorageInstance(t)}(e,f).then((f=>{var p=new Wo(e,t,n,f,r,i,a,c,u,h,s,d);return p.prepare().then((()=>{Object.entries(s).forEach((([e,t])=>{Object.defineProperty(p,e,{get:()=>t.bind(p)})}));var e=O;return o&&0!==p.schema.version&&(e=p.migratePromise()),e})).then((()=>(oe("createRxCollection",{collection:p,creator:{name:t,schema:n,storageInstance:f,instanceCreationOptions:r,migrationStrategies:i,methods:a,attachments:c,options:u,cacheReplacementPolicy:h,localDocuments:l,statics:s}}),p))).catch((e=>f.close().then((()=>Promise.reject(e)))))}))}(t);a[e]=n,this.collections[e]=n,this[e]||Object.defineProperty(this,e,{get:()=>this.collections[e]})}))),a},n.lockedRun=function(e){return this.idleQueue.wrapCall(e)},n.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},n.exportJSON=function(e){throw B("json-dump")},n.importJSON=function(e){throw B("json-dump")},n.backup=function(e){throw B("backup")},n.leaderElector=function(){throw B("leader-election")},n.isLeader=function(){throw B("leader-election")},n.waitForLeadership=function(){throw B("leader-election")},n.migrationStates=function(){throw B("migration")},n.destroy=async function(){return this.destroyed?C:(this.destroyed=!0,await se("preDestroyRxDatabase",this),this.eventBulks$.complete(),this._subs.map((e=>e.unsubscribe())),"pseudoInstance"===this.name?C:this.requestIdlePromise().then((()=>Promise.all(this.onDestroy.map((e=>e()))))).then((()=>Promise.all(Object.keys(this.collections).map((e=>this.collections[e])).map((e=>e.destroy()))))).then((()=>this.internalStore.close())).then((()=>Qo.delete(this.name))).then((()=>!0)))},n.remove=function(){return this.destroy().then((()=>async function(e,t,n){var r=i(10),o=await Yo(r,t,e,{},!1,n),s=await Wt(t.statics,o),a=new Set;s.forEach((e=>a.add(e.data.name)));var c=Array.from(a);return await Promise.all(c.map((i=>Gt(t,o,r,e,i,n)))),await se("postRemoveRxDatabase",{databaseName:e,storage:t}),await o.remove(),c}(this.name,this.storage,this.password)))},w(t,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}]),t}();async function Yo(e,t,n,r,i,o){return await t.createStorageInstance({databaseInstanceToken:e,databaseName:n,collectionName:Pt,schema:Kt,options:r,multiInstance:i,password:o,devMode:W.isDevMode()})}function Go({storage:e,instanceCreationOptions:t,name:n,password:r,multiInstance:o=!0,eventReduce:s=!0,ignoreDuplicate:a=!1,options:c={},cleanupPolicy:u,allowSlowCount:l=!1,localDocuments:h=!1,hashFunction:d=v}){oe("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:n,password:r,multiInstance:o,eventReduce:s,ignoreDuplicate:a,options:c,localDocuments:h}),a||function(e){if(Qo.has(e))throw V("DB8",{name:e,link:"https://pubkey.github.io/rxdb/rx-database.html#ignoreduplicate"})}(n),Qo.add(n);var f=i(10);return Yo(f,e,n,t,o,r).catch((e=>{throw Qo.delete(n),e})).then((i=>{var p=new Vo(n,f,e,t,r,o,s,c,i,d,u,l);return se("createRxDatabase",{database:p,creator:{storage:e,instanceCreationOptions:t,name:n,password:r,multiInstance:o,eventReduce:s,ignoreDuplicate:a,options:c,localDocuments:h}}).then((()=>p))}))}const Jo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Xo=Object.keys,Zo=Array.isArray;function es(e,t){return"object"!=typeof t||Xo(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||Jo.Promise||(Jo.Promise=Promise);const ts=Object.getPrototypeOf,ns={}.hasOwnProperty;function rs(e,t){return ns.call(e,t)}function is(e,t){"function"==typeof t&&(t=t(ts(e))),("undefined"==typeof Reflect?Xo:Reflect.ownKeys)(t).forEach((n=>{ss(e,n,t[n])}))}const os=Object.defineProperty;function ss(e,t,n,r){os(e,t,es(n&&rs(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function as(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ss(e.prototype,"constructor",e),{extend:is.bind(null,e.prototype)}}}}const cs=Object.getOwnPropertyDescriptor;function us(e,t){let n;return cs(e,t)||(n=ts(e))&&us(n,t)}const ls=[].slice;function hs(e,t,n){return ls.call(e,t,n)}function ds(e,t){return t(e)}function fs(e){if(!e)throw new Error("Assertion Failed")}function ps(e){Jo.setImmediate?setImmediate(e):setTimeout(e,0)}function ms(e,t){return e.reduce(((e,n,r)=>{var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function ys(e,t){if(rs(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=ys(e,t[r]);n.push(o)}return n}var s=t.indexOf(".");if(-1!==s){var a=e[t.substr(0,s)];return void 0===a?void 0:ys(a,t.substr(s+1))}}function vs(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){fs("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)vs(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var s=t.substr(0,o),a=t.substr(o+1);if(""===a)void 0===n?Zo(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var c=e[s];c&&rs(e,s)||(c=e[s]={}),vs(c,a,n)}}else void 0===n?Zo(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function gs(e){var t={};for(var n in e)rs(e,n)&&(t[n]=e[n]);return t}const bs=[].concat;function ws(e){return bs.apply([],e)}const _s="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ws([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>Jo[e])),Es=_s.map((e=>Jo[e]));ms(_s,(e=>[e,!0]));let ks=null;function Ss(e){ks="undefined"!=typeof WeakMap&&new WeakMap;const t=xs(e);return ks=null,t}function xs(e){if(!e||"object"!=typeof e)return e;let t=ks&&ks.get(e);if(t)return t;if(Zo(e)){t=[],ks&&ks.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(xs(e[n]))}else if(Es.indexOf(e.constructor)>=0)t=e;else{const n=ts(e);for(var i in t=n===Object.prototype?{}:Object.create(n),ks&&ks.set(e,t),e)rs(e,i)&&(t[i]=xs(e[i]))}return t}const{toString:Cs}={};function Rs(e){return Cs.call(e).slice(8,-1)}const Os="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",Is="symbol"==typeof Os?function(e){var t;return null!=e&&(t=e[Os])&&t.apply(e)}:function(){return null},Ps={};function Ds(e){var t,n,r,i;if(1===arguments.length){if(Zo(e))return e.slice();if(this===Ps&&"string"==typeof e)return[e];if(i=Is(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Ts="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var As="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function js(e,t){As=e,Ms=t}var Ms=()=>!0;const Ns=!new Error("").stack;function Bs(){if(Ns)try{throw Bs.arguments,new Error}catch(e){return e}return new Error}function Ls(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(Ms).map((e=>"\n"+e)).join("")):""}var Fs=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],$s=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Fs),qs={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ks(e,t){this._e=Bs(),this.name=e,this.message=t}function Us(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function Ws(e,t,n,r){this._e=Bs(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Us(e,t)}function Hs(e,t){this._e=Bs(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=Us(e,t)}as(Ks).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ls(this._e,2))}},toString:function(){return this.name+": "+this.message}}),as(Ws).from(Ks),as(Hs).from(Ks);var zs=$s.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const Qs=Ks;var Vs=$s.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=Bs(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=qs[t]||n,this.inner=null)}return as(r).from(Qs),e[t]=r,e}),{});Vs.Syntax=SyntaxError,Vs.Type=TypeError,Vs.Range=RangeError;var Ys=Fs.reduce(((e,t)=>(e[t+"Error"]=Vs[t],e)),{}),Gs=$s.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Vs[t]),e)),{});function Js(){}function Xs(e){return e}function Zs(e,t){return null==e||e===Xs?t:function(n){return t(e(n))}}function ea(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ta(e,t){return e===Js?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ea(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ea(i,this.onerror):i),void 0!==o?o:n}}function na(e,t){return e===Js?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ea(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ea(r,this.onerror):r)}}function ra(e,t){return e===Js?t:function(n){var r=e.apply(this,arguments);es(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ea(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ea(o,this.onerror):o),void 0===r?void 0===s?void 0:s:es(r,s)}}function ia(e,t){return e===Js?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function oa(e,t){return e===Js?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return t.apply(r,o)}))}return t.apply(this,arguments)}}Gs.ModifyError=Ws,Gs.DexieError=Ks,Gs.BulkError=Hs;var sa={};const[aa,ca,ua]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,ts(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,ts(t),e]})(),la=ca&&ca.then,ha=aa&&aa.constructor,da=!!ua;var fa=!1,pa=ua?()=>{ua.then(Ba)}:Jo.setImmediate?setImmediate.bind(null,Ba):Jo.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Ba(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Ba,0)},ma=function(e,t){Sa.push([e,t]),va&&(pa(),va=!1)},ya=!0,va=!0,ga=[],ba=[],wa=null,_a=Xs,Ea={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ac,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{ac(e[0],e[1])}catch(e){}}))}},ka=Ea,Sa=[],xa=0,Ca=[];function Ra(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Js,this._lib=!1;var t=this._PSD=ka;if(As&&(this._stackHolder=Bs(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==sa)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Da(this,this._value))}this._state=null,this._value=null,++t.ref,Pa(this,e)}const Oa={get:function(){var e=ka,t=Qa;function n(n,r){var i=!e.global&&(e!==ka||t!==Qa);const o=i&&!Ja();var s=new Ra(((t,s)=>{Aa(this,new Ia(oc(n,e,i,o),oc(r,e,i,o),t,s,e))}));return As&&Na(s,this),s}return n.prototype=sa,n},set:function(e){ss(this,"then",e&&e.prototype===sa?Oa:{get:function(){return e},set:Oa.set})}};function Ia(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Pa(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&La();t&&"function"==typeof t.then?Pa(e,((e,n)=>{t instanceof Ra?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Ta(e)),n&&Fa()}}),Da.bind(null,e))}catch(t){Da(e,t)}}function Da(e,t){if(ba.push(t),null===e._state){var n=e._lib&&La();t=_a(t),e._state=!1,e._value=t,As&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=us(t,"stack");t._promise=e,ss(t,"stack",{get:()=>fa?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){ga.some((t=>t._value===e._value))||ga.push(e)}(e),Ta(e),n&&Fa()}}function Ta(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Aa(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===xa&&(++xa,ma((()=>{0==--xa&&$a()}),[]))}function Aa(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++xa,ma(ja,[n,e,t])}else e._listeners.push(t)}function ja(e,t,n){try{wa=t;var r,i=t._value;t._state?r=e(i):(ba.length&&(ba=[]),r=e(i),-1===ba.indexOf(i)&&function(e){for(var t=ga.length;t;)if(ga[--t]._value===e._value)return void ga.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{wa=null,0==--xa&&$a(),--n.psd.ref||n.psd.finalize()}}function Ma(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,o,s=e._value;null!=s?(i=s.name||"Error",o=s.message||s,r=Ls(s,0)):(i=s,o=""),t.push(i+(o?": "+o:"")+r)}return As&&((r=Ls(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ma(e._prev,t,n)),t}function Na(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ba(){La()&&Fa()}function La(){var e=ya;return ya=!1,va=!1,e}function Fa(){var e,t,n;do{for(;Sa.length>0;)for(e=Sa,Sa=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Sa.length>0);ya=!0,va=!0}function $a(){var e=ga;ga=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ca.slice(0),n=t.length;n;)t[--n]()}function qa(e){return new Ra(sa,!1,e)}function Ka(e,t){var n=ka;return function(){var r=La(),i=ka;try{return tc(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{tc(i,!1),r&&Fa()}}}is(Ra.prototype,{then:Oa,_then:function(e,t){Aa(this,new Ia(null,null,e,t,ka))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):qa(e))):this.then(null,(e=>e&&e.name===t?n(e):qa(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),qa(t))))},stack:{get:function(){if(this._stack)return this._stack;try{fa=!0;var e=Ma(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{fa=!1}}},timeout:function(e,t){return e<1/0?new Ra(((n,r)=>{var i=setTimeout((()=>r(new Vs.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&ss(Ra.prototype,Symbol.toStringTag,"Dexie.Promise"),Ea.env=nc(),is(Ra,{all:function(){var e=Ds.apply(null,arguments).map(Xa);return new Ra((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((i,o)=>Ra.resolve(i).then((n=>{e[o]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Ra)return e;if(e&&"function"==typeof e.then)return new Ra(((t,n)=>{e.then(t,n)}));var t=new Ra(sa,!0,e);return Na(t,wa),t},reject:qa,race:function(){var e=Ds.apply(null,arguments).map(Xa);return new Ra(((t,n)=>{e.map((e=>Ra.resolve(e).then(t,n)))}))},PSD:{get:()=>ka,set:e=>ka=e},totalEchoes:{get:()=>Qa},newPSD:Ya,usePSD:rc,scheduler:{get:()=>ma,set:e=>{ma=e}},rejectionMapper:{get:()=>_a,set:e=>{_a=e}},follow:(e,t)=>new Ra(((n,r)=>Ya(((t,n)=>{var r=ka;r.unhandleds=[],r.onunhandled=n,r.finalize=ea((function(){!function(e){Ca.push((function t(){e(),Ca.splice(Ca.indexOf(t),1)})),++xa,ma((()=>{0==--xa&&$a()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),ha&&(ha.allSettled&&ss(Ra,"allSettled",(function(){const e=Ds.apply(null,arguments).map(Xa);return new Ra((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,i)=>Ra.resolve(e).then((e=>r[i]={status:"fulfilled",value:e}),(e=>r[i]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),ha.any&&"undefined"!=typeof AggregateError&&ss(Ra,"any",(function(){const e=Ds.apply(null,arguments).map(Xa);return new Ra(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach(((e,o)=>Ra.resolve(e).then((e=>t(e)),(e=>{i[o]=e,--r||n(new AggregateError(i))}))))}))})));const Ua={awaits:0,echoes:0,id:0};var Wa=0,Ha=[],za=0,Qa=0,Va=0;function Ya(e,t,n,r){var i=ka,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Va;var s=Ea.env;o.env=da?{Promise:Ra,PromiseProp:{value:Ra,configurable:!0,writable:!0},all:Ra.all,race:Ra.race,allSettled:Ra.allSettled,any:Ra.any,resolve:Ra.resolve,reject:Ra.reject,nthen:sc(s.nthen,o),gthen:sc(s.gthen,o)}:{},t&&es(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=rc(o,e,n,r);return 0===o.ref&&o.finalize(),a}function Ga(){return Ua.id||(Ua.id=++Wa),++Ua.awaits,Ua.echoes+=100,Ua.id}function Ja(){return!!Ua.awaits&&(0==--Ua.awaits&&(Ua.id=0),Ua.echoes=100*Ua.awaits,!0)}function Xa(e){return Ua.echoes&&e&&e.constructor===ha?(Ga(),e.then((e=>(Ja(),e)),(e=>(Ja(),cc(e))))):e}function Za(e){++Qa,Ua.echoes&&0!=--Ua.echoes||(Ua.echoes=Ua.id=0),Ha.push(ka),tc(e,!0)}function ec(){var e=Ha[Ha.length-1];Ha.pop(),tc(e,!1)}function tc(e,t){var n=ka;if((t?!Ua.echoes||za++&&e===ka:!za||--za&&e===ka)||ic(t?Za.bind(null,e):ec),e!==ka&&(ka=e,n===Ea&&(Ea.env=nc()),da)){var r=Ea.env.Promise,i=e.env;ca.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(Jo,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function nc(){var e=Jo.Promise;return da?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Jo,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ca.then,gthen:e.prototype.then}:{}}function rc(e,t,n,r,i){var o=ka;try{return tc(e,!0),t(n,r,i)}finally{tc(o,!1)}}function ic(e){la.call(aa,e)}function oc(e,t,n,r){return"function"!=typeof e?e:function(){var i=ka;n&&Ga(),tc(t,!0);try{return e.apply(this,arguments)}finally{tc(i,!1),r&&ic(Ja)}}}function sc(e,t){return function(n,r){return e.call(this,oc(n,t),oc(r,t))}}function ac(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(Jo.document&&document.createEvent?((r=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),es(r,i)):Jo.CustomEvent&&es(r=new CustomEvent("unhandledrejection",{detail:i}),i),r&&Jo.dispatchEvent&&(dispatchEvent(r),!Jo.PromiseRejectionEvent&&Jo.onunhandledrejection))try{Jo.onunhandledrejection(r)}catch(e){}As&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+la).indexOf("[native code]")&&(Ga=Ja=Js);var cc=Ra.reject;function uc(e,t,n,r){if(e.idbdb&&(e._state.openComplete||ka.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===zs.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>uc(e,t,n,r)))):cc(i)}return i._promise(t,((e,t)=>Ya((()=>(ka.trans=i,r(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return cc(new Vs.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return cc(new Vs.DatabaseClosed);e.open().catch(Js)}return e._state.dbReadyPromise.then((()=>uc(e,t,n,r)))}const lc=String.fromCharCode(65535),hc="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",dc=[],fc="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),pc=fc,mc=fc,yc=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function vc(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const gc={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function bc(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=Ss(t))[e],t)}function wc(){throw Vs.Type()}class _c{_trans(e,t,n){const r=this._tx||ka.trans,i=this.name;function o(e,n,r){if(!r.schema[i])throw new Vs.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}const s=La();try{return r&&r.db===this.db?r===ka.trans?r._promise(e,o,n):Ya((()=>r._promise(e,o,n)),{trans:r,transless:ka.transless||ka}):uc(this.db,e,[this.name],o)}finally{s&&Fa()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(Zo(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=Xo(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==lc)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&As&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,i=this.db._deps.indexedDB;function o(e,t){try{return 0===i.cmp(e,t)}catch(e){return!1}}const[s,a]=t.reduce((([t,n],i)=>{const s=r[i],a=e[i];return[t||s,t||!s?vc(n,s&&s.multi?e=>{const t=ys(e,i);return Zo(t)&&t.some((e=>o(a,e)))}:e=>o(a,ys(e,i))):n]}),[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(a):n?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Zo(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){const{db:t,name:n}=this;this.schema.mappedClass=e,e.prototype instanceof wc&&(e=class extends e{get db(){return t}table(){return n}});const r=new Set;for(let t=e.prototype;t;t=ts(t))Object.getOwnPropertyNames(t).forEach((e=>r.add(e)));const i=t=>{if(!t)return t;const n=Object.create(e.prototype);for(let e in t)if(!r.has(e))try{n[e]=t[e]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),e}defineClass(){return this.mapToClass((function(e){es(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=bc(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Ra.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{vs(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||Zo(e))return this.where(":id").equals(e).modify(t);{const n=ys(e,this.schema.primKey.keyPath);if(void 0===n)return cc(new Vs.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?Xo(t).forEach((n=>{vs(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=bc(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ra.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{vs(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ra.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:gc}))).then((e=>e.numFailures?Ra.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:o}=this.schema.primKey;if(o&&r)throw new Vs.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new Vs.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let a=o&&n?e.map(bc(o)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new Hs(`${this.name}.bulkAdd(): ${e} of ${s} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:o}=this.schema.primKey;if(o&&r)throw new Vs.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new Vs.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let a=o&&n?e.map(bc(o)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new Hs(`${this.name}.bulkPut(): ${e} of ${s} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new Hs(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Ec(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"==typeof n)return t[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(e,r,i){if("object"==typeof e)return s(e);r||(r=ia),i||(i=Js);var o={subscribers:[],fire:i,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(e){o.subscribers=o.subscribers.filter((function(t){return t!==e})),o.fire=o.subscribers.reduce(r,i)}};return t[e]=n[e]=o,o}function s(e){Xo(e).forEach((function(t){var n=e[t];if(Zo(n))o(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new Vs.InvalidArgument("Invalid event config");var r=o(t,Xs,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){ps((function(){e.apply(null,t)}))}))}))}}))}}function kc(e,t){return as(t).from({prototype:e}),t}function Sc(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function xc(e,t){e.filter=vc(e.filter,t)}function Cc(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>vc(r(),t()):t,e.justLimit=n&&!r}function Rc(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new Vs.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Oc(e,t,n){const r=Rc(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ic(e,t,n,r){const i=e.replayFilter?vc(e.filter,e.replayFilter()):e.filter;if(e.or){const o={},s=(e,n,r)=>{if(!i||i(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var s=n.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),rs(o,a)||(o[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),Pc(Oc(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Pc(Oc(e,r,n),vc(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Pc(e,t,n,r){var i=Ka(r?(e,t,i)=>n(r(e),t,i):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=Js}),(t=>{e.fail(t),n=Js}))||i(e.value,e,(e=>n=e)),n()}))}))}function Dc(e,t){try{const n=Tc(e),r=Tc(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(Ac(e),Ac(t));case"Array":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n){const r=Dc(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function Tc(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=Rs(e);return"ArrayBuffer"===n?"binary":n}function Ac(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class jc{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,cc.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,cc.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=vc(t.algorithm,e)}_iterate(e,t){return Ic(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&es(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Ic(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Sc(t,!0))return n.count({trans:e,query:{index:Rc(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return Ic(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function a(e,t){var n=o(e,i),r=o(t,i);return n<r?-s:n>r?s:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Sc(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=Rc(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Ic(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Sc(t)?Cc(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Cc(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Cc(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return xc(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return xc(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=vc(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Sc(t,!0)&&t.limit>0)return this._read((e=>{var n=Rc(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return xc(this._ctx,(function(e){var t=e.primaryKey.toString(),r=rs(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var i=Xo(e),o=i.length;r=function(t){for(var n=!1,r=0;r<o;++r){var s=i[r],a=e[s];ys(t,s)!==a&&(vs(t,s,a),n=!0)}return n}}const s=t.table.core,{outbound:a,extractKey:c}=s.schema.primaryKey,u=this.db._options.modifyChunkSize||200,l=[];let h=0;const d=[],f=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of Xo(n))l.push(n[e])};return this.clone().primaryKeys().then((i=>{const o=l=>{const h=Math.min(u,i.length-l);return s.getMany({trans:n,keys:i.slice(l,l+h),cache:"immutable"}).then((d=>{const p=[],m=[],y=a?[]:null,v=[];for(let e=0;e<h;++e){const t=d[e],n={value:Ss(t),primKey:i[l+e]};!1!==r.call(n,n.value,n)&&(null==n.value?v.push(i[l+e]):a||0===Dc(c(t),c(n.value))?(m.push(n.value),a&&y.push(i[l+e])):(v.push(i[l+e]),p.push(n.value)))}const g=Sc(t)&&t.limit===1/0&&("function"!=typeof e||e===Mc)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&s.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)v.splice(parseInt(t),1);f(p.length,e)}))).then((()=>(m.length>0||g&&"object"==typeof e)&&s.mutate({trans:n,type:"put",keys:y,values:m,criteria:g,changeSpec:"function"!=typeof e&&e}).then((e=>f(m.length,e))))).then((()=>(v.length>0||g&&e===Mc)&&s.mutate({trans:n,type:"delete",keys:v,criteria:g}).then((e=>f(v.length,e))))).then((()=>i.length>l+h&&o(l+u)))}))};return o(0).then((()=>{if(l.length>0)throw new Ws("Error modifying one or more objects",l,h,d);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Sc(e)&&(e.isPrimKey&&!mc||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((({failures:e,lastResult:n,results:r,numFailures:i})=>{if(i)throw new Ws("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify(Mc)}}const Mc=(e,t)=>t.value=null;function Nc(e,t){return e<t?-1:e===t?0:1}function Bc(e,t){return e>t?-1:e===t?0:1}function Lc(e,t,n){var r=e instanceof Wc?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Fc(e){return new e.Collection(e,(()=>Uc(""))).limit(0)}function $c(e,t,n,r,i,o){for(var s=Math.min(e.length,r.length),a=-1,c=0;c<s;++c){var u=t[c];if(u!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[c],u)<0&&(a=c)}return s<r.length&&"next"===o?e+n.substr(e.length):s<e.length&&"prev"===o?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function qc(e,t,n,r){var i,o,s,a,c,u,l,h=n.length;if(!n.every((e=>"string"==typeof e)))return Lc(e,"String expected.");function d(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),o=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),s="next"===e?Nc:Bc;var t=n.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),u=e,l="next"===e?"":r}d("next");var f=new e.Collection(e,(()=>Kc(a[0],c[h-1]+r)));f._ondirectionchange=function(e){d(e)};var p=0;return f._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var d=o(i);if(t(d,c,p))return!0;for(var f=null,m=p;m<h;++m){var y=$c(i,d,a[m],c[m],s,u);null===y&&null===f?p=m+1:(null===f||s(f,y)>0)&&(f=y)}return n(null!==f?function(){e.continue(f+l)}:r),!1})),f}function Kc(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Uc(e){return{type:1,lower:e,upper:e}}class Wc{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Fc(this):new this.Collection(this,(()=>Kc(e,t,!n,!r)))}catch(e){return Lc(this,hc)}}equals(e){return null==e?Lc(this,hc):new this.Collection(this,(()=>Uc(e)))}above(e){return null==e?Lc(this,hc):new this.Collection(this,(()=>Kc(e,void 0,!0)))}aboveOrEqual(e){return null==e?Lc(this,hc):new this.Collection(this,(()=>Kc(e,void 0,!1)))}below(e){return null==e?Lc(this,hc):new this.Collection(this,(()=>Kc(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Lc(this,hc):new this.Collection(this,(()=>Kc(void 0,e)))}startsWith(e){return"string"!=typeof e?Lc(this,"String expected."):this.between(e,e+lc,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):qc(this,((e,t)=>0===e.indexOf(t[0])),[e],lc)}equalsIgnoreCase(e){return qc(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=Ds.apply(Ps,arguments);return 0===e.length?Fc(this):qc(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=Ds.apply(Ps,arguments);return 0===e.length?Fc(this):qc(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,lc)}anyOf(){const e=Ds.apply(Ps,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Lc(this,hc)}if(0===e.length)return Fc(this);const n=new this.Collection(this,(()=>Kc(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,i,o)=>{const s=n.key;for(;t(s,e[r])>0;)if(++r,r===e.length)return i(o),!1;return 0===t(s,e[r])||(i((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Ds.apply(Ps,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Lc(this,hc)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,i=this._descending,o=this._min,s=this._max;if(0===e.length)return Fc(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Lc(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Vs.InvalidArgument);const a=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let u,l=r;function h(e,t){return l(e[0],t[0])}try{u=e.reduce((function(e,t){let r=0,i=e.length;for(;r<i;++r){const i=e[r];if(n(t[0],i[1])<0&&n(t[1],i[0])>0){i[0]=o(i[0],t[0]),i[1]=s(i[1],t[1]);break}}return r===i&&e.push(t),e}),[]),u.sort(h)}catch(e){return Lc(this,hc)}let d=0;const f=c?e=>r(e,u[d][1])>0:e=>r(e,u[d][1])>=0,p=a?e=>i(e,u[d][0])>0:e=>i(e,u[d][0])>=0;let m=f;const y=new this.Collection(this,(()=>Kc(u[0][0],u[u.length-1][1],!a,!c)));return y._ondirectionchange=e=>{"next"===e?(m=f,l=r):(m=p,l=i),u.sort(h)},y._addAlgorithm(((e,t,n)=>{for(var i=e.key;m(i);)if(++d,d===u.length)return t(n),!1;return!!function(e){return!f(e)&&!p(e)}(i)||(0===this._cmp(i,u[d][1])||0===this._cmp(i,u[d][0])||t((()=>{l===r?e.continue(u[d][0]):e.continue(u[d][1])})),!1)})),y}startsWithAnyOf(){const e=Ds.apply(Ps,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Fc(this):this.inAnyRange(e.map((e=>[e,e+lc]))):Lc(this,"startsWithAnyOf() only works with strings")}}function Hc(e){return Ka((function(t){return zc(t),e(t.target.error),!1}))}function zc(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Qc=Ec(null,"storagemutated");class Vc{_lock(){return fs(!ka.global),++this._reculock,1!==this._reculock||ka.global||(ka.lockOwnerFor=this),this}_unlock(){if(fs(!ka.global),0==--this._reculock)for(ka.global||(ka.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{rc(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&ka.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(fs(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new Vs.DatabaseClosed(n);case"MissingAPIError":throw new Vs.MissingAPI(n.message,n);default:throw new Vs.OpenFailed(n)}if(!this.active)throw new Vs.TransactionInactive;return fs(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ka((t=>{zc(t),this._reject(e.error)})),e.onabort=Ka((t=>{zc(t),this.active&&this._reject(new Vs.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Ka((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Qc.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return cc(new Vs.ReadOnly("Transaction is readonly"));if(!this.active)return cc(new Vs.TransactionInactive);if(this._locked())return new Ra(((r,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,i)},ka])}));if(n)return Ya((()=>{var e=new Ra(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Ra(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Ra.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ra(((e,r)=>{n.then((n=>t._waitingQueue.push(Ka(e.bind(null,n)))),(e=>t._waitingQueue.push(Ka(r.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Vs.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(rs(t,e))return t[e];const n=this.schema[e];if(!n)throw new Vs.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function Yc(e,t,n,r,i,o,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Gc(t)}}function Gc(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Jc(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:ms(n,(e=>[e.name,e]))}}let Xc=e=>{try{return e.only([[]]),Xc=()=>[[]],[[]]}catch(e){return Xc=()=>lc,lc}};function Zc(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>ys(t,e)}(e):t=>ys(t,e)}function eu(e){return[].slice.call(e)}let tu=0;function nu(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function ru(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:i,upperOpen:o}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}const{schema:i,hasGetAll:o}=function(e,t){const n=eu(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=Zo(t),i=null==t,o={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:Zc(t)},indexes:eu(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:i}=e,s={name:t,compound:Zo(i),keyPath:i,unique:n,multiEntry:r,extractKey:Zc(i)};return o[nu(i)]=s,s})),getIndexByKeyPath:e=>o[nu(e)]};return o[":id"]=s.primaryKey,null!=t&&(o[nu(t)]=s.primaryKey),s}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),s=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:i,values:o,range:s}){return new Promise(((a,c)=>{a=Ka(a);const u=e.objectStore(t),l=null==u.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:d}=i||o||{length:1};if(i&&o&&i.length!==o.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let f;const p=[],m=[];let y=0;const v=e=>{++y,zc(e)};if("deleteRange"===n){if(4===s.type)return a({numFailures:y,failures:m,results:[],lastResult:void 0});3===s.type?p.push(f=u.clear()):p.push(f=u.delete(r(s)))}else{const[e,t]=h?l?[o,i]:[o,null]:[i,null];if(h)for(let r=0;r<d;++r)p.push(f=t&&void 0!==t[r]?u[n](e[r],t[r]):u[n](e[r])),f.onerror=v;else for(let t=0;t<d;++t)p.push(f=u[n](e[t])),f.onerror=v}const g=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(m[t]=e.error))),a({numFailures:y,failures:m,results:"delete"===n?i:p.map((e=>e.result)),lastResult:t})};f.onerror=e=>{v(e),g(e)},f.onsuccess=g}))},getMany:({trans:e,keys:n})=>new Promise(((r,i)=>{r=Ka(r);const o=e.objectStore(t),s=n.length,a=new Array(s);let c,u=0,l=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++l===u&&r(a)},d=Hc(i);for(let e=0;e<s;++e)null!=n[e]&&(c=o.get(n[e]),c._pos=e,c.onsuccess=h,c.onerror=d,++u);0===u&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,i)=>{r=Ka(r);const o=e.objectStore(t).get(n);o.onsuccess=e=>r(e.target.result),o.onerror=Hc(i)})),query:function(e){return n=>new Promise(((i,o)=>{i=Ka(i);const{trans:s,values:a,limit:c,query:u}=n,l=c===1/0?void 0:c,{index:h,range:d}=u,f=s.objectStore(t),p=h.isPrimaryKey?f:f.index(h.name),m=r(d);if(0===c)return i({result:[]});if(e){const e=a?p.getAll(m,l):p.getAllKeys(m,l);e.onsuccess=e=>i({result:e.target.result}),e.onerror=Hc(o)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(m):p.openKeyCursor(m),n=[];t.onsuccess=r=>{const o=t.result;return o?(n.push(a?o.value:o.primaryKey),++e===c?i({result:n}):void o.continue()):i({result:n})},t.onerror=Hc(o)}}))}(o),openCursor:function({trans:e,values:n,query:i,reverse:o,unique:s}){return new Promise(((a,c)=>{a=Ka(a);const{index:u,range:l}=i,h=e.objectStore(t),d=u.isPrimaryKey?h:h.index(u.name),f=o?s?"prevunique":"prev":s?"nextunique":"next",p=n||!("openKeyCursor"in d)?d.openCursor(r(l),f):d.openKeyCursor(r(l),f);p.onerror=Hc(c),p.onsuccess=Ka((t=>{const n=p.result;if(!n)return void a(null);n.___id=++tu,n.done=!1;const r=n.continue.bind(n);let i=n.continuePrimaryKey;i&&(i=i.bind(n));const o=n.advance.bind(n),s=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Ka(c),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=Ka(e),p.onerror=Hc(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=s,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=Ka((e=>{p.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=i,n.advance=o,a(),t},a(n)}),c)}))},count({query:e,trans:n}){const{index:i,range:o}=e;return new Promise(((e,s)=>{const a=n.objectStore(t),c=i.isPrimaryKey?a:a.index(i.name),u=r(o),l=u?c.count(u):c.count();l.onsuccess=Ka((t=>e(t.target.result))),l.onerror=Hc(s)}))}}}(e))),a={};return s.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:Xc(t),schema:i}}function iu({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},i){const o=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(ru(t,n,i),e.dbcore);return{dbcore:o}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function ou({_novip:e},t,n,r){n.forEach((n=>{const i=r[n];t.forEach((t=>{const r=us(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?ss(t,n,{get(){return this.table(n)},set(e){os(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function su({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function au(e,t){return e._cfg.version-t._cfg.version}function cu(e,t,n,r){const i=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);const s=o._reject.bind(o),a=ka.transless||ka;Ya((()=>{ka.trans=o,ka.transless=a,0===t?(Xo(i).forEach((e=>{lu(n,e,i[e].primKey,i[e].indexes)})),iu(e,n),Ra.follow((()=>e.on.populate.fire(o))).catch(s)):function({_novip:e},t,n,r){const i=[],o=e._versions;let s=e._dbSchema=du(0,e.idbdb,r),a=!1;return o.filter((e=>e._cfg.version>=t)).forEach((o=>{i.push((()=>{const i=s,c=o._cfg.dbschema;fu(e,i,r),fu(e,c,r),s=e._dbSchema=c;const u=uu(i,c);u.add.forEach((e=>{lu(r,e[0],e[1].primKey,e[1].indexes)})),u.change.forEach((e=>{if(e.recreate)throw new Vs.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>hu(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),hu(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const l=o._cfg.contentUpgrade;if(l&&o._cfg.version>t){iu(e,r),n._memoizedTables={},a=!0;let t=gs(c);u.del.forEach((e=>{t[e]=i[e]})),su(e,[e.Transaction.prototype]),ou(e,[e.Transaction.prototype],Xo(t),t),n.schema=t;const o=Ts(l);let s;o&&Ga();const h=Ra.follow((()=>{if(s=l(n),s&&o){var e=Ja.bind(null,null);s.then(e,e)}}));return s&&"function"==typeof s.then?Ra.resolve(s):h.then((()=>s))}})),i.push((t=>{a&&pc||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(o._cfg.dbschema,t),su(e,[e.Transaction.prototype]),ou(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return i.length?Ra.resolve(i.shift()(n.idbtrans)).then(e):Ra.resolve()}().then((()=>{var e,t;t=r,Xo(e=s).forEach((n=>{t.db.objectStoreNames.contains(n)||lu(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,o,n).catch(s)}))}function uu(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],o=t[r];if(i){const e={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!fc)e.recreate=!0,n.change.push(e);else{const t=i.idxByName,r=o.idxByName;let s;for(s in t)r[s]||e.del.push(s);for(s in r){const n=t[s],i=r[s];n?n.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,o])}return n}function lu(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>hu(i,e))),i}function hu(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function du(e,t,n){const r={};return hs(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let i=t.keyPath;const o=Yc(Gc(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),s=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);i=n.keyPath;var a=Yc(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(a)}r[e]=Jc(e,o,s)})),r}function fu({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const o=r[i],s=n.objectStore(o);e._hasGetAll="getAll"in s;for(let e=0;e<s.indexNames.length;++e){const n=s.indexNames[e],r=s.index(n).keyPath,i="string"==typeof r?r:"["+hs(r).join("+")+"]";if(t[o]){const e=t[o].idxByName[i];e&&(e.name=n,delete t[o].idxByName[i],t[o].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Jo.WorkerGlobalScope&&Jo instanceof Jo.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class pu{_parseStoresSpec(e,t){Xo(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Yc(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Zo(r),0===t)})),i=r.shift();if(i.multi)throw new Vs.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new Vs.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Vs.Schema("Index must have a name and cannot be an empty string")})),t[n]=Jc(n,i,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?es(this._cfg.storesSource,e):e;const n=t._versions,r={};let i={};return n.forEach((e=>{es(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,su(t,[t._allTables,t,t.Transaction.prototype]),ou(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],Xo(i),i),t._storeNames=Xo(i),this}upgrade(e){return this._cfg.contentUpgrade=oa(this._cfg.contentUpgrade||Js,e),this}}function mu(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Nu("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function yu(e){return e&&"function"==typeof e.databases}function vu(e){return Ya((function(){return ka.letThrough=!0,e()}))}function gu(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function bu(e){var t=t=>e.next(t),n=i(t),r=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):Zo(o)?Promise.all(o).then(n,r):n(o)}}return i(t)()}function wu(e,t,n){var r=arguments.length;if(r<2)throw new Vs.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,ws(i),n]}function _u(e,t,n,r,i){return Ra.resolve().then((()=>{const o=ka.transless||ka,s=e._createTransaction(t,n,e._dbSchema,r),a={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===zs.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>_u(e,t,n,null,i)))):cc(r)}const c=Ts(i);let u;c&&Ga();const l=Ra.follow((()=>{if(u=i.call(s,s),u)if(c){var e=Ja.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=bu(u))}),a);return(u&&"function"==typeof u.then?Ra.resolve(u).then((e=>s.active?e:cc(new Vs.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>u))).then((e=>(r&&s._resolve(),s._completion.then((()=>e))))).catch((e=>(s._reject(e),cc(e))))}))}function Eu(e,t,n){const r=Zo(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const ku={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},o=[];function s(e,t,n){const r=nu(e),a=i[r]=i[r]||[],c=null==e?0:"string"==typeof e?1:e.length,u=t>0,l={...n,isVirtual:u,keyTail:t,keyLength:c,extractKey:Zc(e),unique:!u&&n.unique};return a.push(l),l.isPrimaryKey||o.push(l),c>1&&s(2===c?e[0]:e.slice(0,c-1),t+1,n),a.sort(((e,t)=>e.keyTail-t.keyTail)),l}const a=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const e of r.indexes)s(e.keyPath,0,e);function c(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,i=n.keyTail,{type:1===r.type?2:r.type,lower:Eu(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Eu(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var r,i}const u={...n,schema:{...r,primaryKey:a,indexes:o,getIndexByKeyPath:function(e){const t=i[nu(e)];return t&&t[0]}},count:e=>n.count(c(e)),query:e=>n.query(c(e)),openCursor(t){const{keyTail:r,isVirtual:i,keyLength:o}=t.query.index;return i?n.openCursor(c(t)).then((n=>n&&function(n){const i=Object.create(n,{continue:{value:function(i){null!=i?n.continue(Eu(i,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,o).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,i){n.continuePrimaryKey(Eu(t,e.MAX_KEY,r),i)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===o?e[0]:e.slice(0,o)}},value:{get:()=>n.value}});return i}(n))):n.openCursor(t)}};return u}}}};function Su(e,t,n,r){return n=n||{},r=r||"",Xo(e).forEach((i=>{if(rs(t,i)){var o=e[i],s=t[i];if("object"==typeof o&&"object"==typeof s&&o&&s){const e=Rs(o);e!==Rs(s)?n[r+i]=t[i]:"Object"===e?Su(o,s,n,r+i+"."):o!==s&&(n[r+i]=t[i])}else o!==s&&(n[r+i]=t[i])}else n[r+i]=void 0})),Xo(t).forEach((i=>{rs(e,i)||(n[r+i]=t[i])})),n}const xu={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,i={...n,mutate(e){const i=ka.trans,{deleting:o,creating:s,updating:a}=i.table(t).hook;switch(e.type){case"add":if(s.fire===Js)break;return i._promise("readwrite",(()=>c(e)),!0);case"put":if(s.fire===Js&&a.fire===Js)break;return i._promise("readwrite",(()=>c(e)),!0);case"delete":if(o.fire===Js)break;return i._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(o.fire===Js)break;return i._promise("readwrite",(()=>function(e){return u(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function c(e){const t=ka.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,i).then((c=>{const u=i.map(((n,i)=>{const u=c[i],l={onerror:null,onsuccess:null};if("delete"===e.type)o.fire.call(l,n,u,t);else if("add"===e.type||void 0===u){const o=s.fire.call(l,n,e.values[i],t);null==n&&null!=o&&(n=o,e.keys[i]=n,r.outbound||vs(e.values[i],r.keyPath,n))}else{const r=Su(u,e.values[i]),o=a.fire.call(l,r,n,u,t);if(o){const t=e.values[i];Object.keys(o).forEach((e=>{rs(t,e)?t[e]=o[e]:vs(t,e,o[e])}))}}return l}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:o})=>{for(let r=0;r<i.length;++r){const o=n?n[r]:i[r],s=u[r];null==o?s.onerror&&s.onerror(t[r]):s.onsuccess&&s.onsuccess("put"===e.type&&c[r]?e.values[r]:o)}return{failures:t,results:n,numFailures:r,lastResult:o}})).catch((e=>(u.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function u(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((({result:n})=>c({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:u(e,{...t,lower:n[n.length-1],lowerOpen:!0},i)))))}}};return i}})};function Cu(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let i=0,o=0;i<t.keys.length&&o<e.length;++i)0===Dc(t.keys[i],e[o])&&(r.push(n?Ss(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}const Ru={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=Cu(e.keys,e.trans._cache,"clone"===e.cache);return t?Ra.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?Ss(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Ou(e){return!("from"in e)}const Iu=function(e,t){if(!this){const t=new Iu;return e&&"d"in e&&es(t,e),t}es(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Pu(e,t,n){const r=Dc(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Ou(e))return es(e,{from:t,to:n,d:1});const i=e.l,o=e.r;if(Dc(n,e.from)<0)return i?Pu(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Au(e);if(Dc(t,e.to)>0)return o?Pu(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Au(e);Dc(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Dc(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const s=!e.r;i&&!e.l&&Du(e,i),o&&s&&Du(e,o)}function Du(e,t){Ou(t)||function e(t,{from:n,to:r,l:i,r:o}){Pu(t,n,r),i&&e(t,i),o&&e(t,o)}(e,t)}function Tu(e){let t=Ou(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Dc(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Dc(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Au(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const t="r"===i?"l":"r",n={...e},r=e[i];e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],e[t]=n,n.d=ju(n)}e.d=ju(e)}function ju({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}is(Iu.prototype,{add(e){return Du(this,e),this},addKey(e){return Pu(this,e,e),this},addKeys(e){return e.forEach((e=>Pu(this,e,e))),this},[Os](){return Tu(this)}});const Mu={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Iu(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:o}=i,{primaryKey:s}=o,{extractKey:a,outbound:c}=s,u={...i,mutate:e=>{const s=e.trans,a=s.mutatedParts||(s.mutatedParts={}),c=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new Iu)},u=c(""),l=c(":dels"),{type:h}=e;let[d,f]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const p=e.trans._cache;return i.mutate(e).then((e=>{if(Zo(d)){"delete"!==h&&(d=e.results),u.addKeys(d);const t=Cu(d,p);t||"add"===h||l.addKeys(d),(t||f)&&function(e,t,n,r){t.indexes.forEach((function(t){const i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}const s=e=>t.multiEntry&&Zo(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(n||r).forEach(((e,t)=>{const i=n&&o(n[t]),a=r&&o(r[t]);0!==Dc(i,a)&&(null!=i&&s(i),null!=a&&s(a))}))}))}(c,o,t,f)}else if(d){const e={from:d.lower,to:d.upper};l.add(e),u.add(e)}else u.add(n),l.add(n),o.indexes.forEach((e=>c(e.name).add(n)));return e}))}},l=({query:{index:t,range:n}})=>{var r,i;return[t,new Iu(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(i=n.upper)&&void 0!==i?i:e.MAX_KEY)]},h={get:e=>[s,new Iu(e.key)],getMany:e=>[s,(new Iu).addKeys(e.keys)],count:l,query:l,openCursor:l};return Xo(h).forEach((e=>{u[e]=function(o){const{subscr:s}=ka;if(s){const u=e=>{const n=`idb://${t}/${r}/${e}`;return s[n]||(s[n]=new Iu)},l=u(""),d=u(":dels"),[f,p]=h[e](o);if(u(f.name||"").add(p),!f.isPrimaryKey){if("count"!==e){const t="query"===e&&c&&o.values&&i.query({...o,values:!1});return i[e].apply(this,arguments).then((n=>{if("query"===e){if(c&&o.values)return t.then((({result:e})=>(l.addKeys(e),n)));const e=o.values?n.result.map(a):n.result;o.values?l.addKeys(e):d.addKeys(e)}else if("openCursor"===e){const e=n,t=o.values;return e&&Object.create(e,{key:{get:()=>(d.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return d.addKey(t),t}},value:{get:()=>(t&&l.addKey(e.primaryKey),e.value)}})}return n}))}d.add(n)}}return i[e].apply(this,arguments)}})),u}}}};class Nu{constructor(e,t){this._middlewares={},this.verno=0;const n=Nu.dependencies;this._options=t={addons:Nu.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Js,dbReadyPromise:null,cancelOpen:Js,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new Ra((e=>{i.dbReadyResolve=e})),i.openCanceller=new Ra(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=Ec(this,"populate","blocked","versionchange","close",{ready:[oa,Js]}),this.on.ready.subscribe=ds(this.on.ready.subscribe,(e=>(t,n)=>{Nu.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Ra.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=(o=this,kc(jc.prototype,(function(e,t){this.db=o;let n=gc,r=null;if(t)try{n=t()}catch(e){r=e}const i=e._ctx,s=i.table,a=s.hook.reading.fire;this._ctx={table:s,index:i.index,isPrimKey:!i.index||s.schema.primKey.keyPath&&i.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:a!==Xs?a:null}}))),this.Table=function(e){return kc(_c.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Ec(null,{creating:[ta,Js],reading:[Zs,Xs],updating:[ra,Js],deleting:[na,Js]})}))}(this),this.Transaction=function(e){return kc(Vc.prototype,(function(t,n,r,i,o){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Ec(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ra(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),cc(e)}))}))}(this),this.Version=function(e){return kc(pu.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return kc(Wc.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const i=e._deps.indexedDB;if(!i)throw new Vs.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=Xc(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),dc.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(ku),this.use(xu),this.use(Mu),this.use(Ru),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new Vs.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Vs.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(au),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||ka.letThrough||this._vip)?e():new Ra(((e,t)=>{if(this._state.openComplete)return t(new Vs.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new Vs.DatabaseClosed);this.open().catch(Js)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==n?10:n,name:r}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?cc(t.dbOpenError):e));As&&(t.openCanceller._stackHolder=Bs()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new Vs.DatabaseClosed("db.open() was cancelled")}let o=t.dbReadyResolve,s=null,a=!1;return Ra.race([r,("undefined"==typeof navigator?Ra.resolve():gu()).then((()=>new Ra(((r,o)=>{if(i(),!n)throw new Vs.MissingAPI;const c=e.name,u=t.autoSchema?n.open(c):n.open(c,Math.round(10*e.verno));if(!u)throw new Vs.MissingAPI;u.onerror=Hc(o),u.onblocked=Ka(e._fireOnBlocked),u.onupgradeneeded=Ka((r=>{if(s=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=zc,s.abort(),u.result.close();const e=n.deleteDatabase(c);e.onsuccess=e.onerror=Ka((()=>{o(new Vs.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{s.onerror=Hc(o);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=i<1,e._novip.idbdb=u.result,cu(e,i/10,s,o)}}),o),u.onsuccess=Ka((()=>{s=null;const n=e._novip.idbdb=u.result,i=hs(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(o=i).length?o[0]:o,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=du(0,t,n);e._storeNames=hs(t.objectStoreNames,0),ou(e,[e._allTables],Xo(r),r)}(e,n,r):(fu(e,e._dbSchema,r),function(e,t){const n=uu(du(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),iu(e,r)}catch(e){}var o;dc.push(e),n.onversionchange=Ka((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=Ka((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},n){!yu(e)&&"__dbnames"!==n&&mu(e,t).put({name:n}).catch(Js)}(e._deps,c),r()}),o)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Ra.resolve(vu((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(oa,Js);return t.onReadyBeingFired=[],Ra.resolve(vu((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{s&&s.abort()}catch(e){}return r===t.openCanceller&&e._close(),cc(n)})).finally((()=>{t.openComplete=!0,o()}))}(this)}_close(){const e=this._state,t=dc.indexOf(this);if(t>=0&&dc.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ra((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ra(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new Vs.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ra(((n,r)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Ka((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!yu(e)&&"__dbnames"!==n&&mu(e,t).delete(n).catch(Js)}(this._deps,this.name),n()})),e.onerror=Hc(r),e.onblocked=this._fireOnBlocked};if(e)throw new Vs.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Xo(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=wu.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=ka.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const i=-1!==e.indexOf("?");let o,s;e=e.replace("!","").replace("?","");try{if(s=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)o="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new Vs.InvalidArgument("Invalid transaction mode: "+e);o="readwrite"}if(r){if("readonly"===r.mode&&"readwrite"===o){if(!i)throw new Vs.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new Vs.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):cc(e)}const a=_u.bind(null,this,o,s,r,n);return r?r._promise(o,a,"lock"):ka.trans?rc(ka.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!rs(this._allTables,e))throw new Vs.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Bu="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Lu{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[Bu](){return this}}function Fu(e,t){return Xo(t).forEach((n=>{Du(e[n]||(e[n]=new Iu),t[n])})),e}let $u;try{$u={indexedDB:Jo.indexedDB||Jo.mozIndexedDB||Jo.webkitIndexedDB||Jo.msIndexedDB,IDBKeyRange:Jo.IDBKeyRange||Jo.webkitIDBKeyRange}}catch(Jo){$u={indexedDB:null,IDBKeyRange:null}}const qu=Nu;function Ku(e){let t=Uu;try{Uu=!0,Qc.storagemutated.fire(e)}finally{Uu=t}}is(qu,{...Gs,delete:e=>new qu(e,{addons:[]}).delete(),exists:e=>new qu(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return yu(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):mu(e,t).toCollection().primaryKeys()}(qu.dependencies).then(e)}catch(e){return cc(new Vs.MissingAPI)}},defineClass:()=>function(e){es(this,e)},ignoreTransaction:e=>ka.trans?rc(ka.transless,e):e(),vip:vu,async:function(e){return function(){try{var t=bu(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ra.resolve(t)}catch(e){return cc(e)}}},spawn:function(e,t,n){try{var r=bu(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ra.resolve(r)}catch(e){return cc(e)}},currentTransaction:{get:()=>ka.trans||null},waitFor:function(e,t){const n=Ra.resolve("function"==typeof e?qu.ignoreTransaction(e):e).timeout(t||6e4);return ka.trans?ka.trans.waitFor(n):n},Promise:Ra,debug:{get:()=>As,set:e=>{js(e,"dexie"===e?()=>!0:yc)}},derive:as,extend:es,props:is,override:ds,Events:Ec,on:Qc,liveQuery:function(e){return new Lu((t=>{const n=Ts(e);let r=!1,i={},o={};const s={get closed(){return r},unsubscribe:()=>{r=!0,Qc.storagemutated.unsubscribe(l)}};t.start&&t.start(s);let a=!1,c=!1;function u(){return Xo(o).some((e=>i[e]&&function(e,t){const n=Tu(t);let r=n.next();if(r.done)return!1;let i=r.value;const o=Tu(e);let s=o.next(i.from),a=s.value;for(;!r.done&&!s.done;){if(Dc(a.from,i.to)<=0&&Dc(a.to,i.from)>=0)return!0;Dc(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}(i[e],o[e])))}const l=e=>{Fu(i,e),u()&&h()},h=()=>{if(a||r)return;i={};const d={},f=function(t){n&&Ga();const r=()=>Ya(e,{subscr:t,trans:null}),i=ka.trans?rc(ka.transless,r):r();return n&&i.then(Ja,Ja),i}(d);c||(Qc("storagemutated",l),c=!0),a=!0,Promise.resolve(f).then((e=>{a=!1,r||(u()?h():(i={},o=d,t.next&&t.next(e)))}),(e=>{["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||(a=!1,t.error&&t.error(e),s.unsubscribe())}))};return h(),s}))},extendObservabilitySet:Fu,getByKeyPath:ys,setByKeyPath:vs,delByKeyPath:function(e,t){"string"==typeof t?vs(e,t,void 0):"length"in t&&[].map.call(t,(function(t){vs(e,t,void 0)}))},shallowClone:gs,deepClone:Ss,getObjectDiff:Su,cmp:Dc,asap:ps,minKey:-1/0,addons:[],connections:dc,errnames:zs,dependencies:$u,semVer:"4.0.0-alpha.4",version:"4.0.0-alpha.4".split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),qu.maxKey=Xc(qu.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Qc("storagemutated",(e=>{if(!Uu){let t;fc?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Uu=!0,dispatchEvent(t),Uu=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Uu||Ku(e)})));let Uu=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),Qc("storagemutated",(t=>{Uu||e.postMessage(t)})),e.onmessage=e=>{e.data&&Ku(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Qc("storagemutated",(e=>{try{Uu||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Ku(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Ku(e.changedParts)}))}Ra.rejectionMapper=function(e,t){if(!e||e instanceof Ks||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ys[e.name])return e;var n=new Ys[e.name](t||e.message,e);return"stack"in e&&ss(n,"stack",{get:function(){return this.inner.stack}}),n},js(As,yc);var Wu="docs",Hu="deleted-docs",zu="dexie",Qu={prepareQuery(e,t){if(!t.sort)throw V("SNH",{query:t});return{query:t,queryPlan:$n(e,t)}},checkpointSchema:{type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1}},Vu=new Map,Yu=new Map,Gu="__";function Ju(e){var t=e.split(".");if(t.length>1)return t.map((e=>Ju(e))).join(".");if(e.startsWith("|")){var n=e.substring(1);return Gu+n}return e}function Xu(e){var t=e.split(".");return t.length>1?t.map((e=>Xu(e))).join("."):e.startsWith(Gu)?"|"+e.substring(Gu.length):e}function Zu(e){if(!e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map((e=>Zu(e)));if("object"==typeof e){var t={};return Object.entries(e).forEach((([e,n])=>{"object"==typeof n&&(n=Zu(n)),t[Ju(e)]=n})),t}}function el(e){if(!e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map((e=>el(e)));if("object"==typeof e){var t={};return Object.entries(e).forEach((([n,r])=>{("object"==typeof r||Array.isArray(e))&&(r=el(r)),t[Xu(n)]=r})),t}}async function tl(e,t){var n=await e,[r,i]=await Promise.all([n.dexieTable.bulkGet(t),n.dexieDeletedTable.bulkGet(t)]),o=i.slice(0);return r.forEach(((e,t)=>{e&&(o[t]=e)})),o}function nl(e){return e===Fn?-1/0:e}function rl(e,t){if(!t){if("undefined"==typeof window)throw new Error("IDBKeyRange missing");t=window.IDBKeyRange}var n,r=e.startKeys.map(nl),i=e.endKeys.map(nl);if(1===e.index.length){var o=r[0]===i[0];n=t.bound(r[0],i[0],!o&&!e.inclusiveStart,!o&&!e.inclusiveEnd)}else n=t.bound(r,i,!e.inclusiveStart,!e.inclusiveEnd);return n}async function il(e,t){var n=await e.internals,r=t.query,i=r.skip?r.skip:0,o=i+(r.limit?r.limit:1/0),s=t.queryPlan,a=!1;s.selectorSatisfiedByIndex||(a=mo(e.schema,t.query));var c=rl(s,n.dexieDb._options.IDBKeyRange),u=s.index,l=[];if(await n.dexieDb.transaction("r",n.dexieTable,(async t=>{var n,r,i=t.idbtrans.objectStore(Wu);1===u.length&&u[0]===e.primaryPath?n=i:(r=1===u.length?Ju(u[0]):"["+u.map((e=>Ju(e))).join("+")+"]",n=i.index(r));var h=n.openCursor(c);await new Promise((e=>{h.onsuccess=function(t){var n=t.target.result;if(n){var r=el(n.value);r._deleted||a&&!a(r)||l.push(r),s.sortFieldsSameAsIndexFields&&l.length===o?e():n.continue()}else e()}}))})),!s.sortFieldsSameAsIndexFields){var h=po(e.schema,t.query);l=l.sort(h)}return{documents:l=l.slice(i,o)}}var ol=Array.isArray;function sl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rn(e),r=on(e,1/0);return e=function(e){return 1===e.length&&ol(e[0])?e[0]:e}(e),ot((function(t,i){en(r)(un(Ce([t],xe(e)),n)).subscribe(i)}))}Promise.resolve(!1);var al=Promise.resolve(!0),cl=Promise.resolve();function ul(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}function ll(){return Math.random().toString(36).substring(2)}var hl=0;function dl(){var e=1e3*Date.now();return e<=hl&&(e=hl+1),hl=e,e}var fl={create:function(e){var t={time:dl(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),cl}catch(e){return Promise.reject(e)}},canBeUsed:function(){if("undefined"!=typeof globalThis&&globalThis.Deno&&globalThis.Deno.args)return!0;if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:dl};function pl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var ml="messages",yl={durability:"relaxed"};function vl(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function gl(e){e.commit&&e.commit()}function bl(e){e.closed||wl(e).then((function(){return ul(e.options.idb.fallbackInterval)})).then((function(){return bl(e)}))}function wl(e){return e.closed?cl:e.messagesCallback?function(e,t){var n=e.transaction(ml,"readonly",yl),r=n.objectStore(ml),i=[],o=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var s=r.getAll(o);return new Promise((function(e,t){s.onerror=function(e){return t(e)},s.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,s){var a=function(){try{return o=IDBKeyRange.bound(t+1,1/0),r.openCursor(o)}catch(e){return r.openCursor()}}();a.onerror=function(e){return s(e)},a.onsuccess=function(r){var o=r.target.result;o?o.value.id<t+1?o.continue(t+1):(i.push(o.value),o.continue()):(gl(n),e(i))}}))}(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),cl})):cl}var _l={create:function(e,t){return t=pl(t),function(e){var t="pubkey.broadcast-channel-0-"+e,n=vl().open(t);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(ml,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}(e).then((function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:ll(),eMIs:new Ho(2*t.idb.ttl),writeBlockPromise:cl,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},bl(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,wl(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var r={uuid:t,time:Date.now(),data:n},i=e.transaction([ml],"readwrite",yl);return new Promise((function(e,t){i.oncomplete=function(){return e()},i.onerror=function(e){return t(e)},i.objectStore(ml).add(r),gl(i)}))}(e.db,e.uuid,t)})).then((function(){0===(0,10,Math.floor(11*Math.random()+0))&&function(e){return(t=e.db,n=e.options.idb.ttl,r=Date.now()-n,i=t.transaction(ml,"readonly",yl),o=i.objectStore(ml),s=[],new Promise((function(e){o.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var o=n.value;o.time<r?(s.push(o),n.continue()):(gl(i),e(s))}else e(s)}}))).then((function(t){return function(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(ml,"readwrite",yl).objectStore(ml);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}));var t,n,r,i,o,s}(e)})),e.writeBlockPromise},canBeUsed:function(){return!!vl()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:dl};function El(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function kl(e){return"pubkey.broadcastChannel-"+e}function Sl(){var e=El();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var xl={create:function(e,t){if(t=pl(t),!Sl())throw new Error("BroadcastChannel: localstorage cannot be used");var n=ll(),r=new Ho(t.localstorage.removeTimeout),i={channelName:e,uuid:n,eMIs:r};return i.listener=function(e,t){var o=kl(e),s=function(e){var t;e.key===o&&(t=JSON.parse(e.newValue),i.messagesCallback&&t.uuid!==n&&t.token&&!r.has(t.token)&&(t.data.time&&t.data.time<i.messagesCallbackTime||(r.add(t.token),i.messagesCallback(t.data))))};return window.addEventListener("storage",s),s}(e),i},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){ul().then((function(){var r=kl(e.channelName),i={token:ll(),time:Date.now(),data:t,uuid:e.uuid},o=JSON.stringify(i);El().setItem(r,o);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=o,window.dispatchEvent(s),n()}))}))},canBeUsed:Sl,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:dl},Cl=dl,Rl=new Set,Ol={create:function(e){var t={time:Cl(),name:e,messagesCallback:null};return Rl.add(t),t},close:function(e){Rl.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(Rl).forEach((function(n){n.name===e.name&&n!==e&&n.messagesCallback&&n.time<t.time&&n.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:Cl},Il=[fl,_l,xl],Pl=new Set,Dl=0,Tl=function(e,t){var n,r,i;this.id=Dl++,Pl.add(this),this.name=e,this.options=pl(t),this.method=function(e){var t=[].concat(e.methods,Il).filter(Boolean);if(e.type){if("simulate"===e.type)return Ol;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var r=t.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(Il.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(i=r=(n=this).method.create(n.name,n.options))&&"function"==typeof i.then?(n._prepP=r,r.then((function(e){n._state=e}))):n._state=r};function Al(e,t,n){var r={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:cl).then((function(){var t=e.method.postMessage(e._state,r);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function jl(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function Ml(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&jl(e)){var t=function(t){e._addEL[t.type].forEach((function(e){t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function Nl(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!jl(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}Tl._pubkey=!0,Tl.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return Al(this,"message",e)},postInternal:function(e){return Al(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};Nl(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,Ml(this,"message",t)):this._onML=null},addEventListener:function(e,t){Ml(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){Nl(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){Pl.delete(this),this.closed=!0;var t=this._prepP?this._prepP:cl;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Bl=new Map;function Ll(e,t,n,r){var i=Bl.get(t);return i||(i={bc:new Tl(["RxDB:",e,n].join("|")),refs:new Set},Bl.set(t,i)),i.refs.add(r),i.bc}function Fl(e,t){var n=Bl.get(e);if(n)return n.refs.delete(t),0===n.refs.size?(Bl.delete(e),n.bc.close()):void 0}function $l(e,t,n,r){if(t.multiInstance){var i=r||Ll(e,t.databaseInstanceToken,n.databaseName,n),o=new rt,s=n=>{n.storageName===e&&n.databaseName===t.databaseName&&n.collectionName===t.collectionName&&n.version===t.schema.version&&o.next(n.eventBulk)};i.addEventListener("message",s);var a=n.changeStream(),c=!1,u=a.subscribe((n=>{c||i.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:n})}));n.changeStream=function(){return o.asObservable().pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return sl.apply(void 0,Ce([],xe(e)))}(a))};var l=n.close.bind(n);n.close=async function(){return c=!0,u.unsubscribe(),i.removeEventListener("message",s),r||await Fl(t.databaseInstanceToken,n),l()};var h=n.remove.bind(n);n.remove=async function(){return c=!0,u.unsubscribe(),i.removeEventListener("message",s),r||await Fl(t.databaseInstanceToken,n),h()}}}var ql=Ct(),Kl=function(){function t(e,t,n,r,i,o,s){this.changes$=new rt,this.instanceId=ql++,this.storage=e,this.databaseName=t,this.collectionName=n,this.schema=r,this.internals=i,this.options=o,this.settings=s,this.primaryPath=me(this.schema.primaryKey)}var n=t.prototype;return n.bulkWrite=async function(t,n){Ul(this),t.forEach((e=>{if(!e.document._rev||e.previous&&!e.previous._rev)throw V("SNH",{args:{row:e}})}));var r,o=await this.internals,s={success:[],error:[]},a=t.map((e=>e.document[this.primaryPath]));if(await o.dexieDb.transaction("rw",o.dexieTable,o.dexieDeletedTable,(async()=>{var c=new Map;(await tl(this.internals,a)).forEach((e=>{var t=e?el(e):e;return t&&c.set(t[this.primaryPath],t),t})),r=function(t,n,r,o,s,a,c){for(var u,l=!!t.schema.attachments,h=[],d=[],f=[],p={id:i(10),events:[],checkpoint:null,context:s,startTime:Ct(),endTime:0},m=p.events,y=[],v=[],g=[],b=r.size>0,w=o.length,_=function(){var t,i=o[E],s=i.document,a=i.previous,c=s[n],p=s._deleted,w=a&&a._deleted,_=void 0;if(b&&(_=r.get(c)),_){var k=_._rev;if(!a||a&&k!==a._rev){var S={isError:!0,status:409,documentId:c,writeRow:i,documentInDb:_};return f.push(S),1}var x=l?Mt(i):i;l&&(p?a&&Object.keys(a._attachments).forEach((t=>{v.push({documentId:c,attachmentId:t,digest:e(a)._attachments[t].digest})})):(Object.entries(s._attachments).find((([e,n])=>((a?a._attachments[e]:void 0)||n.data||(t={documentId:c,documentInDb:_,isError:!0,status:510,writeRow:i,attachmentId:e}),!0))),t||Object.entries(s._attachments).forEach((([e,t])=>{var n=a?a._attachments[e]:void 0;if(n){var r=x.document._attachments[e].digest;t.data&&n.digest!==r&&g.push({documentId:c,attachmentId:e,attachmentData:t,digest:t.digest})}else y.push({documentId:c,attachmentId:e,attachmentData:t,digest:t.digest})})))),t?f.push(t):(l?d.push(Mt(x)):d.push(x),u=x);var C=null,R=null,O=null;if(w&&!p)O="INSERT",C=l?Nt(s):s;else if(!a||w||p){if(!p)throw V("SNH",{args:{writeRow:i}});O="DELETE",C=e(s),R=a}else O="UPDATE",C=l?Nt(s):s,R=a;var I={documentId:c,documentData:C,previousDocumentData:R,operation:O};m.push(I)}else{var P=!!p;if(l&&Object.entries(s._attachments).forEach((([e,n])=>{n.data?y.push({documentId:c,attachmentId:e,attachmentData:n,digest:n.digest}):(t={documentId:c,isError:!0,status:510,writeRow:i,attachmentId:e},f.push(t))})),t||(l?h.push(Mt(i)):h.push(i),u=i),!P){var D={documentId:c,operation:"INSERT",documentData:l?Nt(s):s,previousDocumentData:l&&a?Nt(a):a};m.push(D)}}},E=0;E<w;E++)_();return{bulkInsertDocs:h,bulkUpdateDocs:d,newestRow:u,errors:f,eventBulk:p,attachmentsAdd:y,attachmentsRemove:v,attachmentsUpdate:g}}(this,this.primaryPath,c,t,n),s.error=r.errors;var u=[],l=[],h=[],d=[];r.bulkInsertDocs.forEach((e=>{s.success.push(e.document),u.push(e.document)})),r.bulkUpdateDocs.forEach((e=>{var t=e.document[this.primaryPath];if(s.success.push(e.document),e.document._deleted&&e.previous&&!e.previous._deleted)l.push(t),h.push(e.document);else if(e.document._deleted&&e.previous&&e.previous._deleted)h.push(e.document);else{if(e.document._deleted)throw V("SNH",{args:{row:e}});u.push(e.document)}})),await Promise.all([u.length>0?o.dexieTable.bulkPut(u.map((e=>Zu(e)))):O,l.length>0?o.dexieTable.bulkDelete(l):O,h.length>0?o.dexieDeletedTable.bulkPut(h.map((e=>Zu(e)))):O,d.length>0?o.dexieDeletedTable.bulkDelete(d):O])})),(r=e(r)).eventBulk.events.length>0){var c=e(r.newestRow).document;r.eventBulk.checkpoint={id:c[this.primaryPath],lwt:c._meta.lwt},r.eventBulk.endTime=Ct(),this.changes$.next(r.eventBulk)}return s},n.findDocumentsById=async function(e,t){Ul(this);var n=await this.internals,r=[];return await n.dexieDb.transaction("r",n.dexieTable,n.dexieDeletedTable,(async()=>{var i;i=t?await tl(this.internals,e):await n.dexieTable.bulkGet(e),e.forEach(((e,n)=>{var o=i[n];!o||o._deleted&&!t||r.push(el(o))}))})),r},n.query=function(e){return Ul(this),il(this,e)},n.count=async function(e){if(e.queryPlan.selectorSatisfiedByIndex){var t=await async function(e,t){var n=await e.internals,r=t.queryPlan,i=r.index,o=rl(r,n.dexieDb._options.IDBKeyRange),s=-1;return await n.dexieDb.transaction("r",n.dexieTable,(async t=>{var n,r,a=t.idbtrans.objectStore(Wu);1===i.length&&i[0]===e.primaryPath?n=a:(r=1===i.length?Ju(i[0]):"["+i.map((e=>Ju(e))).join("+")+"]",n=a.index(r));var c=n.count(o);s=await new Promise(((e,t)=>{c.onsuccess=function(){e(c.result)},c.onerror=e=>t(e)}))})),s}(this,e);return{count:t,mode:"fast"}}return{count:(await il(this,e)).documents.length,mode:"slow"}},n.info=async function(){var e=await this.internals,t={totalCount:-1};return await e.dexieDb.transaction("r",e.dexieTable,e.dexieDeletedTable,(async n=>{var[r,i]=await Promise.all([e.dexieTable.count(),e.dexieDeletedTable.count()]);t.totalCount=r+i})),t},n.getChangedDocumentsSince=async function(e,t){Ul(this);var n,r=t?t.lwt:D,i=t?t.id:"",o=await this.internals,[s,a]=await Promise.all([o.dexieTable,o.dexieDeletedTable].map((async t=>{var n=t.where("[_meta.lwt+"+this.primaryPath+"]").above([r,i]).limit(e);return(await n.toArray()).map((e=>el(e)))}))),c=s.slice(0);re(c,a),n=this.primaryPath,c=c.sort(function(e){return(t,n)=>t._meta.lwt===n._meta.lwt?n[e]<t[e]?1:-1:t._meta.lwt-n._meta.lwt}(n));var u,l=(u=c=c.slice(0,e))[u.length-1];return{documents:c,checkpoint:l?{id:l[this.primaryPath],lwt:l._meta.lwt}:t||{id:"",lwt:0}}},n.changeStream=function(){return Ul(this),this.changes$.asObservable()},n.cleanup=async function(e){Ul(this);var t=await this.internals;return await t.dexieDb.transaction("rw",t.dexieDeletedTable,(async()=>{var n=Ct()-e,r=(await t.dexieDeletedTable.where("_meta.lwt").below(n).toArray()).map((e=>e[this.primaryPath]));await t.dexieDeletedTable.bulkDelete(r)})),!0},n.getAttachmentData=function(e,t,n){throw Ul(this),new Error("Attachments are not implemented in the dexie RxStorage. Make a pull request.")},n.remove=async function(){Ul(this);var e=await this.internals;return await Promise.all([e.dexieDeletedTable.clear(),e.dexieTable.clear()]),this.close()},n.close=function(){return this.closed||(this.closed=(async()=>{this.changes$.complete(),await async function(e){var t=await e,n=Yu.get(e)-1;0===n?(t.dexieDb.close(),Yu.delete(e)):Yu.set(e,n)}(this.internals)})()),this.closed},n.conflictResultionTasks=function(){return new rt},n.resolveConflictResultionTask=async function(e){},t}();function Ul(e){if(e.closed)throw new Error("RxStorageInstanceDexie is closed "+e.databaseName+"-"+e.collectionName)}var Wl=function(){function e(e){this.name=zu,this.statics=Qu,this.settings=e}return e.prototype.createStorageInstance=function(e){return function(e){if(e.schema.keyCompression)throw V("UT5",{args:{params:e}});if(Ft(e.schema))throw V("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw V("UT7",{args:{params:e}})}(e),function(e){if(e.indexes){var t=new Set;e.indexes.forEach((n=>{Z(n).forEach((r=>{if(!t.has(r)&&(t.add(r),"boolean"===fe(e,r).type))throw V("DXE1",{schema:e,index:n,field:r})}))}))}}(e.schema),async function(e,t,n){var r=function(e,t,n,r){var i=me(r.primaryKey),o="rxdb-dexie-"+e+"--"+r.version+"--"+t,s=St(Vu,o,(()=>{var e=(async()=>{var e=A(n);e.autoOpen=!1;var t,s,a,c=new Nu(o,e),u={[Wu]:(t=r,s=[],a=me(t.primaryKey),s.push([a]),t.indexes&&t.indexes.forEach((e=>{var t=Z(e);s.push(t)})),s.push(["_meta.lwt",a]),(s=s.map((e=>e.map((e=>Ju(e)))))).map((e=>1===e.length?e[0]:"["+e.join("+")+"]")).join(", ")),changes:"++sequence, id",[Hu]:i+",_meta.lwt,[_meta.lwt+"+i+"]"};return c.version(1).stores(u),await c.open(),{dexieDb:c,dexieTable:c[Wu],dexieDeletedTable:c[Hu]}})();return Vu.set(o,s),Yu.set(s,0),e}));return s}(t.databaseName,t.collectionName,n,t.schema),i=new Kl(e,t.databaseName,t.collectionName,t.schema,r,t.options,n);return await $l(zu,t,i),Promise.resolve(i)}(this,e,this.settings)},e}(),Hl={RxSchema:we.prototype,RxDocument:No,RxQuery:Io.prototype,RxCollection:Wo.prototype,RxDatabase:Vo.prototype},zl=new Set,Ql=new Set;function Vl(e){if(oe("preAddRxPlugin",{plugin:e,plugins:zl}),!zl.has(e)){if(Ql.has(e.name))throw V("PL3",{name:e.name,plugin:e});if(zl.add(e),Ql.add(e.name),!e.rxdb)throw Y("PL1",{plugin:e});e.init&&e.init(),e.prototypes&&Object.entries(e.prototypes).forEach((([e,t])=>t(Hl[e]))),e.overwritable&&Object.assign(W,e.overwritable),e.hooks&&Object.entries(e.hooks).forEach((([e,t])=>{t.after&&ie[e].push(t.after),t.before&&ie[e].unshift(t.before)}))}}var Yl=Array.isArray,Gl=Object.getPrototypeOf,Jl=Object.prototype,Xl=Object.keys;var Zl=Array.isArray;function eh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rn(e),r=function(e){return Oe(nn(e))?e.pop():void 0}(e),i=function(e){if(1===e.length){var t=e[0];if(Yl(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&Gl(r)===Jl){var n=Xl(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}(e),o=i.args,s=i.keys;if(0===o.length)return un([],n);var a=new et(function(e,t,n){return void 0===n&&(n=Ze),function(r){th(t,(function(){for(var i=e.length,o=new Array(i),s=i,a=i,c=function(i){th(t,(function(){var c=un(e[i],t),u=!1;c.subscribe(st(r,(function(e){o[i]=e,u||(u=!0,a--),a||r.next(n(o.slice()))}),(function(){--s||r.complete()})))}),r)},u=0;u<i;u++)c(u)}),r)}}(o,n,s?function(e){return function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}(s,e)}:Ze));return r?a.pipe(function(e){return ct((function(t){return function(e,t){return Zl(t)?e.apply(void 0,Ce([],xe(t))):e(t)}(e,t)}))}(r)):a}function th(e,t,n){e?wt(n,e,t):t()}async function nh(e,t){var n=ye(e.input.metaInstance.schema,{isCheckpoint:"1",itemId:t}),r=(await e.input.metaInstance.findDocumentsById([n],!1))[0];return e.lastCheckpointDoc[t]=r,r?r.checkpointData:void 0}async function rh(t,n,r){t.checkpointQueue=t.checkpointQueue.then((async()=>{var i=t.lastCheckpointDoc[n];if(r&&!t.events.canceled.getValue()&&(!i||JSON.stringify(i.checkpointData)!==JSON.stringify(r))){var o={id:"",isCheckpoint:"1",itemId:n,_deleted:!1,_attachments:{},checkpointData:r,_meta:T(),_rev:""};for(o.id=ye(t.input.metaInstance.schema,o);!t.events.canceled.getValue();){if(i&&(o.checkpointData=At([i.checkpointData,o.checkpointData])),o._meta.lwt=Ct(),o._rev=It(await t.checkpointKey,i),t.events.canceled.getValue())return;var s=await t.input.metaInstance.bulkWrite([{previous:i,document:o}],"replication-set-checkpoint"),a=s.success[0];if(a)return void(t.lastCheckpointDoc[n]=a);var c=s.error[0];if(409!==c.status)throw c;i=e(c.documentInDb),o._rev=It(await t.checkpointKey,i)}}})),await t.checkpointQueue}function ih(e,t,n,r,i){var o=Object.assign({},r,{_attachments:t&&r._attachments?r._attachments:{},_meta:n?r._meta:{lwt:Ct()},_rev:n?r._rev:""});return o._rev||(o._rev=It(e,i)),o}function oh(e,t,n){var r=A(e);return t||delete r._attachments,n||(delete r._meta,delete r._rev),r}function sh(e,t){return e.hasAttachments?t.map((e=>{var t=M(e.document);return t.docData=Nt(t.docData),{document:t,previous:e.previous}})):t}function ah(e){for(;;){if(!e.underlyingPersistentStorage)return e;e=e.underlyingPersistentStorage}}function ch(e,t){return e.input.metaInstance.findDocumentsById(t.map((t=>ye(e.input.metaInstance.schema,{itemId:t,isCheckpoint:"0"}))),!0).then((e=>{var t={};return Object.values(e).forEach((e=>{t[e.itemId]={docData:e.docData,metaDocument:e}})),t}))}async function uh(e,t,n,r){var i=t[e.primaryPath],o=n?Bt(n):{id:"",isCheckpoint:"0",itemId:i,docData:t,_attachments:{},_deleted:!1,_rev:"",_meta:{lwt:0}};return o.docData=t,o.isResolvedConflict=r,o._meta.lwt=Ct(),o.id=ye(e.input.metaInstance.schema,o),o._rev=It(await e.checkpointKey,n),{previous:n,document:o}}async function lh(t,n,r,i){if(!r._attachments||i&&!i._attachments)throw new Error("_attachments missing");var o=r[t],s=new Set(i&&i._attachments?Object.keys(i._attachments):[]);return await Promise.all(Object.entries(r._attachments).map((async([t,r])=>{if((!s.has(t)||i&&e(i._attachments)[t].digest!==r.digest)&&!r.data){var a=await n.getAttachmentData(o,t,r.digest);r.data=a}}))),r}async function hh(t){t.input.initialCheckpoint&&t.input.initialCheckpoint.upstream&&(await nh(t,"up")||await rh(t,"up",t.input.initialCheckpoint.upstream));var n=t.input.replicationHandler;t.streamQueue.up=t.streamQueue.up.then((()=>u().then((()=>{l()}))));var r=0,i=-1,o=[],s=C,a={docs:{}},c=t.input.forkInstance.changeStream().subscribe((async e=>{if(e.context!==await t.downstreamBulkWriteFlag)return t.stats.up.forkChangeStreamEmit=t.stats.up.forkChangeStreamEmit+1,o.push({task:e,time:r++}),t.input.waitBeforePersist?t.input.waitBeforePersist().then((()=>l())):l()}));async function u(){if(t.stats.up.upstreamInitialSync=t.stats.up.upstreamInitialSync+1,!t.events.canceled.getValue()){t.checkpointQueue=t.checkpointQueue.then((()=>nh(t,"up")));for(var n=await t.checkpointQueue,o=new Set,s=async function(){i=r++,o.size>3&&await Promise.race(Array.from(o));var s=await t.input.forkInstance.getChangedDocumentsSince(t.input.pushBatchSize,n);if(0===s.documents.length)return 1;n=At([n,s.checkpoint]);var a=h(s.documents,e(n));o.add(a),a.catch().then((()=>o.delete(a)))};!t.events.canceled.getValue()&&!await s(););var a=(await Promise.all(o)).find((e=>!!e));a?await u():t.firstSyncDone.up.getValue()||t.events.canceled.getValue()||t.firstSyncDone.up.next(!0)}}function l(){t.events.canceled.getValue()||0===o.length?t.events.active.up.next(!1):(t.stats.up.processTasks=t.stats.up.processTasks+1,t.events.active.up.next(!0),t.streamQueue.up=t.streamQueue.up.then((()=>{for(var n=[],r={};o.length>0;){var s=e(o.shift());s.time<i||(re(n,s.task.events.map((e=>e.documentData))),r=At([r,s.task.checkpoint]))}return(0===n.length?C:h(n,r)).then((()=>{0===o.length?t.events.active.up.next(!1):l()}))})))}function h(r,i){return t.stats.up.persistToMaster=t.stats.up.persistToMaster+1,r.forEach((e=>{var n=e[t.primaryPath];a.docs[n]=e})),a.checkpoint=i,s=s.then((async()=>{if(t.events.canceled.getValue())return!1;var r=a.docs;a.docs={};var i=a.checkpoint,o=Object.keys(r);if(0===o.length)return!1;var s=await ch(t,o),c={},u=[],l={},h={};if(await Promise.all(o.map((async e=>{var n=r[e];h[e]=n;var i=oh(n,t.hasAttachments,!!t.input.keepMeta),o=s[e];o&&o.metaDocument.isResolvedConflict!==n._rev&&(await t.input.conflictHandler({realMasterState:o.docData,newDocumentState:i},"upstream-check-if-equal")).isEqual||o&&o.docData._rev&&Rt(n._rev).height===n._meta[t.input.identifier]||(u.push(e),c[e]={assumedMasterState:o?o.docData:void 0,newDocumentState:i},l[e]=await uh(t,i,o?o.metaDocument:void 0))}))),0===u.length)return!1;var d=Object.values(c),f=new Set,p={},m=function(e,t){e=e.slice(0);for(var n=[];e.length;){var r=e.splice(0,t);n.push(r)}return n}(d,t.input.pushBatchSize);await Promise.all(m.map((async e=>{t.hasAttachments&&await Promise.all(e.map((async e=>{e.newDocumentState=await lh(t.primaryPath,t.input.forkInstance,M(e.newDocumentState),e.assumedMasterState)}))),(await n.masterWrite(e)).forEach((e=>{var n=e[t.primaryPath];f.add(n),p[n]=e}))})));var y=[];if(u.forEach((e=>{f.has(e)||(t.events.processed.up.next(c[e]),y.push(l[e]))})),t.events.canceled.getValue())return!1;y.length>0&&await t.input.metaInstance.bulkWrite(sh(t,y),"replication-up-write-meta");var v=!1;if(f.size>0){t.stats.up.persistToMasterHadConflicts=t.stats.up.persistToMasterHadConflicts+1;var g=[],b={};if(await Promise.all(Object.entries(p).map((([n,r])=>{var i=c[n],o={newDocumentState:i.newDocumentState,assumedMasterState:i.assumedMasterState,realMasterState:r};return async function(e,t,n){var r=e.input.conflictHandler,i=await r(t,"replication-resolve-conflict");if(!i.isEqual){var o=Object.assign({},i.documentData,{_meta:A(n._meta),_rev:"",_attachments:A(n._attachments)});return o._meta.lwt=Ct(),o._rev=It(await e.checkpointKey,n),{resolvedDoc:o,output:i}}}(t,o,h[n]).then((async i=>{if(i){t.events.resolvedConflicts.next({input:o,output:i.output}),g.push({previous:h[n],document:i.resolvedDoc});var a=s[n];b[n]=await uh(t,e(r),a?a.metaDocument:void 0,i.resolvedDoc._rev)}}))}))),g.length>0){v=!0,t.stats.up.persistToMasterConflictWrites=t.stats.up.persistToMasterConflictWrites+1;var w=await t.input.forkInstance.bulkWrite(g,"replication-up-write-conflict"),_=[];w.success.forEach((e=>{var n=e[t.primaryPath];_.push(b[n])})),_.length>0&&await t.input.metaInstance.bulkWrite(sh(t,_),"replication-up-write-conflict-meta")}}return rh(t,"up",i),v})).catch((e=>(t.events.error.next(e),!1)))}Zt(t.events.canceled.pipe(Et((e=>!!e)))).then((()=>c.unsubscribe()))}function dh(e){return Zt(eh([e.firstSyncDone.down.pipe(Et((e=>!!e))),e.firstSyncDone.up.pipe(Et((e=>!!e)))])).then((()=>{}))}function fh(e){return Promise.all([e.streamQueue.up,e.streamQueue.down,e.checkpointQueue])}var ph=n(155),mh=n(155),yh="[object process]"===Object.prototype.toString.call(void 0!==mh?mh:0)?function(e){ph.on("exit",(function(){return e()})),ph.on("beforeExit",(function(){return e().then((function(){return ph.exit()}))})),ph.on("SIGINT",(function(){return e().then((function(){return ph.exit()}))})),ph.on("uncaughtException",(function(t){return e().then((function(){console.trace(t),ph.exit(101)}))}))}:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}},vh=new Set,gh=!1;function bh(){var e=[];return vh.forEach((function(t){e.push(t()),vh.delete(t)})),Promise.all(e)}function wh(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}function _h(e){e.isLeader=!0,e._hasLeader=!0;var t=function(e){if(gh||(gh=!0,yh(bh)),"function"!=typeof e)throw new Error("Listener is no function");return vh.add(e),{remove:function(){return vh.delete(e)},run:function(){return vh.delete(e),e()}}}((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&wh(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),wh(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),wh(e,"tell")}var Eh=function(e,t){var n=this;this.broadcastChannel=e,e._befC.push((function(){return n.die()})),this._options=t,this.isLeader=!1,this.isDead=!1,this.token=ll(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+e.method.type+"||"+e.name};Eh.prototype={hasLeader:function(){var e=this;return navigator.locks.query().then((function(t){var n=t.held?t.held.filter((function(t){return t.name===e.lN})):[];return!!(n&&n.length>0)}))},awaitLeadership:function(){var e=this;if(!this._wLMP){this._wKMC.c=new AbortController;var t=new Promise((function(t,n){e._wKMC.res=t,e._wKMC.rej=n}));this._wLMP=new Promise((function(n){navigator.locks.request(e.lN,{signal:e._wKMC.c.signal},(function(){return e._wKMC.c=void 0,_h(e),n(),t})).catch((function(){}))}))}return this._wLMP},set onduplicate(e){},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),wh(this,"death")}};var kh=function(e,t){var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=ll(),this._aplQ=cl,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var r=function(e){"leader"===e.context&&("death"===e.action&&(n._hasLeader=!1),"tell"===e.action&&(n._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};kh.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(e){var t=this;return this.isLeader?ul(0,!0):this.isDead?ul(0,!1):this._aplQC>1?this._aplQ:(this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(t.isLeader)return al;var n,r=!1,i=new Promise((function(e){n=function(){r=!0,e()}})),o=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&n(),"tell"===e.action&&(n(),t._hasLeader=!0))};t.broadcastChannel.addEventListener("internal",o);var s=e?4*t._options.responseTime:t._options.responseTime;return wh(t,"apply").then((function(){return Promise.race([ul(s),i.then((function(){return Promise.reject(new Error)}))])})).then((function(){return wh(t,"apply")})).then((function(){return Promise.race([ul(s),i.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return t.broadcastChannel.removeEventListener("internal",o),!r&&_h(t).then((function(){return!0}))}))}()})).then((function(){t._aplQC=t._aplQC-1})),this._aplQ.then((function(){return t.isLeader})))},awaitLeadership:function(){return this._aLP||(this._aLP=(e=this).isLeader?cl:new Promise((function(t){var n=!1;function r(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",i),t(!0))}e.applyOnce().then((function(){e.isLeader&&r()})),function t(){return ul(e._options.fallbackInterval).then((function(){if(!e.isDead&&!n)return e.isLeader?void r():e.applyOnce(!0).then((function(){e.isLeader?r():t()}))}))}();var i=function(t){"leader"===t.context&&"death"===t.action&&(e._hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&r()})))};e.broadcastChannel.addEventListener("internal",i),e._lstns.push(i)}))),this._aLP;var e},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,wh(this,"death")}};var Sh=new WeakMap,xh=new WeakMap;function Ch(e){return St(xh,e,(()=>function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){return e||(e={}),(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}(t,e);var n="undefined"!=typeof navigator&&void 0!==navigator.locks&&"function"==typeof navigator.locks.request?new Eh(e,t):new kh(e,t);return e._befC.push((function(){return n.die()})),e._leaderElector=n,n}(e)))}function Rh(){var e=Ll(this.storage.name,this.token,this.name,this),t=this.destroy.bind(this);this.destroy=function(){return Fl(this.token,this),t()};var n=Ch(e);return n||(n=Ch(e),Sh.set(this,n)),this.leaderElector=()=>n,n}function Oh(){return!this.multiInstance||this.leaderElector().isLeader}function Ih(){return this.multiInstance?this.leaderElector().awaitLeadership().then((()=>!0)):x}var Ph={name:"leader-election",rxdb:!0,prototypes:{RxDatabase:e=>{e.leaderElector=Rh,e.isLeader=Oh,e.waitForLeadership=Ih}},hooks:{preDestroyRxDatabase:{after:function(e){var t=Sh.get(e);t&&t.die()}}}},Dh=e=>Promise.resolve(e);function Th(e,t){if("_deleted"===e)return t;var n=!!(t=A(t))._deleted;return t[e]=n,delete t._deleted,t}function Ah(e,t,n){return n.map((n=>{var r=A(n);if("_deleted"!==t){var i=!!r[t];r._deleted=i,delete r[t]}else r._deleted=!!r._deleted;return r[e.schema.primaryPath]=ye(e.schema.jsonSchema,r),r}))}function jh(e,t){if("undefined"==typeof window||"object"!=typeof window||void 0===window.addEventListener||navigator.onLine)return e.promiseWait(t);var n,r=new Promise((e=>{n=()=>{window.removeEventListener("online",n),e()},window.addEventListener("online",n)}));return Promise.race([r,e.promiseWait(t)]).then((()=>{window.removeEventListener("online",n)}))}var Mh=new WeakMap,Nh=function(){function t(e,t,n,r,i,o,s,a){this.subs=[],this.subjects={received:new rt,sent:new rt,error:new rt,canceled:new Jt(!1),active:new Jt(!1)},this.received$=this.subjects.received.asObservable(),this.sent$=this.subjects.sent.asObservable(),this.error$=this.subjects.error.asObservable(),this.canceled$=this.subjects.canceled.asObservable(),this.active$=this.subjects.active.asObservable(),this.callOnStart=void 0,this.remoteEvents$=new rt,this.replicationIdentifier=e,this.collection=t,this.deletedField=n,this.pull=r,this.push=i,this.live=o,this.retryTime=s,this.autoStart=a,St(Mh,t,(()=>[])).push(this),this.collection.onDestroy.push((()=>this.cancel())),Object.keys(this.subjects).forEach((e=>{Object.defineProperty(this,e+"$",{get:function(){return this.subjects[e].asObservable()}})}));var c=new Promise((e=>{this.callOnStart=e}));this.startPromise=c}var n=t.prototype;return n.start=async function(){if(!this.isStopped()){var t=this.pull&&this.pull.modifier?this.pull.modifier:Dh,n=this.push&&this.push.modifier?this.push.modifier:Dh,r=this.collection.database,i="rx-replication-meta-"+await r.hashFunction([this.collection.name,this.replicationIdentifier].join("-")),o=(a=this.collection.schema.jsonSchema,c=Ft(this.collection.schema.jsonSchema),l=e(fe(u=a,me(u.primaryKey)).maxLength),h={title:"RxReplicationProtocolMetaData",primaryKey:{key:"id",fields:["itemId","isCheckpoint"],separator:"|"},type:"object",version:a.version,additionalProperties:!1,properties:{id:{type:"string",minLength:1,maxLength:l+2},isCheckpoint:{type:"string",enum:["0","1"],minLength:1,maxLength:1},itemId:{type:"string",maxLength:l>4?l:4},checkpointData:{type:"object",additionalProperties:!0},docData:{type:"object",properties:a.properties},isResolvedConflict:{type:"string"}},keyCompression:a.keyCompression,required:["id","isCheckpoint","itemId"]},c&&(h.encrypted=["docData"]),ve(h)),[s]=await Promise.all([this.collection.database.storage.createStorageInstance({databaseName:r.name,collectionName:i,databaseInstanceToken:r.token,multiInstance:r.multiInstance,options:{},schema:o,password:r.password,devMode:W.isDevMode()}),Qt(this.collection,i,o)]);this.metaInstance=s,this.internalReplicationState=function(t){(t=A(t)).forkInstance=ah(t.forkInstance),t.metaInstance=ah(t.metaInstance);var n=async function(e){return"rx_storage_replication_"+await e.hashFunction([e.identifier,e.forkInstance.databaseName,e.forkInstance.collectionName].join("||"))}(t),r={primaryPath:me(t.forkInstance.schema.primaryKey),hasAttachments:!!t.forkInstance.schema.attachments,input:t,checkpointKey:n,downstreamBulkWriteFlag:n.then((e=>"replication-downstream-"+e)),events:{canceled:new Jt(!1),active:{down:new Jt(!0),up:new Jt(!0)},processed:{down:new rt,up:new rt},resolvedConflicts:new rt,error:new rt},stats:{down:{addNewTask:0,downstreamProcessChanges:0,downstreamResyncOnce:0,masterChangeStreamEmit:0,persistFromMaster:0},up:{forkChangeStreamEmit:0,persistToMaster:0,persistToMasterConflictWrites:0,persistToMasterHadConflicts:0,processTasks:0,upstreamInitialSync:0}},firstSyncDone:{down:new Jt(!1),up:new Jt(!1)},streamQueue:{down:O,up:O},checkpointQueue:O,lastCheckpointDoc:{}};return async function(t){t.input.initialCheckpoint&&t.input.initialCheckpoint.downstream&&(await nh(t,"down")||await rh(t,"down",t.input.initialCheckpoint.downstream));var n=await t.input.hashFunction(t.input.identifier),r=t.input.replicationHandler,i=0,o=[];function s(n){t.stats.down.addNewTask=t.stats.down.addNewTask+1;var s={time:i++,task:n};o.push(s),t.streamQueue.down=t.streamQueue.down.then((()=>{for(var n=[];o.length>0;){t.events.active.down.next(!0);var s=e(o.shift());if(!(s.time<c)){if("RESYNC"===s.task){if(0===n.length){n.push(s.task);break}break}n.push(s.task)}}if(0!==n.length)return"RESYNC"===n[0]?async function(){if(t.stats.down.downstreamResyncOnce=t.stats.down.downstreamResyncOnce+1,!t.events.canceled.getValue()){t.checkpointQueue=t.checkpointQueue.then((()=>nh(t,"down")));for(var e=await t.checkpointQueue,n=[];!t.events.canceled.getValue();){c=i++;var o=await r.masterChangesSince(e,t.input.pullBatchSize);if(0===o.documents.length)break;if(e=At([e,o.checkpoint]),n.push(h(o.documents,e)),o.documents.length<t.input.pullBatchSize)break}await Promise.all(n)}}():function(n){t.stats.down.downstreamProcessChanges=t.stats.down.downstreamProcessChanges+1;var r=[],i=null;return n.forEach((e=>{if("RESYNC"===e)throw new Error("SNH");re(r,e.documents),i=At([i,e.checkpoint])})),h(r,e(i))}(n)})).then((()=>{t.events.active.down.next(!1),t.firstSyncDone.down.getValue()||t.events.canceled.getValue()||t.firstSyncDone.down.next(!0)}))}if(s("RESYNC"),!t.events.canceled.getValue()){var a=r.masterChangeStream$.subscribe((e=>{t.stats.down.masterChangeStreamEmit=t.stats.down.masterChangeStreamEmit+1,s(e)}));Zt(t.events.canceled.pipe(Et((e=>!!e)))).then((()=>a.unsubscribe()))}var c=-1,u=O,l={docs:{}};function h(e,r){var i=t.primaryPath;return t.stats.down.persistFromMaster=t.stats.down.persistFromMaster+1,e.forEach((e=>{var t=e[i];l.docs[t]=e})),l.checkpoint=r,u=u.then((()=>{var e=l.docs;l.docs={};var r=l.checkpoint,o=Object.keys(e);if(t.events.canceled.getValue()||0===o.length)return O;var s=[],a={},c={},u=[];return Promise.all([t.input.forkInstance.findDocumentsById(o,!0),ch(t,o)]).then((([r,l])=>{var h=new Map;return r.forEach((e=>h.set(e[i],e))),Promise.all(o.map((async r=>{var i=h.get(r),o=i?oh(i,t.hasAttachments,!1):void 0,d=e[r],f=l[r];if(f&&i&&f.metaDocument.isResolvedConflict===i._rev)return O;var p=!(!f||!o)&&await t.input.conflictHandler({realMasterState:f.docData,newDocumentState:o},"downstream-check-if-equal-0").then((e=>e.isEqual));if(!p&&f&&f.docData._rev&&i&&i._meta[t.input.identifier]&&Rt(i._rev).height===i._meta[t.input.identifier]&&(p=!0),i&&f&&!1===p||i&&!f)return O;var m=!!o&&await t.input.conflictHandler({realMasterState:d,newDocumentState:o},"downstream-check-if-equal-1").then((e=>e.isEqual));if(o&&m)return f&&!1!==p||u.push(await uh(t,o,f?f.metaDocument:void 0)),O;var y=Object.assign({},d,i?{_meta:A(i._meta),_attachments:t.hasAttachments&&d._attachments?d._attachments:{},_rev:""}:{_meta:{lwt:Ct()},_rev:"",_attachments:t.hasAttachments&&d._attachments?d._attachments:{}});if(d._rev){var v=i?Rt(i._rev).height+1:1;y._meta[t.input.identifier]=v,t.input.keepMeta&&(y._rev=d._rev)}t.input.keepMeta&&d._meta&&(y._meta=d._meta);var g={previous:i,document:y};g.document._rev=g.document._rev?g.document._rev:It(n,g.previous),s.push(g),a[r]=g,c[r]=await uh(t,d,f?f.metaDocument:void 0)})))})).then((async()=>{if(s.length>0)return t.input.forkInstance.bulkWrite(s,await t.downstreamBulkWriteFlag).then((e=>{e.success.forEach((e=>{var n=e[i];t.events.processed.down.next(a[n]),u.push(c[n])})),e.error.forEach((e=>{409!==e.status&&t.events.error.next(V("RC_PULL",{writeError:e}))}))}))})).then((()=>{if(u.length>0)return t.input.metaInstance.bulkWrite(sh(t,u),"replication-down-write-meta").then((e=>{e.error.forEach((e=>{t.events.error.next(V("RC_PULL",{id:e.documentId,writeError:e}))}))}))})).then((()=>{rh(t,"down",r)}))})).catch((e=>t.events.error.next(e))),u}}(r),hh(r),r}({pushBatchSize:this.push&&this.push.batchSize?this.push.batchSize:100,pullBatchSize:this.pull&&this.pull.batchSize?this.pull.batchSize:100,initialCheckpoint:{upstream:this.push?this.push.initialCheckpoint:void 0,downstream:this.pull?this.pull.initialCheckpoint:void 0},forkInstance:this.collection.storageInstance,metaInstance:this.metaInstance,hashFunction:r.hashFunction,identifier:"rxdbreplication"+this.replicationIdentifier,conflictHandler:this.collection.conflictHandler,replicationHandler:{masterChangeStream$:this.remoteEvents$.asObservable().pipe(Et((e=>!!this.pull)),_t((async e=>{if("RESYNC"===e)return e;var n=A(e);return n.documents=Ah(this.collection,this.deletedField,n.documents),n.documents=await Promise.all(n.documents.map((e=>t(e)))),n}))),masterChangesSince:async(n,r)=>{if(!this.pull)return{checkpoint:null,documents:[]};for(var i=!1,o={};!i&&!this.isStopped();)try{o=await this.pull.handler(n,r),i=!0}catch(t){var s=V("RC_PULL",{checkpoint:n,errors:Z(t).map((e=>L(e))),direction:"pull"});this.subjects.error.next(s),await jh(this.collection,e(this.retryTime))}if(this.isStopped())return{checkpoint:null,documents:[]};var a=A(o);return a.documents=Ah(this.collection,this.deletedField,a.documents),a.documents=await Promise.all(a.documents.map((e=>t(e)))),a},masterWrite:async t=>{if(!this.push)return[];var r=!1;await se("preReplicationMasterWrite",{rows:t,collection:this.collection});var i=(await Promise.all(t.map((async e=>(e.newDocumentState=await n(e.newDocumentState),null===e.newDocumentState?null:(e.assumedMasterState&&(e.assumedMasterState=await n(e.assumedMasterState)),"_deleted"!==this.deletedField&&(e.newDocumentState=Th(this.deletedField,e.newDocumentState),e.assumedMasterState&&(e.assumedMasterState=Th(this.deletedField,e.assumedMasterState))),e)))))).filter(te),o=null;for(0===i.length&&(r=!0,o=[]);!r&&!this.isStopped();)try{if(o=await this.push.handler(i),!Array.isArray(o))throw V("RC_PUSH_NO_AR",{pushRows:t,direction:"push",args:{result:o}});r=!0}catch(n){var s=n.rxdb?n:V("RC_PUSH",{pushRows:t,errors:Z(n).map((e=>L(e))),direction:"push"});this.subjects.error.next(s),await jh(this.collection,e(this.retryTime))}return this.isStopped()?[]:(await se("preReplicationMasterWriteDocumentsHandle",{result:o,collection:this.collection}),Ah(this.collection,this.deletedField,e(o)))}}}),this.subs.push(this.internalReplicationState.events.error.subscribe((e=>{this.subjects.error.next(e)})),this.internalReplicationState.events.processed.down.subscribe((e=>this.subjects.received.next(e.document))),this.internalReplicationState.events.processed.up.subscribe((e=>{this.subjects.sent.next(e.newDocumentState)})),eh([this.internalReplicationState.events.active.down,this.internalReplicationState.events.active.up]).subscribe((([e,t])=>{var n=e||t;this.subjects.active.next(n)}))),this.pull&&this.pull.stream$&&this.live&&this.subs.push(this.pull.stream$.subscribe({next:e=>{this.remoteEvents$.next(e)},error:e=>{this.subjects.error.next(e)}})),this.live||(await dh(this.internalReplicationState),await fh(this.internalReplicationState),await this.cancel()),this.callOnStart()}var a,c,u,l,h},n.isStopped=function(){return!!this.subjects.canceled.getValue()},n.awaitInitialReplication=async function(){return await this.startPromise,dh(e(this.internalReplicationState))},n.awaitInSync=async function(){return await this.startPromise,await dh(e(this.internalReplicationState)),await this.collection.database.requestIdlePromise(),await fh(e(this.internalReplicationState)),!0},n.reSync=function(){this.remoteEvents$.next("RESYNC")},n.emitEvent=function(e){this.remoteEvents$.next(e)},n.cancel=async function(){if(this.isStopped())return C;var t=[];return this.internalReplicationState&&await async function(e){e.events.canceled.next(!0),e.events.active.up.complete(),e.events.active.down.complete(),e.events.processed.up.complete(),e.events.processed.down.complete(),e.events.resolvedConflicts.complete(),e.events.canceled.complete(),await e.checkpointQueue}(this.internalReplicationState),this.metaInstance&&t.push(e(this.internalReplicationState).checkpointQueue.then((()=>e(this.metaInstance).close()))),this.subs.forEach((e=>e.unsubscribe())),this.subjects.canceled.next(!0),this.subjects.active.complete(),this.subjects.canceled.complete(),this.subjects.error.complete(),this.subjects.received.complete(),this.subjects.sent.complete(),Promise.all(t)},t}();function Bh(e,t,n){var r=n.id,i=Zt(e.response$.pipe(Et((e=>e.peer===t)),Et((e=>e.response.id===r)),ct((e=>e.response))));return e.send(t,n),i}var Lh=function(){function t(t,n,r){this.peerStates$=new Jt(new Map),this.canceled=!1,this.subs=[],this.error$=new rt,this.collection=t,this.options=n,this.connectionHandler=r,this.collection.onDestroy.push((()=>this.cancel())),this.masterReplicationHandler=function(t,n,r,i=!1){var o=!!(t=ah(t)).schema.attachments,s=me(t.schema.primaryKey);return{masterChangeStream$:t.changeStream().pipe(_t((async e=>({checkpoint:e.checkpoint,documents:await Promise.all(e.events.map((async e=>{var n=oh(e.documentData,o,i);return o&&(n=await lh(s,t,M(n),void 0)),n})))})))),masterChangesSince:(e,n)=>t.getChangedDocumentsSince(n,e).then((async n=>({checkpoint:n.documents.length>0?n.checkpoint:e,documents:await Promise.all(n.documents.map((async e=>{var n=oh(e,o,i);return o&&(n=await lh(s,t,M(n),void 0)),n})))}))),async masterWrite(a){var c={};a.forEach((e=>{var t=e.newDocumentState[s];c[t]=e}));var u=Object.keys(c),l=await t.findDocumentsById(u,!0),h=new Map;l.forEach((e=>h.set(e[s],e)));var d=[],f=[];return await Promise.all(Object.entries(c).map((async([t,s])=>{var a=h.get(t);a?a&&!s.assumedMasterState?d.push(oh(a,o,i)):!0===(await n({realMasterState:oh(a,o,i),newDocumentState:e(s.assumedMasterState)},"rxStorageInstanceToReplicationHandler-masterWrite")).isEqual?f.push({previous:a,document:ih(r,o,i,s.newDocumentState,a)}):d.push(oh(a,o,i)):f.push({document:ih(r,o,i,s.newDocumentState)})}))),f.length>0&&(await t.bulkWrite(f,"replication-master-write")).error.forEach((t=>{if(409!==t.status)throw new Error("non conflict error");d.push(oh(e(t.documentInDb),o,i))})),d}}}(t.storageInstance,t.conflictHandler,t.database.token)}var n=t.prototype;return n.addPeer=function(e,t){var n={peer:e,replicationState:t,subs:[]};this.peerStates$.next(this.peerStates$.getValue().set(e,n)),t&&n.subs.push(t.error$.subscribe((e=>this.error$.next(e))))},n.removePeer=function(e){var t=kt(this.peerStates$.getValue(),e);this.peerStates$.getValue().delete(e),this.peerStates$.next(this.peerStates$.getValue()),t.subs.forEach((e=>e.unsubscribe())),t.replicationState&&t.replicationState.cancel()},n.awaitFirstPeer=function(){return Zt(this.peerStates$.pipe(Et((e=>e.size>0))))},n.cancel=async function(){this.canceled||(this.canceled=!0,this.subs.forEach((e=>e.unsubscribe())),Array.from(this.peerStates$.getValue().keys()).forEach((e=>{this.removePeer(e)})),await this.connectionHandler.destroy())},t}(),Fh=n(853);function $h(e,t){e.send(JSON.stringify(t))}var qh="signaling.rxdb.info",Kh="wss://"+qh+"/",Uh=!1;function Wh({signalingServerUrl:t,wrtc:n,webSocketConstructor:r}){return t=t||Kh,r=r||WebSocket,t.includes(qh)&&!Uh&&(Uh=!0,console.warn(["RxDB Warning: You are using the RxDB WebRTC replication plugin","but you did not specify your own signaling server url.","By default it will use a signaling server provided by RxDB at "+Kh,"This server is made for demonstration purposes and tryouts. It is not reliable and might be offline at any time.","In production you must always use your own signaling server instead.","Learn how to run your own server at https://rxdb.info/replication-webrtc.html","Also leave a ⭐ at the RxDB github repo 🙏 https://github.com/pubkey/rxdb 🙏"].join(" "))),async i=>{var o,s=new rt,a=new rt,c=new rt,u=new rt,l=new rt,h=new Map,d=!1,f=void 0;return function a(){d||((f=new r(t)).onclose=()=>a(),f.onopen=()=>{e(f).onmessage=t=>{var r=JSON.parse(t.data);switch(r.type){case"init":o=r.yourPeerId,$h(e(f),{type:"join",room:i.topic});break;case"joined":r.otherPeerIds.forEach((t=>{if(t!==o&&!h.has(t)){var r=new Fh({initiator:t>o,wrtc:n,trickle:!0});h.set(t,r),r.on("signal",(n=>{$h(e(f),{type:"signal",senderPeerId:o,receiverPeerId:t,room:i.topic,data:n})})),r.on("data",(e=>{(e=JSON.parse(e.toString())).result?u.next({peer:r,response:e}):c.next({peer:r,message:e})})),r.on("error",(e=>{console.log("CLIENT("+o+") peer got error:"),console.dir(e),l.next(V("RC_WEBRTC_PEER",{error:e}))})),r.on("connect",(()=>{s.next(r)}))}}));break;case"signal":kt(h,r.senderPeerId).signal(r.data)}}})}(),(async()=>{for(;await S(6e4),!d;)f&&$h(f,{type:"ping"})})(),{error$:l,connect$:s,disconnect$:a,message$:c,response$:u,async send(e,t){await e.send(JSON.stringify(t))},destroy:()=>(d=!0,e(f).close(),l.complete(),s.complete(),a.complete(),c.complete(),u.complete(),O)}}}var Hh=function(e={}){return new Wl(e)}(),zh=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function(){var t,n,r;return function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(o){switch(o.label){case 0:return(!(t=window.location.hash)||t.length<5)&&(window.location.hash="room-"+i(10),window.location.reload()),[4,v(t)];case 1:return[4,Go({name:"mydb-"+(n=o.sent()).substring(0,10),storage:Hh})];case 2:return[4,(r=o.sent()).addCollections({todos:{schema:{version:0,primaryKey:"id",type:"object",properties:{id:{type:"string",maxLength:20},name:{type:"string"},state:{type:"string",enum:["open","done"],maxLength:10},lastChange:{type:"number",minimum:1701307494132,maximum:2701307494132,multipleOf:1}},required:["id","name","state","lastChange"],indexes:["state",["state","lastChange"]]}}})];case 3:return o.sent(),r.todos.preSave((function(e){return e.lastChange=Date.now(),e}),!0),async function(t){var n=t.collection;Vl(Ph),t.pull&&(t.pull.batchSize||(t.pull.batchSize=20)),t.push&&(t.push.batchSize||(t.push.batchSize=20)),n.database.multiInstance&&await n.database.waitForLeadership();var r=0,o=i(10);function s(){var e=r++;return n.database.token+"|"+o+"|"+e}var a=await n.database.storageToken,c=new Lh(n,t,await t.connectionHandlerCreator(t));c.subs.push(c.connectionHandler.error$.subscribe((e=>c.error$.next(e))),c.connectionHandler.disconnect$.subscribe((e=>c.removePeer(e)))),c.subs.push(c.connectionHandler.message$.pipe(Et((e=>"token"===e.message.method))).subscribe((e=>{c.connectionHandler.send(e.peer,{id:e.message.id,result:a})})));var u=c.connectionHandler.connect$.pipe(Et((()=>!c.canceled))).subscribe((async r=>{var i,o;try{i=(await Bh(c.connectionHandler,r,{id:s(),method:"token",params:[]})).result}catch(e){return void c.error$.next(V("RC_WEBRTC_PEER",{error:e}))}if(await async function(e,t,n){return await e([t,n].join("|"))>await e([n,t].join("|"))}(n.database.hashFunction,a,i)){var u=c.masterReplicationHandler,l=u.masterChangeStream$.subscribe((e=>{var t={id:"masterChangeStream$",result:e};c.connectionHandler.send(r,t)}));c.subs.push(l,c.connectionHandler.disconnect$.pipe(Et((e=>e.id===r.id))).subscribe((()=>l.unsubscribe())));var h=c.connectionHandler.message$.pipe(Et((e=>e.peer.id===r.id)),Et((e=>"token"!==e.message.method))).subscribe((async e=>{var{peer:t,message:n}=e,r=u[n.method].bind(u),i=await r(...n.params),o={id:n.id,result:i};c.connectionHandler.send(t,o)}));c.subs.push(h)}else o=function({replicationIdentifier:e,collection:t,deletedField:n="_deleted",pull:r,push:i,live:o=!0,retryTime:s=5e3,waitForLeadership:a=!0,autoStart:c=!0}){if(Vl(Ph),!r&&!i)throw V("UT3",{collection:t.name,args:{replicationIdentifier:e}});var u=new Nh(e,t,n,r,i,o,s,c);return function(e,t){(e&&t.collection.database.multiInstance?t.collection.database.waitForLeadership():x).then((()=>{t.isStopped()||t.autoStart&&t.start()}))}(a,u),u}({replicationIdentifier:[n.name,t.topic,i].join("||"),collection:n,autoStart:!0,deletedField:"_deleted",live:!0,retryTime:t.retryTime,waitForLeadership:!1,pull:t.pull?Object.assign({},t.pull,{handler:async n=>(await Bh(c.connectionHandler,r,{method:"masterChangesSince",params:[n,e(t.pull).batchSize],id:s()})).result,stream$:c.connectionHandler.response$.pipe(Et((e=>"masterChangeStream$"===e.response.id)),ct((e=>e.response.result)))}):void 0,push:t.push?Object.assign({},t.push,{handler:async e=>(await Bh(c.connectionHandler,r,{method:"masterWrite",params:[e],id:s()})).result}):void 0});c.addPeer(r,o)}));return c.subs.push(u),c}({collection:r.todos,connectionHandlerCreator:Wh({}),topic:n.substring(0,10),secret:"lol",pull:{},push:{}}).then((function(e){e.error$.subscribe((function(e){console.log("replication error:"),console.dir(e)})),e.peerStates$.subscribe((function(e){console.log("new peer states:"),console.dir(e)}))})),[2,r]}}))})),Qh=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Vh=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Qh(void 0,void 0,void 0,(function(){var t,n,r;return Vh(this,(function(o){switch(o.label){case 0:return[4,zh];case 1:return t=o.sent(),e(document.getElementById("copy-url")).innerHTML=window.location.href,n=e(document.getElementById("todo-list")),t.todos.find({sort:[{state:"desc"},{lastChange:"desc"}]}).$.subscribe((function(e){n.innerHTML="",e.forEach((function(e){return n.append(function(e){var t=this,n=document.createElement("li"),r=document.createElement("div"),i=document.createElement("input"),o=document.createElement("label"),s=document.createElement("button");return n.append(r),r.append(i),r.append(o),r.append(s),i.onclick=function(){return e.incrementalPatch({state:"done"===e.state?"open":"done"})},i.type="checkbox",i.classList.add("toggle"),o.contentEditable="true",o.onkeyup=function(n){return Qh(t,void 0,void 0,(function(){var t;return Vh(this,(function(r){switch(r.label){case 0:return"Enter"!==n.code?[3,2]:(t=o.innerHTML.replace(/<br>/g,"").replace(/\&nbsp;/g," ").trim(),[4,e.incrementalPatch({name:t})]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},o.innerHTML=Yh(e.name),s.classList.add("destroy"),s.onclick=function(){return e.remove()},"done"===e.state&&(n.classList.add("completed"),i.checked=!0),n}(e))}))})),(r=e(document.getElementById("insert-todo"))).onkeydown=function(e){return Qh(void 0,void 0,void 0,(function(){return Vh(this,(function(n){switch(n.label){case 0:return"Enter"===e.code&&r.value.length>0?[4,t.todos.insert({id:i(10),name:r.value,state:"open",lastChange:Date.now()})]:[3,2];case 1:n.sent(),r.value="",n.label=2;case 2:return[2]}}))}))},e(document.getElementById("clear-completed")).onclick=function(){return t.todos.find({selector:{state:"done"}}).remove()},[2]}}))}));var Yh=function(e){return e.replace(/[&<]/g,(function(e){return"&"===e?"&amp;":"&lt;"}))}})()})();
//# sourceMappingURL=bundle.js.map